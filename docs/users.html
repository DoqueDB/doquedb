<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN">
<!--
  Copyright (c) 2023, 2024 Ricoh Company, Ltd.

  Licensed under the Apache License, Version 2.0 (the License);
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<html>

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DTDCGC7EY9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-DTDCGC7EY9');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="css/default.css">
  <title>DoqueDB ユーザーズマニュアル</title>
</head>

<body>
  <h1>DoqueDB ユーザーズマニュアル</h1>
  <div class="right"><a href="index.html">[トップページに戻る]</a></div>
  <div class="contents">
    <dl>
      <dt>
        <a href="#secintro">はじめに</a>
      </dt>
      <dd>
        <dl>
          <dt>
            <a href="#secintro1">マニュアルの見方</a>
          </dt>
          <dt>
            <a href="#secintro2">DoqueDBとは</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#secintro21">全文検索エンジンとしての主な特徴</a>
              </dt>
              <dt>
                <a href="#secintro22">RDBMSとしての主な特徴</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#secintro3">規約</a>
          </dt>
        </dl>
      </dd>
      <dt>
        <a href="#sec1">1章 全文索引チュートリアル</a>
      </dt>
      <dd>
        <dl>
          <dt>
            <a href="#sec101">1.1 書式</a>
          </dt>
          <dt>
            <a href="#sec102">1.2 索引タイプ</a>
          </dt>
          <dt>
            <a href="#sec103">1.3 遅延更新</a>
          </dt>
          <dt>
            <a href="#sec104">1.4 ランキング検索</a>
          </dt>
          <dt>
            <a href="#sec105">1.5 自然文検索</a>
          </dt>
          <dt>
            <a href="#sec106">1.6 全文複合索引</a>
          </dt>
        </dl>
      </dd>
      <dt>
        <a href="#sec2">2章 インストール</a>
      </dt>
      <dd>
        <dl>
          <dt>
            <a href="#sec201">2.1 パッケージ</a>
          </dt>
          <dt>
            <a href="#sec202">2.2 インストール</a>
          </dt>
          <dt>
            <a href="#sec203">2.3 インストールファイル</a>
          </dt>
          <dt>
            <a href="#sec204">2.4 syslogの使用</a>
          </dt>
          <dt>
            <a href="#sec205">2.5 アンインストール</a>
          </dt>
        </dl>
      </dd>
      <dt>
        <a href="#sec3">3章 サーバ管理</a>
      </dt>
      <dd>
        <dl>
          <dt>
            <a href="#sec301">3.1 サービスの起動と停止</a>
          </dt>
          <dt>
            <a href="#sec302">3.2 バージョン</a>
          </dt>
          <dt>
            <a href="#sec303">3.3 パラメーター</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec30301">3.3.1 パラメーターの格納場所</a>
              </dt>
              <dt>
                <a href="#sec30302">3.3.2 パラメーターの変更</a>
              </dt>
              <dt>
                <a href="#sec30303">3.3.3 デフォルトで設定されているパラメーター</a>
              </dt>
              <dt>
                <a href="#sec30304">3.3.4 チューニング用パラメーター</a>
              </dt>
              <dt>
                <a href="#sec30305">3.3.5 検索用パラメーター</a>
              </dt>
              <dt>
                <a href="#sec30306">3.3.6 ログ用パラメーター</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec304">3.4 組込みデータベースと組込み表</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec30401">3.4.1 組込みデータベース</a>
              </dt>
              <dt>
                <a href="#sec30402">3.4.2 組込み表</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec305">3.5 ユーザー</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec30501">3.5.1 ユーザー認証</a>
              </dt>
              <dt>
                <a href="#sec30502">3.5.2 ユーザー管理</a>
              </dt>
              <dt>
                <a href="#sec30503">3.5.3 パスワード変更</a>
              </dt>
              <dt>
                <a href="#sec30504">3.5.4 新規ユーザー作成</a>
              </dt>
              <dt>
                <a href="#sec30505">3.5.5 ユーザー削除</a>
              </dt>
              <dt>
                <a href="#sec30506">3.5.6 ユーザー権限管理</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec306">3.6 多言語対応</a>
          </dt>
          <dt>
            <a href="#sec307">3.7 データベース構成ファイル</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec30701">3.7.1 データベースパス</a>
              </dt>
              <dt>
                <a href="#sec30702">3.7.2 ファイル数</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec308">3.8 バックアップ</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec30801">3.8.1 オンラインバックアップ</a>
              </dt>
              <dt>
                <a href="#sec30802">3.8.2 オフラインバックアップ</a>
              </dt>
              <dt>
                <a href="#sec30803">3.8.3 オフラインバックアップ(2)</a>
              </dt>
              <dt>
                <a href="#sec30804">3.8.4 リストア手順</a>
              </dt>
              <dt>
                <a href="#sec30805">3.8.5 データベースファイルのコピー</a>
              </dt>
              <dt>
                <a href="#sec30806">3.8.6 強制リストア手順</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec309">3.9 自動復旧</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec30901">3.9.1 Not available</a>
              </dt>
              <dt>
                <a href="#sec30902">3.9.2 終了処理なしのプロセスの終了</a>
              </dt>
              <dt>
                <a href="#sec30903">3.9.3 自動復旧処理</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec310">3.10 ロールフォワードリカバリ</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec31001">3.10.1 データベース属性の変更</a>
              </dt>
              <dt>
                <a href="#sec31002">3.10.2 ロールフォワードリカバリログ</a>
              </dt>
              <dt>
                <a href="#sec31003">3.10.3 ロールフォワードリカバリのためのバックアップ</a>
              </dt>
              <dt>
                <a href="#sec31004">3.10.4 ロールフォワードリカバリの実行</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec311">3.11 ログ</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec31101">3.11.1 ログ出力設定</a>
              </dt>
              <dt>
                <a href="#sec31102">3.11.2 アクセスプラン</a>
              </dt>
              <dt>
                <a href="#sec31103">3.11.3 ログメッセージ</a>
              </dt>
            </dl>
          </dd>
        </dl>
      </dd>
      <dt>
        <a href="#sec4">4章 クライアントインターフェース</a>
      </dt>
      <dd>
        <dl>
          <dt>
            <a href="#sec401">4.1 バージョン</a>
          </dt>
          <dt>
            <a href="#sec402">4.2 sqli</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec40201">4.2.1 sqliの引数</a>
              </dt>
              <dt>
                <a href="#sec40202">4.2.2 sqliのコマンド</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec403">4.3 JDBC</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec40301">4.3.1 JDBCのユーザー認証</a>
              </dt>
              <dt>
                <a href="#sec40302">4.3.2 JDBCのURL</a>
              </dt>
              <dt>
                <a href="#sec40303">4.3.3 JDBCのサンプルプログラム</a>
              </dt>
            </dl>
          </dd>
        </dl>
      </dd>
      <dt>
        <a href="#sec5">5章 ロード/アンロードコマンド</a>
      </dt>
      <dd>
        <dl>
          <dt>
            <a href="#sec501">5.1 ロードコマンド</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec50101">5.1.1 実行コマンド</a>
              </dt>
              <dt>
                <a href="#sec50102">5.1.2 スクリプトファイルの作成</a>
              </dt>
              <dt>
                <a href="#sec50103">5.1.3 ロードファイルの用意</a>
              </dt>
              <dt>
                <a href="#sec50104">5.1.4 ロードの実行</a>
              </dt>
              <dt>
                <a href="#sec50105">5.1.5 ロードのログ</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec502">5.2 アンロードコマンド</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec50201">5.2.1 実行コマンド</a>
              </dt>
              <dt>
                <a href="#sec50202">5.2.2 スクリプトファイルの作成</a>
              </dt>
              <dt>
                <a href="#sec50203">5.2.3 アンロードの実行</a>
              </dt>
              <dt>
                <a href="#sec50204">5.2.4 アンロードのログ</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec503">5.3 ロードファイル仕様</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec50301">5.3.1 テキスト形式のロードファイル</a>
              </dt>
              <dt>
                <a href="#sec50302">5.3.2 XML形式のロードファイル</a>
              </dt>
            </dl>
          </dd>
        </dl>
      </dd>
      <dt>
        <a href="#sec6">6章 SQL言語</a>
      </dt>
      <dd>
        <dl>
          <dt>
            <a href="#sec601">6.1 定数および識別子</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60101">6.1.1 定数</a>
              </dt>
              <dt>
                <a href="#sec60102">6.1.2 識別子</a>
              </dt>
              <dt>
                <a href="#sec60103">6.1.3 キーワード</a>
              </dt>
              <dt>
                <a href="#sec60104">6.1.4 デリミタ</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec602">6.2 スカラ式</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60201">6.2.1 データ型</a>
              </dt>
              <dt>
                <a href="#sec60202">6.2.2 値指定</a>
              </dt>
              <dt>
                <a href="#sec60203">6.2.3 データベース名</a>
              </dt>
              <dt>
                <a href="#sec60204">6.2.4 表参照</a>
              </dt>
              <dt>
                <a href="#sec60205">6.2.5 列参照</a>
              </dt>
              <dt>
                <a href="#sec60206">6.2.6 全文検索結果参照</a>
              </dt>
              <dt>
                <a href="#sec60207">6.2.7 集合関数</a>
              </dt>
              <dt>
                <a href="#sec60208">6.2.8 数値関数</a>
              </dt>
              <dt>
                <a href="#sec60209">6.2.9 データ列値関数</a>
              </dt>
              <dt>
                <a href="#sec60210">6.2.10 日時値関数</a>
              </dt>
              <dt>
                <a href="#sec60211">6.2.11 値式</a>
              </dt>
              <dt>
                <a href="#sec60212">6.2.12 数値式</a>
              </dt>
              <dt>
                <a href="#sec60213">6.2.13 データ列値式</a>
              </dt>
              <dt>
                <a href="#sec60214">6.2.14 ブール値式</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec603">6.3 問合せ式</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60301">6.3.1 行値構成子</a>
              </dt>
              <dt>
                <a href="#sec60302">6.3.2 表値構成子</a>
              </dt>
              <dt>
                <a href="#sec60303">6.3.3 表式</a>
              </dt>
              <dt>
                <a href="#sec60304">6.3.4 結合表</a>
              </dt>
              <dt>
                <a href="#sec60305">6.3.5 問合せ式本体</a>
              </dt>
              <dt>
                <a href="#sec60306">6.3.6 副問合せ</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec604">6.4 述語</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60401">6.4.1 比較述語</a>
              </dt>
              <dt>
                <a href="#sec60402">6.4.2 BETWEEN述語</a>
              </dt>
              <dt>
                <a href="#sec60403">6.4.3 IN述語</a>
              </dt>
              <dt>
                <a href="#sec60404">6.4.4 LIKE述語</a>
              </dt>
              <dt>
                <a href="#sec60405">6.4.5 NULL述語</a>
              </dt>
              <dt>
                <a href="#sec60406">6.4.6 EXISTS述語</a>
              </dt>
              <dt>
                <a href="#sec60407">6.4.7 CONTAINS述語</a>
              </dt>
              <dt>
                <a href="#sec60408">6.4.8 CONTAINSオペランド</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec605">6.5 スキーマ定義</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60501">6.5.1 データベース定義</a>
              </dt>
              <dt>
                <a href="#sec60502">6.5.2 エリア定義</a>
              </dt>
              <dt>
                <a href="#sec60503">6.5.3 表定義</a>
              </dt>
              <dt>
                <a href="#sec60504">6.5.4 列定義</a>
              </dt>
              <dt>
                <a href="#sec60505">6.5.5 ヒント句</a>
              </dt>
              <dt>
                <a href="#sec60506">6.5.6 データベース定義変更</a>
              </dt>
              <dt>
                <a href="#sec60507">6.5.7 エリア定義変更</a>
              </dt>
              <dt>
                <a href="#sec60508">6.5.8 表定義変更</a>
              </dt>
              <dt>
                <a href="#sec60509">6.5.9 データベース削除</a>
              </dt>
              <dt>
                <a href="#sec60510">6.5.10 エリア削除</a>
              </dt>
              <dt>
                <a href="#sec60511">6.5.11 表削除</a>
              </dt>
              <dt>
                <a href="#sec60512">6.5.12 データベースマウント</a>
              </dt>
              <dt>
                <a href="#sec60513">6.5.13 データベースアンマウント</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec606">6.6 索引定義</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60601">6.6.1 B+木索引定義</a>
              </dt>
              <dt>
                <a href="#sec60602">6.6.2 全文索引定義</a>
              </dt>
              <dt>
                <a href="#sec60603">6.6.3 ビットマップ索引定義</a>
              </dt>
              <dt>
                <a href="#sec60604">6.6.4 配列索引定義</a>
              </dt>
              <dt>
                <a href="#sec60605">6.6.5 索引定義変更</a>
              </dt>
              <dt>
                <a href="#sec60606">6.6.6 索引削除</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec607">6.7 権限管理</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60701">6.7.1 GRANT文</a>
              </dt>
              <dt>
                <a href="#sec60702">6.7.2 REVOKE文</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec608">6.8 セッション管理</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60801">6.8.1 DISCONNECT文</a>
              </dt>
              <dt>
                <a href="#sec60802">6.8.2 シングルユーザーモード</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec609">6.9 トランザクション</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec60901">6.9.1 SET TRANSACTION文</a>
              </dt>
              <dt>
                <a href="#sec60902">6.9.2 START TRANSACTION文</a>
              </dt>
              <dt>
                <a href="#sec60903">6.9.3 COMMIT文</a>
              </dt>
              <dt>
                <a href="#sec60904">6.9.4 ROLLBACK文</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec610">6.10 データ操作</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec61001">6.10.1 バックアップ開始</a>
              </dt>
              <dt>
                <a href="#sec61002">6.10.2 バックアップ終了</a>
              </dt>
              <dt>
                <a href="#sec61003">6.10.3 整合性検査</a>
              </dt>
              <dt>
                <a href="#sec61004">6.10.4 INSERT文</a>
              </dt>
              <dt>
                <a href="#sec61005">6.10.5 UPDATE文</a>
              </dt>
              <dt>
                <a href="#sec61006">6.10.6 DELETE文</a>
              </dt>
              <dt>
                <a href="#sec61007">6.10.7 一括登録</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec611">6.11 問合せ</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec61101">6.11.1 問合せ指定</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec612">6.12 分散マネージャー</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec61201">6.12.1 子サーバーの定義</a>
              </dt>
              <dt>
                <a href="#sec61202">6.12.2 分散ルールの定義</a>
              </dt>
              <dt>
                <a href="#sec61203">6.12.3 関数の定義</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#sec613">6.12 非同期レプリケーション</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#sec61301">6.13.1 スレーブデータベースの定義</a>
              </dt>
              <dt>
                <a href="#sec61302">6.13.2 一時停止と再開</a>
              </dt>
              <dt>
                <a href="#sec61303">6.13.3 マスターへの昇格</a>
              </dt>
              <dt>
                <a href="#sec61304">6.13.4 データベース構成</a>
              </dt>
              <dt>
                <a href="#sec61305">6.13.5 制限事項</a>
              </dt>
            </dl>
          </dd>
        </dl>
      </dd>
      <dt>
        <a href="#secapp">附録</a>
      </dt>
      <dd>
        <dl>
          <dt>
            <a href="#secappa">A. N-gram索引</a>
          </dt>
          <dt>
            <a href="#secappb">B. ヒント句の使い方</a>
          </dt>
          <dt>
            <a href="#secappc">C. LOB型の使い方</a>
          </dt>
          <dt>
            <a href="#secappd">D. IDENTITY列の使い方</a>
          </dt>
          <dt>
            <a href="#secappe">E. 異表記正規化辞書</a>
          </dt>
          <dt>
            <a href="#secappf">F. 質問処理辞書</a>
          </dt>
          <dt>
            <a href="#secappg">G. B+木索引の使い方</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#secappg1">G.1 カラムサイズ</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#secapph">H. 全文索引の使い方</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#secapph1">H.1 全文索引のスキーマ定義</a>
              </dt>
              <dt>
                <a href="#secapph2">H.2 全文索引の挿入</a>
              </dt>
              <dt>
                <a href="#secapph3">H.3 全文索引の問合せ</a>
              </dt>
              <dt>
                <a href="#secapph4">H.4 全文索引のランキング検索</a>
              </dt>
              <dt>
                <a href="#secapph5">H.5 全文索引の自然文検索</a>
              </dt>
              <dt>
                <a href="#secapph6">H.6 全文索引の拡張検索</a>
              </dt>
              <dt>
                <a href="#secapph7">H.7 全文索引のストップワード</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#secappi">I. 全文索引の遅延更新</a>
          </dt>
          <dt>
            <a href="#secappj">J. ビットマップ索引の使い方</a>
          </dt>
          <dd>
            <dl>
              <dt>
                <a href="#secappj1">J.1 異なりデータ数</a>
              </dt>
            </dl>
          </dd>
          <dt>
            <a href="#secappk">K. 複数インストール</a>
          </dt>
          <dt>
            <a href="#secappl">L. 用語定義</a>
          </dt>
          <dt>
            <a href="#secappm">M. 参考文献</a>
          </dt>
        </dl>
      </dd>
    </dl>
  </div>

  <h2><a id="secintro">はじめに</a></h2>

  <p class="first">本書はDoqueDBのマニュアルです。
    検索サーバーやRDBMSとしてDoqueDBをお使いいただくために必要な情報が書かれています。</p>

  <h3><a id="secintro1">マニュアルの見方</a></h3>

  <p class="first">先頭から順番に読んでもかまいませんが、
    目的に応じて以下のセクションを読むことをおすすめします。</p>

  <dl>
    <dt class="bold"><a href="#secintro2">DoqueDBとは</a></dt>
    <dd>DoqueDBの主な特徴が書かれています。
      DoqueDBにはじめて触れる方におすすめです。</dd>
    <dt class="bold"><a href="#sec1">1章 全文検索チュートリアル</a></dt>
    <dd><a href="#secintro2">DoqueDBとは</a>であげた特徴のうち、全文索引の簡単な使い方が書かれています。
      DoqueDBの全文検索について手早く理解したい方におすすめです。
    </dd>
    <dt class="bold"><a href="#sec3">3章 サーバ管理</a></dt>
    <dd>サーバを管理するためのパラメーターの設定や
      ログの見方などが書かれています。
      サーバ管理者の方々はひととおり目を通すことをおすすめします。</dd>
  </dl>

  <p>本書は、DBMSを使ったソフトウェアの開発経験や、
    サーバ管理の経験のある方を対象としています。
    そのため、ある程度の一般知識を前提とした記載があります。
    未経験者の方はその他専門書等を参照することをおすすめします。</p>

  <h3><a id="secintro2">DoqueDBとは</a></h3>

  <p class="first">DoqueDBはリコーで開発された全文検索エンジンであり、
    情報検索システムで必要とされる優れた検索性能を提供します。
    また、一般的なRDBMSとしての機能も有しています。</p>

  <h4><a id="secintro21">全文検索エンジンとしての主な特徴</a></h4>

  <p class="first">DoqueDBの全文検索エンジンとしての特徴は以下のとおりです。</p>

  <dl>
    <dt class="bold">ランキング検索</dt>
    <dd>独自のランキングアルゴリズムを用い、
      検索結果を適合度の順に並べることができます。</dd>
    <dt class="bold">自然文検索</dt>
    <dd>検索語として文章を入れることができ、
      システムが自動的に最適な検索語を抽出します。</dd>
    <dt class="bold">関連語拡張</dt>
    <dd>適合文書のフィードバックにより
      自動的に関連性の高い検索語を追加することができます。</dd>
    <dt class="bold">言語サポート</dt>
    <dd>日本語、英語の2言語に対応しています。</dd>
  </dl>

  <h4><a id="secintro22">RDBMSとしての主な特徴</a></h4>

  <p class="first">DoqueDBはRDBMSとして非常に重要な以下の機能を有しています。</p>

  <dl>
    <dt class="bold">オンラインバックアップ</dt>
    <dd>システムの運用を中断せずにバックアップが可能です。</dd>
    <dt class="bold">自動リカバリー</dt>
    <dd>不慮の電源断などのために
      正常にシステムが終了しなかった場合でも、
      システムの再起動時に自動的にデータベースの整合性を回復します。</dd>
  </dl>

  <p>また、SQLやJDBCを使用したアクセスが可能であり、
    高速に全文検索可能な情報検索アプリケーションを容易に構築できます。</p>

  <h3><a id="secintro3">規約</a></h3>

  <p class="first">本書は、構文、入力例、プログラム等の説明にBNFの記法を用いた表記を使っています。
    BNFにはいくつかの記法がありますが、
    本書は標準SQL:2003で使われているBNFに従っています。
    以下に本書が用いている特殊な意味をもった記号をあげます。</p>

  <dl>
    <dt class="bold">&lt;&gt;</dt>
    <dd>これに囲まれた文字列は、非終端記号を意味します。
      リテラルではありません。たとえば、実際の入力等では、
      その文字列が説明するものに置き換えて入力する必要がります。</dd>
    <dt class="bold">[]</dt>
    <dd>これに囲まれた文字列は、省略可能であることを意味します。</dd>
    <dt class="bold">{}</dt>
    <dd>これに囲まれた文字列は、グルーピングされていることを意味します。</dd>
    <dt class="bold">|</dt>
    <dd>左側の文字列と右側の文字列が、選択可能であることを意味します。</dd>
    <dt class="bold">...</dt>
    <dd>直前の(グルーピングされた)文字列が、1回以上繰り返されることを意味します。</dd>
  </dl>

  <p>また、BNF以外では以下の記号に特殊な意味を持たせています。</p>

  <dl>
    <dt class="bold">「」</dt>
    <dd>前後の文字列との区切りを明確にしたいときに加えて、
      これに囲まれた文字列は、リテラルであることを意味します。(非終端記号は除きます)</dd>
    <dt class="bold">、</dt>
    <dd>読点としての使用に加えて、
      列挙されたリテラルを区切るために使うことがあります。</dd>
  </dl>

  <h2><a id="sec1">1章 全文索引チュートリアル</a></h2>

  <p class="first">本章では、データベースの基本的な知識を持つ人を対象として、
    <a href="#sec101">全文索引</a>の簡単な使用方法を記載しています。
  </p>

  <p>DoqueDBには豊富な全文検索機能があります。
    全文検索は、全文索引を定義することにより利用可能となります。
    全文索引は転置ファイル形式の索引ファイルになっており、
    確率モデルに基くスコアを取得することができます。
    詳細については、<a href="#secapp">附録</a>の<a href="#secapph">全文索引の使い方</a>を参照してください。</p>

  <h3><a id="sec101">1.1 書式</a></h3>

  <p class="first">全文索引は、文字列型または配列文字列型のカラムに定義することができます。
    SQL構文は以下のようになっています。</p>

  <pre class="example">
create fulltext index &lt;索引名&gt; &lt;表名&gt; on &lt;索引要素リスト&gt;
 [ &lt;言語列指定&gt; ] [ &lt;スコア調整列指定&gt; ] [ &lt;ヒント句&gt; ] [ &lt;索引エリア句&gt; ]
</pre>

  <dl>
    <dt class="bold">&lt;索引要素リスト&gt;</dt>
    <dd>文字列型または配列文字列型のカラムを指定します。
      B+木索引と違い複合索引は定義できません。</dd>
    <dt class="bold">&lt;言語列指定&gt;</dt>
    <dd>LANGUAGE型のカラムを指定します。</dd>
    <dt class="bold">&lt;スコア調整列指定&gt;</dt>
    <dd>float型のカラムを指定します。</dd>
    <dt class="bold">&lt;ヒント句&gt;</dt>
    <dd>全文索引の動作を規定するための情報を指定します。</dd>
    <dt class="bold">&lt;索引エリア句&gt;</dt>
    <dd>現在のバージョンでは未サポートです。</dd>
  </dl>

  <p>詳細については、<a href="#sec60602">全文索引定義</a>と<a href="#sec60505">ヒント句</a>を参照してください。</p>

  <h3><a id="sec102">1.2 索引タイプ</a></h3>

  <p class="first">全文索引は3つの索引タイプをサポートしており、
    索引タイプによって検索動作が変わってきます。</p>

  <dl>
    <dt class="bold">NGRAM</dt>
    <dd>文字列タイプの索引(<a href="#secappa">N-gram索引</a>)で、文字列検索を行えます。</dd>
    <dt class="bold">WORD</dt>
    <dd>単語タイプの索引で、単語単位検索を行えます。</dd>
    <dt class="bold">DUAL</dt>
    <dd>文字列と単語の機能を持つ索引です。</dd>
  </dl>

  <p>索引タイプの指定は &lt;ヒント句&gt; で行います。
    たとえば、word索引を定義するには以下のように記述します。</p>

  <pre class="example">
SQL&gt; create fulltext index I on T(C) hint 'inverted=(indexing=word)';
</pre>

  <h3><a id="sec103">1.3 遅延更新</a></h3>

  <p class="first">転置ファイルという構造は、
    その特性上、ファイルサイズが大きくなると更新に非常に時間がかかるようになります。
    DoqueDBの全文索引は、小さいサイズの小転置ファイルと、
    大きなサイズの大転置ファイルを保持し、更新時間の増大を抑えることができます。
    この指定は &lt;ヒント句&gt; で行います。</p>

  <pre class="example">
SQL&gt; create fulltext index I on T(C) hint 'delayed';
</pre>

  <p>遅延更新の指定は、オプションです。
    遅延更新の詳細については<a href="#secappi">全文索引の遅延更新</a>を参照してください。</p>

  <h3><a id="sec104">1.4 ランキング検索</a></h3>

  <p class="first">与えられた検索条件などに合致したものを、
    適合度の順にランキングして提示することができます。
    ランキング検索を行うには、
    検索条件に対する各テキストデータのスコアを計算する関数 score() を
    selectリストに追加します。
    次のSQL文では、表 T の列 data に対し、単語「システム」による
    ランキング検索を行います。</p>

  <pre class="example">
SQL&gt; select rowid, score(data) from T
      where data contains 'システム' order by score(data) desc;
</pre>

  <p>ランキング検索の結果は、仮想的な列 score が追加された行の集合となります。
    列 score には、
    関数 score() が算出した、各テキストデータの検索条件への適合度を示す値が
    入ります。</p>

  <h3><a id="sec105">1.5 自然文検索</a></h3>

  <p class="first">検索条件に自然文を利用する検索を、自然文検索と呼びます。
    自然文検索を行うには、containsオペランドでfreetextを指定します。
    次のSQL文では、
    自然文「リコーの環境保護への取り組み」による自然文検索を行います。</p>

  <pre class="example">
SQL&gt; select rowid, score(data) from T
      where data contains freetext('リコーの環境保護への取り組み')
       order by score(data) desc;
</pre>

  <p>自然文検索の仕組みは以下のようになっています。</p>

  <ol>
    <li>検索語の抽出。
      検索条件である自然文に対して形態素解析を行い、自動的に検索語を抽出する。</li>
    <li>検索語への重み付け。
      抽出された検索語に応じて個々の検索語に重みを付ける。</li>
    <li>検索条件の生成。
      各語をOR演算子で連結した検索条件を生成する。</li>
    <li>ランキング検索の実行。
      得られた検索条件をランキング検索で実行する。</li>
  </ol>

  <h3><a id="sec106">1.6 全文複合索引</a></h3>

  <p class="first">複数のカラムを指定して１つの全文索引を定義することができます。
    これにより、複合索引の対象カラムの任意の組み合わせで擬似的に
    連結した文字列に対して検索することが可能となります。
    たとえば、ある表に、タイトル、要約、本文と３つのカラムがあったとします。
    これまでは、これらのカラムを別々の検索項目としてランキング検索する場合と、
    これらのカラムの文字列を連結したものを対象としてランキング検索する場合があるとき、
    これらのカラムを連結したカラムを用意する必要がありました。
    しかし、この全文複合索引を定義すれば、連結したカラムを用意する必要がなくなり、
    ディスクスペースを節約し、更新処理を高速にすることが可能となります。</p>

  <pre class="example">
SQL&gt; create table T(title nvarchar(128), abstract ntext, body ntext);
SQL&gt; create fulltext index T_ALL on T(title, abstract, body)
       hint 'delayed, inverted=(indexing=dual, tokenizer=DUAL:JAP:ALL:2)';
SQL&gt; select title from T where (title, abstract, body) contains 'システム'
       order by score(title, abstract, body) desc;
</pre>

  <h2><a id="sec2">2章 インストール</a></h2>

  <p class="first">DoqueDBのインストール方法とパッケージ内容を説明します。</p>

  <p>DoqueDBを1つのサーバに複数インストールすることも可能です。
    詳細については、<a href="#secapp">附録</a>の<a href="#secappk">複数インストール</a>を参照してください。</p>

  <h3><a id="sec201">2.1 パッケージ</a></h3>

  <p class="first">DoqueDBのインストールパッケージはdoquedb-&lt;バージョン&gt;.&lt;アーキテクチャー&gt;.tar.gzです。
    パッケージには以下のファイルとディレクトリが含まれています。

  <table>
    <thead>
      <tr>
        <th>ファイル名・<br>ディレクトリ名</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>README.txt</td>
        <td>最初に読むべき文書です。</td>
      </tr>
      <tr>
        <td>conf.sh</td>
        <td>インストールパスや、設定用のパラメーターが記述されているファイルです。</td>
      </tr>
      <tr>
        <td>install.sh</td>
        <td>インストールスクリプトです。
          インストールパス等の情報は、conf.sh を参照しています。</td>
      </tr>
      <tr>
        <td>setup.sh</td>
        <td>インストール後にDoqueDBのセットアップを行うスクリプトです。
          必要なパラメーターがパラメーターファイルに書き込まれ、
          データベースの初期化が行われます。</td>
      </tr>
      <tr>
        <td>unsetup.sh</td>
        <td>アンインストール前にDoqueDBのアンセットアップを行うスクリプトです。
          全データベースを削除します。</td>
      </tr>
      <tr>
        <td>uninstall.sh</td>
        <td>アンインストールスクリプトです。</td>
      </tr>
      <tr>
        <td>doquedb.sh</td>
        <td>DoqueDBデーモンの開始・停止を行うスクリプトDoqueDBの雛形です。
          install.shはこのファイルを参照し、DoqueDBスクリプトを作成します。</td>
      </tr>
      <tr>
        <td>Sqli.sh</td>
        <td>SQLインタプリターであるスクリプトsqliの雛形です。</td>
      </tr>
      <tr>
        <td>UserAdd.sh<br>
          UserDel.sh<br>
          UserPassword.sh</td>
        <td>ユーザー管理を行うスクリプトuseradd, userdel, userpasswordの雛形です。</td>
      </tr>
      <tr>
        <td>load.sh<br>
          unload.sh</td>
        <td>一括ロード/アンロードを行うスクリプトdqload, dqunloadの雛形です。</td>
      </tr>
      <tr>
        <td>dump.sh<br>
          restore.sh</td>
        <td>データベースのバックアップとリストアを行うスクリプトです。
          詳細は <a href="#sec30905">3.9.5 データベースファイルのコピー</a> をご覧ください。</td>
      </tr>
      <tr>
        <td>obj/bin/</td>
        <td>DoqueDBデーモン、SQLインタプリター、ユーザー管理プログラムなどの
          各種実行ファイルが格納されているディレクトリです。</td>
      </tr>
      <tr>
        <td>obj/data/</td>
        <td>形態素解析、異表記正規化、質問処理の辞書が格納されているディレクトリです。</td>
      </tr>
      <tr>
        <td>obj/etc/</td>
        <td>サーバの初期設定ファイルが格納されているディレクトリです。</td>
      </tr>
      <tr>
        <td>obj/java/</td>
        <td>一括ロード/アンロードを実行するjarファイルが格納されているディレクトリです。</td>
      </tr>
      <tr>
        <td>obj/lib/</td>
        <td>DoqueDBの各種ライブラリーが格納されているディレクトリです。
          C++クライアントプログラムを作成する際に使用するライブラリーも格納されています。</td>
      </tr>
      <tr>
        <td>jdbc/<br>
          hibernate/</td>
        <td>JDBCドライバー、Hibernateダイアレクトファイルが格納されているディレクトリです。
          対応するjavadoc形式のリファレンスマニュアルも含まれています。</td>
      </tr>
      <tr>
        <td>doc/</td>
        <td>サンプルプログラムが格納されているディレクトリです。
        </td>
      </tr>
      <tr>
        <td>LICENSE/</td>
        <td>DoqueDBが使用するOSSのライセンス情報が格納されているディレクトリです。
          詳細についてはNOTICE.txtをご覧ください。</td>
      </tr>
    </tbody>
  </table>

  <h3><a id="sec202">2.2 インストール</a></h3>

  <p class="first">DoqueDBのインストール手順を説明します。</p>

  <ul>
    <li>インストール作業はroot権限のあるユーザーで行ってください。</li>
    <li>データベースが格納されるファイルシステムには、
      ext4などのジャーナリングファイルシステムを使ってください。
      それ以外はサポート外です。</li>
  </ul>

  <ol>
    <li>doquedb-&lt;バージョン&gt;.&lt;アーキテクチャー&gt;.tar.gzを展開し、ディレクトリdoquedbに移動します。
      <pre>
$ sudo su -
# tar xvf doquedb-&lt;バージョン&gt;.&lt;アーキテクチャー&gt;.tar.gz
...
# cd doquedb
</pre>
    </li>

    <li>conf.shにはインストール時に必要な各種設定が記述されています。
      必要に応じて内容を変更してください。<br>
      デフォルトのインストールディレクトリは/var/lib/DoqueDB、
      データベースディレクトリは/var/lib/DoqueDB/dbです。
      データベースをほかのファイルシステムに置きたければ、
      databasepathを変更してください。
      <pre>
# vi conf.sh
</pre>
    </li>

    <li>install.shを実行します。
      <pre>
# ./install.sh
Install Objects
</pre>
      必要なファイルが、インストールディレクトリにインストールされます。
    </li>

    <li>setup.shを実行します。データベースの初期化を行います。
      <pre>
# ./setup.sh
Install Mod Parameter
Install Default Parameter
Install System Parameter
Initialize Database
</pre>
      デフォルトのデータベースパスは&lt;インストールディレクトリ&gt;/dbです。
    </li>

    <li>binに移動します。
      デフォルトのbinディレクトリは、&lt;インストールディレクトリ&gt;/binです。
      <pre>
# cd /var/lib/DoqueDB/bin
</pre>
    </li>
    <li>DoqueDBデーモンを開始します。
      引数startを指定して実行すると、DoqueDBデーモンが開始されます。
      DoqueDBデーモンはDoqueDBが提供するサービスの本体です。
      以降ではDoqueDBデーモンの起動・終了を「サービスの起動・終了」と呼ぶことがあります。
      <pre>
# ./doquedb start
SydServer starting (root) ... done.
</pre>
    </li>

    <li>リブート時のための設定を行います。
      リブート時に自動的にDoqueDBデーモンを立ち上げるように設定するには、以下も実行します。
      <pre>
# ln -s /var/lib/DoqueDB/bin/doquedb /etc/rc3.d/S99doquedb
# ln -s /var/lib/DoqueDB/bin/doquedb /etc/rc4.d/S99doquedb
# ln -s /var/lib/DoqueDB/bin/doquedb /etc/rc5.d/S99doquedb
# ln -s /var/lib/DoqueDB/bin/doquedb /etc/rc6.d/K01doquedb
# ln -s /var/lib/DoqueDB/bin/doquedb /etc/rc2.d/K01doquedb
# ln -s /var/lib/DoqueDB/bin/doquedb /etc/rc1.d/K01doquedb
# ln -s /var/lib/DoqueDB/bin/doquedb /etc/rc0.d/K01doquedb
</pre>
    </li>
  </ol>

  <h3><a id="sec203">2.3 インストールファイル</a></h3>

  <p class="first">インストール後のDoqueDBのファイルについて説明します。
    &lt;インストールディレクトリ&gt;以下の構成は以下のようになります。</p>

  <pre class="example">
&lt;インストールディレクトリ&gt;/
 ├ bin/
 │  └ java/
 ├ data/
 ├ db/
 ├ doc/
 │  └ sample/
 ├ etc/
 ├ lib/
 ├ log/
 ├ LICENSE/
 │  └ NOTICE.txt
 ├ README.txt
 └ README_ja.txt
</pre>

  <dl>
    <dt class="bold">bin/</dt>
    <dd>
      実行ファイルなどがインストールされます。
      主な実行ファイルは以下のとおりです。
      <table>
        <thead>
          <tr>
            <th>ファイル名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>doquedb</td>
            <td>DoqueDBデーモン起動スクリプト</td>
          </tr>
          <tr>
            <td>sqli</td>
            <td>SQLインタプリター</td>
          </tr>
          <tr>
            <td>userpassword<br>
              useradd<br>
              userdel</td>
            <td>ユーザー管理コマンド
              <ul>
                <li>パスワード変更</li>
                <li>新規ユーザー作成</li>
                <li>ユーザー削除</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>dqload<br>
              dqunload</td>
            <td>一括ロード/アンロードコマンド</td>
          </tr>
        </tbody>
      </table>
    </dd>

    <dt class="bold">bin/java/</dt>
    <dd>
      JDBCドライバなどのjarファイルがインストールされます。
    </dd>

    <dt class="bold">data/</dt>
    <dd>
      形態素解析と異表記正規化、質問処理に使われる辞書がインストールされます。
      詳細については、<a href="#secapp">附録</a>の<a href="#secappe">異表記正規化辞書</a>、<a href="#secappf">質問処理辞書</a>を参照してください。
    </dd>

    <dt class="bold">db/</dt>
    <dd>
      標準設定でインストールを行うと、ここにデータベースディレクトリが作られます。
    </dd>

    <dt class="bold">doc/</dt>
    <dd>
      パッケージに含まれるサンプルプログラムがコピーされます。
    </dd>

    <dt class="bold">etc/</dt>
    <dd>
      パラメーターファイルがインストールされます。
      各ファイルの説明は以下のとおりです。
      <table>
        <thead>
          <tr>
            <th>ファイル名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>default.conf<br>
              mod.conf<br>
              system.conf</td>
            <td>パラメーターファイル
              <ul>
                <li>DoqueDBパラメーター</li>
                <li>C++標準ライブラリパラメーター</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>user.pswd</td>
            <td>ユーザのパスワード保存ファイル</td>
          </tr>
        </tbody>
      </table>
    </dd>

    <dt class="bold">lib/</dt>
    <dd>
      ライブラリファイルがインストールされます。
      各ファイルの説明は以下のとおりです。
      <table>
        <thead>
          <tr>
            <th>ファイル名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>libSyKernel.so</td>
            <td>DoqueDBカーネル</td>
          </tr>
          <tr>
            <td>libSyDrvAry.so<br>
              libSyDrvBmp.so<br>
              libSyDrvBtr.so, libSyDrvBtr2.so<br>
              libSyDrvFts.so, libSyDrvFts2.so<br>
              libSyDrvInv.so<br>
              libSyDrvKtr.so<br>
              libSyDrvLob.so<br>
              libSyDrvRcd.so, libSyDrvRcd2.so<br>
              libSyDrvVct.so, libSyDrvVct2.so<br>
              libSyDrvCom.so
            </td>
            <td>各種ファイルドライバー<br>
              <ul>
                <li>配列索引ファイル</li>
                <li>ビットマップ索引ファイル</li>
                <li>B木索引ファイル</li>
                <li>全文索引ファイル</li>
                <li>転置ファイルカーネル</li>
                <li>KD木索引ファイル</li>
                <li>LOBファイル</li>
                <li>レコードファイル</li>
                <li>ベクターファイル</li>
                <li>共通部</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>libSyMesEng33e.so<br>
              libSyMesJpn33e.so</td>
            <td>メッセージライブラリー<br>
              <ul>
                <li>英語</li>
                <li>日本語</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>libTrmeister33e.so</td>
            <td>DoqueDBクライアントライブラリー</td>
          </tr>
          <tr>
            <td>libenstem.so<br>
              libunajp.so<br>
              libuna.so
            </td>
            <td>言語処理ライブラリー<br>
              <ul>
                <li>英語ステミング</li>
                <li>形態素解析</li>
                <li>上位層</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>libcommon.so</td>
            <td>C++共通ライブラリー</td>
          </tr>
          <tr>
            <td>libboost_system.so.1.55.0<br>
              libboost_filesystem.so.1.55.0</td>
            <td>Boost C++ライブラリー<br>
              (NOTICE.txtをご覧ください)</td>
          </tr>
        </tbody>
      </table>
    </dd>

    <dt class="bold">log/</dt>
    <dd>
      ログファイルが出力されます。
      各ファイルの説明は以下のとおりです。
      <table>
        <thead>
          <tr>
            <th>ファイル名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>doquedb.log</td>
            <td>ログファイル</td>
          </tr>
          <tr>
            <td>doquedb.pid</td>
            <td>DoqueDBデーモンのプロセスID (起動時に作成されます)</td>
          </tr>
        </tbody>
      </table>
    </dd>
  </dl>

  <h3><a id="sec204">2.4 syslogの使用</a></h3>

  <p class="first">インストール時、DoqueDBのログファイルは、
    /var/lib/DoqueDB/log/doquedb.logに書き出すように設定されます。
    このログファイルは、DoqueDBデーモン起動中にローテートすることができません。
    しかし、DoqueDBはログをsyslogに書き出すことができます。
    この機能を使用して、ログファイルをローテートします。</p>

  <ol>
    <li>DoqueDBパラメーターファイルの修正。
      default.confのエントリーを、以下のように修正します。
      <pre>
Common_MessageOutputError   ModErrorMessage
Common_MessageOutputInfo    ModMessage
</pre>
    </li>

    <li>下位ライブラリーパラメーターファイルの修正。
      mod.confのエントリーを、以下のように修正します。
      <pre>
ModMessageOutputError   4
ModMessageOutputNormal  4
</pre>
    </li>

    <li>syslogの設定変更。
      /etc/syslog.conf (または/etc/rsyslog.conf) に、以下の内容を追加します。
      <pre>
local0.info         /var/log/doquedb.log
</pre>
      さらに、*.err(なければ *.info)のselectorフィールドに、local0.noneを追加します。
      <pre>
*.err;local0.none   /var/log/system.log
</pre>
    </li>

    <li>syslogdの停止。
      syslogdにHUPシグナルを送信します。
      <pre>
# kill -HUP &lt;syslogdのプロセスID&gt;
</pre>
    </li>

    <li>syslogのローテート設定。
      /etc/logrotate.d/syslogの一行目の'{'の直前に、以下の文を追加します。
      <pre>
/var/log/doquedb.log
</pre>
    </li>
  </ol>

  <h3><a id="sec205">2.5 アンインストール</a></h3>

  <p class="first">DoqueDBのアンインストール手順を説明します。</p>

  <ul>
    <li>アンインストール作業は、rootユーザーで行ってください。</li>
  </ul>

  <ol>
    <li>DoqueDBデーモンを停止します。
      <pre>
$ sudo su -
# cd /var/lib/DoqueDB/bin
# ./doquedb stop
SydServer stopping (root) .... done.
</pre>
    </li>

    <li>doquedb-&lt;バージョン&gt;.&lt;アーキテクチャー&gt;.tar.gzを展開します。
      インストール時に展開したものがある場合は不要です。
      <pre>
# tar xvf doquedb-&lt;バージョン&gt;.&lt;アーキテクチャー&gt;.tar.gz
...
# cd doquedb
</pre>
    </li>

    <li>conf.shを変更します。
      conf.shの内容を変更してインストールした場合は、同様に変更します。
      <pre>
# vi conf.sh
</pre>
    </li>

    <li>unsetup.shおよびuninstall.shを実行します。
      <pre>
# ./unsetup.sh
Uninstall Database
# ./uninstall.sh
Uninstall Objects
</pre>
      手動でも削除できます。
      その場合は、&lt;インストールファイル&gt;をすべて削除してください。
      <pre>
# rm -fr /var/lib/DoqueDB
</pre>
    </li>

    <li>リブート時用の設定を削除します。
      リブート時、自動的にDoqueDBデーモンが起動するように設定した場合は、
      その設定ファイルをすべて削除します。
      <pre>
# rm /etc/rc3.d/S99doquedb
# rm /etc/rc4.d/S99doquedb
# rm /etc/rc5.d/S99doquedb
# rm /etc/rc6.d/K01doquedb
# rm /etc/rc2.d/K01doquedb
# rm /etc/rc1.d/K01doquedb
# rm /etc/rc0.d/K01doquedb
</pre>
    </li>
  </ol>

  <h2><a id="sec3">3章 サーバ管理</a></h2>

  <p class="first">DoqueDBのサーバ管理方法を説明します。</p>

  <h3><a id="sec301">3.1 サービスの起動と停止</a></h3>

  <p class="first">サービスを起動あるいは停止したり、
    サービスの状態を確認するにはdoquedbコマンドを使用します。<br>
    doquedbの実行にはroot権限が必要です。</p>
  <pre class="example">
$ sudo su -
#
</pre>

  <p>コマンドの書式を以下に示します。</p>
  <pre class="example">
doquedb { start | stop | restart | status | reload | clean_temporary }
</pre>
  <p>
    オプションの意味は以下のとおりです。

  <dl>
    <dt class="bold">start</dt>
    <dd>
      サービスを起動します。実行結果は以下のようになります。
      <pre class="example">
# /var/lib/DoqueDB/bin/doquedb start
SydServer starting (&lt;実行ユーザー&gt;) ... done.  (サービスが起動した)
  または
SydServer (pid &lt;プロセスID&gt;) is already running.  (サービスはすでに実行中)
</pre>
    </dd>
    <dt class="bold">stop</dt>
    <dd>
      サービスを停止します。
      <pre class="example">
# /var/lib/DoqueDB/bin/doquedb stop
SydServer stopping (&lt;実行ユーザー&gt;) .... done.  (サービスが停止した)
  または
SydServer is not started.  (サービスは実行中でない)
</pre>
    </dd>
    <dt class="bold">restart</dt>
    <dd>
      サービスを再起動します。
      <pre class="example">
# /var/lib/DoqueDB/bin/doquedb restart
SydServer stopping (&lt;実行ユーザー&gt;) .... done.  (サービスが停止した)
SydServer starting (&lt;実行ユーザー&gt;) ... done.  (サービスが起動した)
  または
SydServer is not started.  (サービスは実行中でない)
SydServer starting (&lt;実行ユーザー&gt;) ... done.  (サービスが起動した)
</pre>
    </dd>
    <dt class="bold">status</dt>
    <dd>
      サービスの起動状況を表示します。
      <pre class="example">
# /var/lib/DoqueDB/bin/doquedb status
SydServer (pid &lt;プロセスID&gt;) is running.  (サービスは実行中)
  または
SydServer is not started.  (サービスは実行中でない)
  または
SydServer dead, but &lt;PIDファイル&gt; exists.  (サービスは起動していないがPIDファイルがある)
</pre>
    </dd>
    <dt class="bold">reload</dt>
    <dd>
      パラメーターの変更を起動中のサービスに反映します。
      <pre class="example">
# /var/lib/DoqueDB/bin/doquedb reload
SydServer reload (pid &lt;プロセスID&gt;)  (サービスのリロードを実行した)
  または
SydServer is not started.  (サービスは実行中でない)
</pre>
    </dd>
    <dt class="bold">clean_temporary</dt>
    <dd>
      サービスが起動していないにも関わらず残っている
      DoqueDBデーモンのプロセスIDファイルを削除します。
      <pre class="example">
# /var/lib/DoqueDB/bin/doquedb clean_temporary
SydServer (pid &lt;プロセスID&gt;) is running.  (サービスは実行中)
  または
SydServer is not started.  (サービスは実行中でない)
  または
SydServer dead, but &lt;PIDファイル&gt; exists.  (PIDファイルを削除した)
</pre>
    </dd>
  </dl>

  <h3><a id="sec302">3.2 バージョン</a></h3>

  <p class="first">DoqueDBのサーバのバージョンを確認する方法について説明します。</p>

  <p>確認方法は以下のとおりです。</p>

  <dl>
    <dt class="bold">ログ</dt>
    <dd>サーバ起動時に<a href="#sec311">ログ</a>に出力されます。</dd>
  </dl>

  <p>クライアントについては<a href="#sec4">4章 クライアントインターフェース</a>の<a href="#sec401">バージョン</a>を参照してください。</p>

  <p>なお、上記方法で確認できるバージョン番号と、
    <a href="#sec2">2章 インストール</a>の<a href="#sec201">パッケージ</a>等で使われるバージョン番号の採番方法は異なります。
  </p>

  <h3><a id="sec303">3.3 パラメーター</a></h3>

  <p class="first">DoqueDBで指定できるパラメーターについて説明します。</p>

  <h4><a id="sec30301">3.3.1 パラメーターの格納場所</a></h4>

  <p class="first">パラメーターの格納場所は以下のとおりです。</p>

  <dl>
    <dd>&lt;インストールディレクトリ&gt;/etc/default.conf</dd>
  </dl>

  <h4><a id="sec30302">3.3.2 パラメーターの変更</a></h4>

  <p class="first">パラメーターの変更は、サービスを再起動後に反映されます。
    ただし、以下のパラメーターはサービス再起動しても反映されない場合があります。</p>

  <ul>
    <li>Execution_LikeNormalizedString</li>
  </ul>

  <p>詳細については、<a href="#sec60601">B+木索引定義</a>を参照してください。</p>

  <h4><a id="sec30303">3.3.3 デフォルトで設定されているパラメーター</a></h4>

  <p class="first">インストール時にすでに設定されているパラメーターについて説明します。</p>

  <table>
    <thead>
      <tr>
        <th>パラメーター名</th>
        <th>型</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Schema_DefaultAreaPath</td>
        <td>文字列</td>
        <td>データベースを格納するデフォルトのパス</td>
      </tr>
      <tr>
        <td>Schema_SystemAreaPath</td>
        <td>文字列</td>
        <td>データベースのスキーマ情報を格納するデフォルトのパス</td>
      </tr>
      <tr>
        <td>Trans_TimeStampPath</td>
        <td>文字列</td>
        <td>DoqueDBのタイムスタンプファイルのパス</td>
      </tr>
      <tr>
        <td>Common_UnaResource_1</td>
        <td>文字列</td>
        <td>異表記正規化に使用する辞書のパス</td>
      </tr>
      <tr>
        <td>Inverted_TermResource_0</td>
        <td>文字列</td>
        <td>質問処理に使用する辞書のパス</td>
      </tr>
      <tr>
        <td>Inverted_TermResource_1</td>
        <td>文字列</td>
        <td>質問処理に使用する辞書のパス</td>
      </tr>
      <tr>
        <td>Common_MessageOutputError</td>
        <td>文字列</td>
        <td>エラーレベルのログの出力先</td>
      </tr>
      <tr>
        <td>Common_MessageOutputInfo</td>
        <td>文字列</td>
        <td>情報レベルのログの出力先</td>
      </tr>
      <tr>
        <td>Communication_PortNumber</td>
        <td>数値</td>
        <td>DoqueDBのポート番号</td>
      </tr>
      <tr>
        <td>Server_PasswordFilePath</td>
        <td>文字列</td>
        <td>ユーザーのパスワードを保管するファイルのパス</td>
      </tr>
    </tbody>
  </table>

  <p>異表記正規化辞書、質問処理辞書の詳細については、
    <a href="#secapp">附録</a>の<a href="#secappe">異表記正規化辞書</a>、
    <a href="#secappf">質問処理辞書</a>を参照してください。
  </p>

  <h4><a id="sec30304">3.3.4 チューニング用パラメーター</a></h4>

  <p class="first">チューニング用のパラメーターについて説明します。</p>

  <table>
    <thead>
      <tr>
        <th>パラメーター名</th>
        <th>型</th>
        <th>デフォルト値</th>
        <th>単位</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Buffer_NormalPoolSize</td>
        <td>文字列</td>
        <td>1G</td>
        <td>byte</td>
        <td>通常のデータベースに使用するバッファサイズを指定</td>
      </tr>
      <tr>
        <td>Buffer_ReadOnlyPoolSize</td>
        <td>文字列</td>
        <td>64M</td>
        <td>byte</td>
        <td>読み出し専用データベースに使用するバッファサイズを指定</td>
      </tr>
      <tr>
        <td>Buffer_TemporaryPoolSize</td>
        <td>文字列</td>
        <td>64M</td>
        <td>byte</td>
        <td>一時表に使用するバッファサイズを指定</td>
      </tr>
      <tr>
        <td>Inverted_BatchSizeMax</td>
        <td>文字列</td>
        <td>512M</td>
        <td>byte</td>
        <td>全文索引再構成時に一時的に使用するメモリーのサイズを指定</td>
      </tr>
      <tr>
        <td>Checkpoint_Period</td>
        <td>数値</td>
        <td>1800000</td>
        <td>ミリ秒</td>
        <td>チェックポイントの間隔を指定</td>
      </tr>
    </tbody>
  </table>

  <p>DoqueDBのプロセスは、
    Buffer_NormalPoolSizeで指定したサイズ＋40～100MB程度のメモリを消費します。
    DoqueDB専用マシンでは、Buffer_NormalPoolSizeを
    空き実メモリーの1/2程度に設定してください。
    なお、256MBより小さい値を設定することはできません。</p>

  <p>Buffer_NormalPoolSizeは、挿入データのサイズに制限を与えます。
    この値より1レコードのサイズが大きいデータは挿入できません。
    ただしLOB型は既存のデータに新しいデータを追加することができるので、
    この値より大きいサイズのデータを格納できます。
    詳細については、<a href="#secapp">附録</a>の<a href="#secappc">LOB型の使い方</a>を参照してください。
    また、ビットマップ索引で<a href="#secappj1">異なりデータ数</a>が多いデータも挿入できません。
    詳細については、<a href="#secapp">附録</a>の<a href="#secappj">ビットマップ索引の使い方</a>を参照してください。</p>

  <p>Buffer_TemporaryPoolSizeは、一時表のデータサイズに制限を与えます。
    一時的に保持されるレコードの合計サイズがこの値より大きい一時表は作成できません。</p>

  <p>デフォルトのチェックポイント間隔は30分です。
    しかし、DoqueDBはデータ更新サイズに応じてチェックポイントの間隔を可変にしていますので、
    データ更新が多い場合は、それよりも早くチェックポイントが発生します。</p>

  <p>チェックポイントの間隔を制御するのは Checkpoint_Period ですが、
    チェックポイントの間隔を固定にすることはできません。</p>

  <h4><a id="sec30305">3.3.5 検索用パラメーター</a></h4>

  <p class="first">検索用のパラメーターについて説明します。</p>

  <table>
    <thead>
      <tr>
        <th>パラメーター名</th>
        <th>型</th>
        <th>デフォルト値</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Execution_LikeNormalizedString</td>
        <td>数値</td>
        <td>(下記参照)</td>
        <td>索引を使用しないlike演算処理の正規化方法と、B+木索引の正規化方法を指定する。<dl>
            <dt>0</dt>
            <dd>正規化しない</dd>
            <dt>1</dt>
            <dd>大文字/小文字の同一視、半角カタカナ/全角カタカナの同一視、ひらがな/カタカナの濁点/半濁点の合字処理、半角記号/全角記号の同一視(ASCII範囲の記号のみ)をする</dd>
            <dt>2</dt>
            <dd>(未サポート)</dd>
            <dt>3</dt>
            <dd>上記1に加え、半角全角スペースと、ひらがな/カタカナの同一視をする</dd>
          </dl>
        </td>
      </tr>
    </tbody>
  </table>

  <p>Execution_LikeNormalizedStringのデフォルト値は、
    正規化の適用対象により異なります。
    索引を使用しないLIKE演算処理の正規化方法のデフォルト値は、「0」です。
    B+木索引の正規化方法のデフォルト値は、「1」です。</p>

  <p>B+木索引の正規化は、<a href="#sec60601">B+木索引定義</a>時に&lt;ヒント句&gt;を設定する必要があります。</p>

  <h4><a id="sec30306">3.3.6 ログ用パラメーター</a></h4>

  <p class="first">ログ用のパラメーターについて説明します。</p>

  <table>
    <thead>
      <tr>
        <th>パラメーター名</th>
        <th>型</th>
        <th>デフォルト値</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Plan_TraceOptimizationOutput</td>
        <td>文字列</td>
        <td>0</td>
        <td>アクセスプランの出力先ファイル名<dl>
            <dt>0</dt>
            <dd>出力しない</dd>
          </dl>
        </td>
      </tr>
      <tr>
        <td>Plan_TraceExecutionOutput</td>
        <td>文字列</td>
        <td>0</td>
        <td>実行トレースの出力先ファイル名。実行トレースは主にデータベースを構成するファイルへの入出力操作のログ。<dl>
            <dt>0</dt>
            <dd>出力しない</dd>
          </dl>
        </td>
      </tr>
      <tr>
        <td>Plan_TraceLevel</td>
        <td>数値</td>
        <td>0</td>
        <td>どの程度の詳しさで出力するかをコントロールする数値を指定。数値が大きいほど詳細になる。通常は 2 を指定する。</td>
      </tr>
      <tr>
        <td>Statement_KeepSQLStatement</td>
        <td>文字列</td>
        <td>false</td>
        <td>サーバーが受け取ったSQL文の文字列をパーズ後も保持し続けることを指示<dl>
            <dt>true</dt>
            <dd>保持</dd>
            <dt>false</dt>
            <dd>パーズ後に破棄</dd>
          </dl>
        </td>
      </tr>
      <tr>
        <td>Server_PrintSQLStatement</td>
        <td>文字列</td>
        <td>0</td>
        <td>受け取ったSQL文の文字列の出力先ファイル名<dl>
            <dt>0</dt>
            <dd>出力しない</dd>
          </dl>
        </td>
      </tr>
      <tr>
        <td>Server_PrintParameter</td>
        <td>文字列</td>
        <td>0</td>
        <td>「?」を使ったSQL文やPreparedStatementに対して渡されたパラメーターの出力先ファイル名<dl>
            <dt>0</dt>
            <dd>出力しない</dd>
          </dl>
        </td>
      </tr>
      <tr>
        <td>Server_PrintTime</td>
        <td>文字列</td>
        <td>0</td>
        <td>SQL文1つごとの実行時間の出力先ファイル名<dl>
            <dt>0</dt>
            <dd>出力しない</dd>
          </dl>出力内容は、以下の3つにより構成される。<ul>
            <li>Optimizer Time (最適化にかかった時間)</li>
            <li>Executor Time (実行にかかった時間)</li>
            <li>Worker Time (トータルの時間)</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td>Server_PrintSessionID</td>
        <td>文字列</td>
        <td>0</td>
        <td>セッションIDの出力先ファイル名<dl>
            <dt>0</dt>
            <dd>出力しない</dd>
          </dl>
        </td>
      </tr>
    </tbody>
  </table>

  <h3><a id="sec304">3.4 組込みデータベースと組込み表</a></h3>

  <p class="first">DoqueDBには組込みデータベースと組込み表が用意されています。
    これらを用いて、SQL文でスキーマ情報を取得することができます。</p>

  <h4><a id="sec30401">3.4.1 組込みデータベース</a></h4>

  <p class="first">組込みデータベースとして、以下のものが用意されています。</p>

  <table>
    <thead>
      <tr>
        <th>データベース名</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>$$SYSTEMDB</td>
        <td>ユーザー定義のデータベースを管理する、読み取り専用のメタデータベースです。<br>
          組込み表SYSTEM_DATABASEはこのデータベースからのみ参照できます。
        </td>
      </tr>
      <tr>
        <td>DefaultDB</td>
        <td>デフォルトで用意されている、内容が空のデータベースです。<br>
          任意の目的に利用できますが、削除しないでください。
        </td>
      </tr>
    </tbody>
  </table>

  <h4><a id="sec30402">3.4.2 組込み表</a></h4>

  <p class="first">組込み表として、以下のものが用意されています。
    SYSTEM_DATABASE, SYSTEM_USER, SYSTEM_SESSIONはシステム全体で共有する情報を保持する表です。
    それ以外は個々のデータベースに割り当てられた情報を保持します。
  </p>
  <table>
    <thead>
      <tr>
        <th rowspan="2">表名</th>
        <th rowspan="2">保持する情報</th>
        <th colspan="2">どのデータベースから参照可能か？</th>
      </tr>
      <tr>
        <th>$$SYSTEMDB</th>
        <th>DefaultDB<br>
          ユーザー定義のDB</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>SYSTEM_DATABASE</td>
        <td>システム内のデータベース</td>
        <td>○</td>
        <td>×</td>
      </tr>
      <tr>
        <td>SYSTEM_USER</td>
        <td>システム内のユーザー</td>
        <td>○</td>
        <td>○</td>
      </tr>
      <tr>
        <td>SYSTEM_SESSION</td>
        <td>システムで実行中のセッション</td>
        <td>○</td>
        <td>○</td>
      </tr>
      <tr>
        <td>SYSTEM_PRIVILEGE</td>
        <td>データベースに対するロール</td>
        <td>×</td>
        <td>○</td>
      </tr>
      <tr>
        <td>SYSTEM_TABLE</td>
        <td>データベース内の表</td>
        <td>×</td>
        <td>○</td>
      </tr>
      <tr>
        <td>SYSTEM_COLUMN</td>
        <td>データベース内の列</td>
        <td>×</td>
        <td>○</td>
      </tr>
      <tr>
        <td>SYSTEM_INDEX</td>
        <td>データベース内の索引</td>
        <td>×</td>
        <td>○</td>
      </tr>
      <tr>
        <td>SYSTEM_FILE</td>
        <td>データベースの構成ファイル</td>
        <td>×</td>
        <td>○</td>
      </tr>
    </tbody>
  </table>
  <ul>
    <li>組込み表は削除できません。</li>
    <li>組込み表の内容は、スキーマ操作により更新されます。<br>
      組込み表を直接操作して、行を挿入・削除したり列の値を更新したりすることはできません。</li>
  </ul>
  <p>
    それぞれの組込み表は以下に示す列を持っています。
    列名の [ ] はその列が配列であることを示します。
  </p>

  <dl>
    <dt class="bold">SYSTEM_DATABASE：システム内のデータベース</dt>
    <dd>
      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ROWID</td>
            <td>データベースのID</td>
          </tr>
          <tr>
            <td>Name</td>
            <td>データベースの名称</td>
          </tr>
          <tr>
            <td>Flag</td>
            <td>データベースの属性</td>
          </tr>
          <tr>
            <td>Paths [3]</td>
            <td>データベースのファイルのパス
              <ul>
                <li>データ</li>
                <li>スキーマ</li>
                <li>論理ログ</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>MasterURL</td>
            <td>非同期レプリケーション構成時のマスターデータベースのURL</td>
          </tr>
        </tbody>
      </table>
    </dd>
    <dt class="bold">SYSTEM_USER：システム内のユーザー</dt>
    <dd>
      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>UserID</td>
            <td>ユーザーのID</td>
          </tr>
          <tr>
            <td>Name</td>
            <td>ユーザー名</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>ユーザー種別 (0:スーパーユーザー, 1:一般ユーザー)</td>
          </tr>
        </tbody>
      </table>
    </dd>
    <dt class="bold">SYSTEM_SESSION：システムで実行中のセッション</dt>
    <dd>
      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ClientID</td>
            <td>クライアントのID (データソースごとに決められる)</td>
          </tr>
          <tr>
            <td>HostName</td>
            <td>クライアントのホスト名称</td>
          </tr>
          <tr>
            <td>ConnectedTime</td>
            <td>最初に接続した日時</td>
          </tr>
          <tr>
            <td>ProtocolVersion</td>
            <td>プロトコルバージョン</td>
          </tr>
          <tr>
            <td>CryptMode</td>
            <td>暗号化方式の名称<br>
              ※OSS版では暗号化通信は無効化されています。</td>
          </tr>
          <tr>
            <td>SessionID</td>
            <td>セッションのID</td>
          </tr>
          <tr>
            <td>DatabaseName</td>
            <td>データベースの名称</td>
          </tr>
          <tr>
            <td>UserName</td>
            <td>ユーザーの名称</td>
          </tr>
          <tr>
            <td>SessionStartTime</td>
            <td>セッション開始日時</td>
          </tr>
          <tr>
            <td>StatementType</td>
            <td>実行中のSQL文の種別</td>
          </tr>
          <tr>
            <td>TransactionState</td>
            <td>トランザクションの状態 (NotInProgress:未実行, ReadWrite:更新中, ReadOnly:参照中, VersionUse:版使用中)</td>
          </tr>
          <tr>
            <td>TransactionStartTime</td>
            <td>トランザクション開始日時</td>
          </tr>
          <tr>
            <td>SqlStatement</td>
            <td>実行中のSQL文</td>
          </tr>
        </tbody>
      </table>
    </dd>
    <dt class="bold">SYSTEM_PRIVILEGE：データベースに対するロール</dt>
    <dd>
      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>UserID</td>
            <td>ユーザーのID</td>
          </tr>
          <tr>
            <td>Privilege</td>
            <td>割り当てられているロール名</td>
          </tr>
          <tr>
            <td>ObjectType</td>
            <td>ロールの対象となるオブジェクト種別 (現状は常にnull)</td>
          </tr>
          <tr>
            <td>ObjectID</td>
            <td>ロールの対象となるオブジェクトの名称 (現状は常にnull)</td>
          </tr>
        </tbody>
      </table>
    </dd>
    <dt class="bold">SYSTEM_TABLE：データベース内の表</dt>
    <dd>
      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ROWID</td>
            <td>表のID</td>
          </tr>
          <tr>
            <td>Name</td>
            <td>表の名称</td>
          </tr>
          <tr>
            <td>AreaID [7]</td>
            <td>エリアのID
              <ul class="none">
                <li>[0]：デフォルト</li>
                <li>[1]～[3]：未使用</li>
                <li>[4]：HEAPファイル</li>
                <li>[5]：INDEXファイル (通常の索引ファイル)</li>
                <li>[6]：FULLTEXTファイル (全文検索用の索引ファイル)</li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </dd>
    <dt class="bold">SYSTEM_COLUMNデータベース内の列</dt>
    <dd>
      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ROWID</td>
            <td>列のID</td>
          </tr>
          <tr>
            <td>ParentID</td>
            <td>列が属する表のID</td>
          </tr>
          <tr>
            <td>Name</td>
            <td>列の名称</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>列の種別 (1:ROWID, 2:通常列, 3:定数列, 4:関数列)</td>
          </tr>
          <tr>
            <td>Position</td>
            <td>表の中での列の定義順</td>
          </tr>
          <tr>
            <td>FieldID</td>
            <td>列に対応するFIELDオブジェクトのROWID (通常、クライアントは使わない)</td>
          </tr>
          <tr>
            <td>Default</td>
            <td>列のデータのデフォルト値 (列定義に&lt;DEFAULT句&gt;があった場合)</td>
          </tr>
          <tr>
            <td>Flag</td>
            <td>列の属性 (0:制限なし, 奇数:NOT NULL, 6か7:無制限可変長, 8か9:FIXED, 10か11:VARIABLE)</td>
          </tr>
          <tr>
            <td>MetaData</td>
            <td>文字列配列形式にしたJavaのColumnMetaData</td>
          </tr>
        </tbody>
      </table>
    </dd>
    <dt class="bold">SYSTEM_INDEX：データベース内の索引</dt>
    <dd>
      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ROWID</td>
            <td>索引のID</td>
          </tr>
          <tr>
            <td>ParentID</td>
            <td>索引が属する表のID</td>
          </tr>
          <tr>
            <td>Name</td>
            <td>索引の名称</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>索引の種別 (1:B+木索引, 2:全文索引, 3:ビットマップ索引, 4:配列索引)</td>
          </tr>
          <tr>
            <td>Flag</td>
            <td>索引の属性 (0:何もなし, 1:Unique)</td>
          </tr>
          <tr>
            <td>FileID</td>
            <td>索引の情報を格納するファイルのID</td>
          </tr>
          <tr>
            <td>AreaID [7]</td>
            <td>エリアのID (索引を構成するファイルの置き場所)</td>
          </tr>
          <tr>
            <td>HintString</td>
            <td>索引のヒント情報
            </td>
          </tr>
        </tbody>
      </table>
    </dd>
    <dt class="bold">SYSTEM_FILE：データベースの構成ファイル</dt>
    <dd>
      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ROWID</td>
            <td>ファイルのID</td>
          </tr>
          <tr>
            <td>ParentID</td>
            <td>ファイルが属する表のID</td>
          </tr>
          <tr>
            <td>Name</td>
            <td>ファイルの名称</td>
          </tr>
          <tr>
            <td>Type</td>
            <td>ファイルの種別 (1:レコードファイル, 2:B+木ファイル, 3:全文ファイル, 4:ベクターファイル,<br>
              5:LOBファイル, 6:ビットマップファイル, 7:配列ファイル)</td>
          </tr>
          <tr>
            <td>FileID</td>
            <td>ファイルの生成情報を保持するバイナリデータ (通常、クライアントは使わない)</td>
          </tr>
          <tr>
            <td>AreaID [7]</td>
            <td>エリアのID
              <ul class="none">
                <li>[0]：ファイルの置き場所</li>
                <li>[1]～[6]：未使用</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>FileSize</td>
            <td>データ取得時のファイルサイズ</td>
          </tr>
        </tbody>
      </table>
    </dd>
  </dl>
  <p>
    $$SYSTEMDBおよび「<a href="howtouse.html">使ってみよう</a>」
    のサンプルデータベースに接続して組込み表を表示した例を示します。
    (見やすくするため、適宜空行を挿入してあります。)
  </p>
  <pre style="white-space:pre-wrap">
$ sqli -remote localhost 54321 -user root -password &lt;rootのパスワード&gt; -database '$$SYSTEMDB'

SQL&gt; select * from system_database;
{Name,Flag,Paths,MasterURL}
{DefaultDB,2,(null),(null)}
{sampleSqli,2,(null),(null)}

SQL&gt; select * from system_user;
{UserID,Name,Type}
{0,root,0}
{100,dbadmin,1}
{200,dbuser,1}
{201,abc,1}

SQL&gt; select * from system_session;
{ClientID,HostName,ConnectedTime,ProtocolVersion,CryptMode,SessionID,DatabaseName,UserName, SessionStartTime,StatementType,TransactionState,TransactioStartTime,SqlStatement}
{131,&lt;ホスト名&gt;,2023-06-26 15:27:50.443,4,(null),145,$$SYSTEMDB,root,2023-06-26 15:27:50.444,QueryExpression,VersionUse,2023-06-26 15:28:19.276,select * from system_session}

SQL&gt; exit;

$ sqli -remote localhost 54321 -user root -password &lt;rootのパスワード&gt; -database sampleSqli

SQL&gt; select * from system_privilege;
{UserID,Privilege,ObjectType,ObjectID}
{0,{system_operations,database_operations,data_operations,reference_operations},(null),(null)}
{100,{database_operations,data_operations,reference_operations},(null),(null)}
{200,{data_operations,reference_operations},(null),(null)}

SQL&gt; select * from system_table;
{Name,AreaID}
{AozoraBunko,{4294967295,4294967295,4294967295,4294967295,4294967295,4294967295,4294967295}}

SQL&gt; select * from system_column;
{ParentID,Name,Type,Position,FieldID,Default,Flag,MetaData}
{2,ROWID,1,0,12,size=8,8,{12,int,4,0,0,(null),(null)}}
{2,docId,2,1,16,size=8,9,{12,int,10,0,0,(null),(null)}}
{2,title,2,2,17,size=8,10,{4,nvarchar,256,0,0,(null),(null)}}
{2,lastName,2,3,18,size=8,10,{4,nvarchar,128,0,0,(null),(null)}}
{2,firstName,2,4,19,size=8,10,{4,nvarchar,128,0,0,(null),(null)}}
{2,url,2,5,20,size=8,10,{2,varchar,128,0,0,(null),(null)}}
{2,content,2,6,21,size=8,10,{4,nvarchar,-1,0,0,(null),(null)}}

SQL&gt; select * from system_index;
{ParentID,Name,Type,Flag,FileID,AreaID,HintString}
{2,AozoraBunko_$$PrimaryKey,1,5,25,(null),(null)}
{2,INDEX1,2,0,31,(null),'kwic, delayed, inverted=(normalized=(stemming=false, deletespace=false), indexing=dual, tokenizer=DUAL:JAP:ALL:1 @NORMRSCID:1 @UNARSCID:1)'}

SQL&gt; select * from system_file;
{ParentID,Name,Type,FileID,AreaID,FileSize}
{2,BTR_AozoraBunko_$$PrimaryKey,2,size=259,(null),16384}
{2,RCD_AozoraBunko,1,size=459,(null),24264704}
{2,VCT_AozoraBunko_$$Conversion,4,size=180,(null),32768}
{2,FTS_INDEX1,3,size=1299,(null),19423232}

SQL&gt; exit;
</pre>

  <h3><a id="sec305">3.5 ユーザー</a></h3>

  <p class="first">DoqueDBのユーザーの取扱いについて説明します。</p>

  <h4><a id="sec30501">3.5.1 ユーザー認証</a></h4>

  <p class="first">DoqueDBに接続する際は、ユーザー名とパスワードを指定する必要があります。
    指定方法は<a href="#sec4">4章 クライアントインターフェース</a>を参照してください。</p>

  <h4><a id="sec30502">3.5.2 ユーザー管理</a></h4>

  <p class="first">インストール時は、固定のスーパーユーザー(root)だけが登録されており、
    そのパスワードには初期値(doqadmin)が設定されています。
    パスワードの変更やユーザーの追加削除は、次節以降で説明するコマンドにより行います。
    パスワードは、<a href="#sec30303">デフォルトで設定されているパラメーター</a>のServer_PasswordFilePathが
    示すファイルに保管されます。</p>

  <p>rootは以下の操作を実行できます。</p>

  <ul>
    <li>新規ユーザーの作成</li>
    <li>root以外のユーザーの削除</li>
    <li>任意のユーザーのパスワード変更</li>
  </ul>

  <p>root以外の一般ユーザーは以下の操作を実行できます。</p>

  <ul>
    <li>自身のパスワード変更</li>
  </ul>

  <p>新規に作成するユーザー名には以下の制限があります。</p>

  <ul>
    <li>使用できるのはASCII文字のみです。</li>
    <li>制御文字、空白、コロン、カンマ、ダブルクオートは使用できません。</li>
    <li><a href="#sec60103">キーワード</a>は使用できません。</li>
    <li>最大16文字までです。</li>
  </ul>

  <h4><a id="sec30503">3.5.3 パスワード変更</a></h4>

  <p class="first">パスワードを変更するにはuserpasswordコマンドを使用します。<br>
    コマンドの書式は以下のとおりです。</p>

  <pre class="example">
userpassword -remote &lt;ホスト名&gt; &lt;ポート番号&gt; [-user &lt;ユーザー名&gt; -password &lt;パスワード&gt;] [オプション]
</pre>

  <p>
    一般ユーザーは自身のパスワードを変更できます。
    スーパーユーザー(root)は任意のユーザーのパスワードを変更できます。
    パスワードは対話的に2回の入力が求められます。<br>
    引数の書式と説明は以下のとおりです。</p>

  <dl>
    <dt class="bold">-remote &lt;ホスト名&gt; &lt;ポート番号&gt;</dt>
    <dd>
      接続するDoqueDBサーバーのホスト名とポート番号を指定します。
    </dd>
    <dt class="bold">-user &lt;ユーザー名&gt; -password &lt;パスワード&gt;</dt>
    <dd>
      スーパーユーザーとして実行する場合、
      スーパーユーザーのユーザー名(root)とパスワードを指定します。
    </dd>
    <dt class="bold">-chusername &lt;ユーザー名&gt;</dt>
    <dd>
      スーパーユーザーとして実行する場合、パスワードを変更するユーザー名を指定します。
      省略すると起動後に入力を促すプロンプトが表示されます。
    </dd>
    <dt class="bold">-help</dt>
    <dd>
      コマンドの使用方法が表示されます。
    </dd>
  </dl>

  <p>一般ユーザーが自身のパスワードを変更する例を以下に示します。</p>

  <pre class="example">
$ userpassword -remote localhost 54321
User: &lt;ユーザー名&gt;
Password: &lt;現在のパスワード&gt;
New password: &lt;新しいパスワード&gt;
Retype new password: &lt;パスワード再入力&gt;
Changed a password.
</pre>

  <p>スーパーユーザーが別ユーザーのパスワードを変更する例を以下に示します。</p>

  <pre class="example">
$ userpassword -remote localhost 54321 -user root -password &lt;rootのパスワード&gt;
user name to change a password: &lt;パスワードを変更するユーザー名&gt;
New password: &lt;パスワード&gt;
Retype new password: &lt;パスワード再入力&gt;
Changed a password.
</pre>

  <h4><a id="sec30504">3.5.4 新規ユーザー作成</a></h4>

  <p class="first">新規ユーザーを作成するにはuseraddコマンドを使用します。
    useraddコマンドを実行できるのはスーパーユーザーだけです。<br>
    コマンドの書式は以下のとおりです。</p>

  <pre class="example">
useradd -remote &lt;ホスト名&gt; &lt;ポート番号&gt; -user &lt;ユーザー名&gt; -password &lt;パスワード&gt; [オプション]
</pre>

  <p>引数の書式と説明は以下のとおりです。</p>

  <dl>
    <dt class="bold">-remote &lt;ホスト名&gt; &lt;ポート番号&gt;</dt>
    <dd>
      接続するDoqueDBサーバーのホスト名とポート番号を指定します。
    <dt class="bold">-user &lt;ユーザー名&gt; -password &lt;パスワード&gt;</dt>
    <dd>
      スーパーユーザーのユーザー名(root)とパスワードを指定します。</dd>
    <dt class="bold">-username &lt;ユーザー名&gt;</dt>
    <dd>
      新規作成するユーザー名を指定します。
      省略すると起動後に入力を促すプロンプトが表示されます。
    <dt class="bold">-userid &lt;ユーザーID&gt;</dt>
    <dd>
      新規作成するユーザーのユーザーIDを指定します。
      省略すると起動後に入力を促すプロンプトが表示されます。
      何も入力せずに「Enter」を押すと、ユーザーIDが自動的に割り振られます。
    <dt class="bold">-help</dt>
    <dd>
      コマンドの使用方法が表示されます。</dd>
  </dl>

  <p>
    新規作成されたユーザーにはパスワードとロールが設定されていません。
    userpasswordコマンドでパスワードを設定してください。
    ロールは、あるデータベースに対してそのユーザーがもつ操作権限を示します。
    ロールの設定については<a href="#sec30506">3.5.6 ユーザー権限管理</a>を参照してください。<br>
    新規ユーザーの作成とパスワードの設定、またロールの設定を行う例を以下に示します。
  </p>

  <pre class="example">
$ useradd -remote localhost 54321 -user root -password &lt;rootのパスワード&gt;
add user: newuser
user id: &lt;Enter&gt;
Create a user.
$ userpassword -remote localhost 54321 -user root -password &lt;rootのパスワード&gt;
user name to change a password: newuser
New password: &lt;パスワード&gt;
Retype new password: &lt;パスワード再入力&gt;
Changed a password.
$ sqli -remote localhost 54321 -user root -password &lt;rootのパスワード&gt; -database &lt;データベース名&gt;
SQL&gt; grant data_operations,reference_operations to newuser;
SQL&gt; exit;
</pre>

  <h4><a id="sec30505">3.5.5 ユーザー削除</a></h4>

  <p class="first">ユーザーを削除するにはuserdelコマンドを使用します。
    userdelコマンドを実行できるのはスーパーユーザーだけです。<br>
    コマンドの書式は以下のとおりです。</p>

  <pre class="example">
userdel -remote &lt;ホスト名&gt; &lt;ポート番号&gt; -user &lt;ユーザー名&gt; -password &lt;パスワード&gt; [オプション]
</pre>

  <p>引数の書式と説明は以下のとおりです。</p>

  <dl>
    <dt class="bold">-remote &lt;ホスト名&gt; &lt;ポート番号&gt;</dt>
    <dd>
      接続するDoqueDBサーバーのホスト名とポート番号を指定します。
    <dt class="bold">-user &lt;ユーザー名&gt; -password &lt;パスワード&gt;</dt>
    <dd>
      スーパーユーザーのユーザー名(root)とパスワードを指定します。</dd>
    <dt class="bold">-username &lt;ユーザー名&gt;</dt>
    <dd>
      削除するユーザー名を指定します。
      省略すると起動後に入力を促すプロンプトが表示されます。
    <dt class="bold">-revoke</dt>
    <dd>
      削除ユーザーのすべてのデータベースに対する権限を削除します。
      省略すると起動後に入力を促すプロンプトが表示されます。
    <dt class="bold">-help</dt>
    <dd>
      コマンドの使用方法が表示されます。</dd>
  </dl>

  <p>実行例を以下に示します。</p>

  <pre class="example">
$ userdel -remote localhost 54321 -user root -password &lt;rootのパスワード&gt;
delete user: &lt;削除するユーザー名&gt;
The authority of all DB is deleted automatically.
OK? [y/n]: y
Delete a user.
</pre>

  <h4><a id="sec30506">3.5.6 ユーザー権限管理</a></h4>

  <p class="first">各データベースには以下のロールが定義されています。</p>

  <ul>
    <li>system_operations</li>
    <li>database_operations</li>
    <li>data_operations</li>
    <li>reference_operations</li>
  </ul>

  <p>これらのロールを一般ユーザーに割り当てることで、
    一般ユーザーが実行できるSQL文を制御します。
    SQL文と権限の関係は以下のとおりです。</p>

  <table>
    <thead>
      <tr>
        <th rowspan=2>SQL文</th>
        <th rowspan=2>スーパーユーザー</th>
        <th colspan=5>一般ユーザー</th>
        <!-- <th></th> -->
        <!-- <th></th> -->
        <!-- <th></th> -->
        <!-- <th></th> -->
      </tr>
      <tr>
        <!-- <td></td> -->
        <!-- <td></td> -->
        <td>system_<br>operations</td>
        <td>database_<br>operations</td>
        <td>data_<br>operations</td>
        <td>reference_<br>operations</td>
        <td>ロールなし</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>CREATE DATABASE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>MOUNT</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DISCONNECT</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DROP DATABASE</td>
        <td>○</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>ALTER DATABASE</td>
        <td>○</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>UNMOUNT</td>
        <td>○</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>START BACKUP</td>
        <td>○</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>END BACKUP</td>
        <td>○</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>GRANT</td>
        <td>○</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>REVOKE</td>
        <td>○</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>CREATE TABLE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DROP TABLE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>ALTER TABLE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>ALTER INDEX</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>CREATE AREA</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DROP AREA</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>ALTER AREA</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>VERIFY</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>CREATE CASCADE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>ALTER CASCADE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DROP CASCADE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>CREATE PARTITION</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>ALTER PARTITION</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DELETE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>INSERT</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>UPDATE</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>CREATE INDEX</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DROP INDEX</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>CREATE FUNCTION</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DROP FUNCTION</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>SELECT</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>CREATE TABLE(一時表に対して)</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DROP TABLE(一時表に対して)</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DELETE(一時表に対して)</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>INSERT(一時表に対して)</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>UPDATE(一時表に対して)</td>
        <td>○</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>○</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>SELECT(データベース一覧に対して)</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
      </tr>
      <tr>
        <td>START TRANSACTION</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
      </tr>
      <tr>
        <td>COMMIT</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
      </tr>
      <tr>
        <td>ROLLBACK</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
      </tr>
      <tr>
        <td>SYNC</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
      </tr>
      <tr>
        <td>CHECKPOINT</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
        <td>○</td>
      </tr>
    </tbody>
  </table>

  <p>以下の点に注意してください。</p>

  <ul>
    <li>作成された直後の一般ユーザーには、ロールは割り当てられていません。</li>
    <li>ロールに包含関係はありません。
      たとえば、database_operations のロールを割り当てられていても
      reference_operations がなければ SELECT文を実行できません。</li>
    <li>ロールとSQL文の対応は固定です。</li>
  </ul>

  <p>一般ユーザに対するロールの付与と削除は、
    rootやsystem_operationsのロールを持つユーザーであれば、
    SQLのGRANT文で行うことができます。
    詳細については<a href="#sec607">権限管理</a>を参照してください。<br>
    以下の点に注意してください。</p>

  <ul>
    <li>rootのロールは固定です。変更できません。</li>
    <li>権限の変更結果は、対象ユーザーが次に接続したときから適用されます。
      変更時に対象ユーザーが接続中であった場合は、
      その接続を切るまでの間、変更前の権限が適用されます。</li>
  </ul>

  <h3><a id="sec306">3.6 多言語対応</a></h3>

  <p class="first">DoqueDBのデータベース名などには、マルチバイト文字が使えます。
    また、NCHAR、NVARCHARなどの国際文字列型の列には、多国語のデータを格納できます。</p>

  <p>しかし、DoqueDBが検索においてもサポートしている言語、
    すなわち<a href="#secappe">異表記正規化辞書</a>をもつのは、
    日本語と英語の2言語に限られます。

  <p>全文索引作成時にどの言語の異表記正規化辞書を使うかは、
    索引作成時の言語指定や異表記正規化辞書の明示的な指定によって決まります。
    ここで、たとえば言語指定と索引を作成する列データの言語が合わないと、
    単語への切り出しや異表記正規化のルールも合わないことになります。
    しかし、索引の作成でエラーにはなりません。
    合わないなりに何らかの切り出しが行われ、索引が作成されます。
    この場合は、検索するとき、
    言語指定や使用する異表記正規化辞書を索引作成時と同じにすると、
    ヒットする可能性が高くなります。
    なお、全文索引作成時や検索で、言語指定などがされないときは、
    &lt;<a href="#sec60505">ヒント句</a>&gt;の&lt;UNAリソース指定&gt;で指定された辞書のデフォルト言語が使用されます。</p>

  <p>また、<a href="#secapph5">全文索引の自然文検索</a>は英語と日本語のみのサポートです。</p>

  <h3><a id="sec307">3.7 データベース構成ファイル</a></h3>

  <p class="first">DoqueDBのデータベースを構成するファイルについて説明します。</p>

  <h4><a id="sec30701">3.7.1 データベースパス</a></h4>

  <p class="first">DoqueDBのデータベースを構成するファイルは、
    <a href="#sec30303">デフォルトで設定されているパラメーター</a>の
    Schema_DefaultAreaPath、Schema_SystemAreaPath、Trans_TimeStampPath
    が指定するパスに作成されます。
  </p>

  <p>個々のデータベースのパスを指定したい場合は、<a href="#sec60501">データベース定義</a>を参照してください。
    個々のデータベースのパスを変更したい場合は、
    <a href="#sec60506">データベース定義変更</a>を参照してください。
  </p>

  <p>個々の表や索引のパスを指定したい場合は、エリアを使います。
    <a href="#sec60502">エリア定義</a>、<a href="#sec60503">表定義</a>、<a href="#sec606">索引定義</a>を参照してください。
    個々の表や索引のパスを変更したい場合は、
    <a href="#sec60507">エリア定義変更</a>、<a href="#sec60508">表定義変更</a>、<a href="#sec60605">索引定義変更</a>を参照してください。
  </p>

  <h4><a id="sec30702">3.7.2 ファイル数</a></h4>

  <p class="first">データベースを構成するファイル数は、スキーマに依存します。
    格納データ数には依存しません。</p>

  <h3><a id="sec308">3.8 バックアップ</a></h3>

  <p class="first">DoqueDBのバックアップは、以下の二種類の操作が可能です。</p>

  <table>
    <thead>
      <tr>
        <th>バックアップ方法</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>オンラインバックアップ</td>
        <td>データベースへのアクセスを許したままのバックアップ。特徴は以下のとおりです。<ul>
            <li>サービスの24時間運転が可能になる</li>
            <li>バックアップにかかる時間が長くなる</li>
            <li>バックアップ中のデータベースに対する操作が遅くなる</li>
            <li>コピーを行うバックアップツールがファイルを排他的にオープンするようなタイプの場合、データベースに対する操作がエラーになる可能性がある</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td>オフラインバックアップ</td>
        <td>データベースへのアクセスを停止してのバックアップ。特徴は以下のとおりです。
          <ul>
            <li>比較的簡単にバックアップの実行ができる</li>
            <li>バックアップ中のデータベース操作ができない。</li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>

  <p>
    本節では、オンラインおよびオフラインによるバックアップ手順と、
    バックアップしたデータベースを通常の方法でリストアする手順、
    また正常ではない手順で取得されたバックアップファイルを
    強制的にリストアする手順を説明します。</p>

  <h4><a id="sec30801">3.8.1 オンラインバックアップ</a></h4>

  <p class="first">オンラインバックアップは以下の手順で実施します。</p>

  <ol>
    <li>トランザクションの開始。<br>
      ロールフォワードリカバリを行うためには、discard snapshotオプションをつけて
      実行する必要があり、そのためには read write トランザクションを実行する
      必要があります。
      <pre>
SQL&gt; start transaction read write;
</pre>
    </li>

    <li>start backup文の実行。<br>
      上記1.で開始したトランザクション内で実行します。
      <pre>
SQL&gt; start backup discard snapshot;
</pre>
      start backup文の返り値として、
      コピーすべきディレクトリのパス名一覧が取得できます。
    </li>

    <li>外部ツールによるコピー。<br>
      上記1.で開始したトランザクションが継続している状態で、
      外部ツールによりデータベースを構成するファイルをコピーします
      (<a href="#sec30805">3.8.5 データベースファイルのコピー</a>)。
    </li>
    <li>end backup文の実行。
      コピーが完了したら1.で開始したトランザクション内で実行します。
      <pre>
SQL&gt; end backup;
</pre>
    </li>

    <li>トランザクションの終了。
      <pre>
SQL&gt; commit;
</pre>
    </li>
  </ol>

  <h4><a id="sec30802">3.8.2 オフラインバックアップ</a></h4>

  <p class="first">データベース「DB」をオフラインバックアップする手順を以下に示します。</p>

  <ol>
    <li>データベースのoffline化。<br>
      対象となるデータベースをロックしているトランザクションが存在する場合にはエラーになります。
      <pre>
SQL&gt; alter database DB offline;
</pre>
    </li>
    <li>外部ツールによるコピー。<br>
      データベースを構成するファイルをコピーします
      (<a href="#sec30805">3.8.5 データベースファイルのコピー</a>)。
    </li>
    <li>データベースのonline化。
      <pre>
SQL&gt; alter database DB online;
</pre>
    </li>
  </ol>

  <p>オンライン、オフラインにかかわらず、
    ファイルのコピーには外部ツールを用いる必要があります。</p>

  <h4><a id="sec30803">3.8.3 オフラインバックアップ(2)</a></h4>

  <p class="first">データベース「DB」をアンマウントしてオフラインバックアップすることもできます。</p>

  <ol>
    <li>unmount文の実行。
      <pre>
SQL&gt; unmount DB;
</pre>
      unmount文の返り値として、コピーすべきディレクトリーのパス名一覧が取得できます。
    </li>
    <li>外部ツールによるコピー。<br>
      データベースを構成するファイルをコピーします
      (<a href="#sec30805">3.8.5 データベースファイルのコピー</a>)。
    </li>
    <li>mount文の実行。<br>
      コピーが完了したら以下を実行します。
      <pre>
SQL&gt; mount DB path '/{インストールディレクトリ}/db/data/DB'
        logicallog '/{インストールディレクトリ}/db/data/DB'
        system '/{インストールディレクトリ}/db/system/DB';
</pre>
      データベースの作成時と異なり、mountに渡すパスはデータパス、論理ログパス、システムパスのすべてを指定する必要があります。
      データパス、システムパスが誤っていてもエラーになりません。
      データがまったく登録されていない、あるいは表がまったく定義されていないものと解釈されます。
    </li>
  </ol>

  <h4><a id="sec30804">3.8.4 リストア手順</a></h4>

  <p class="first">DoqueDBではバックアップファイルに対して以下の2種類の操作が可能です。</p>

  <dl>
    <dt class="bold">リストア</dt>
    <dd>運用中のデータベースの内容を破棄してバックアップした時点に戻す操作</dd>
    <dt class="bold">マウント</dt>
    <dd>運用中のデータベースの内容を保持したまま、
      バックアップした時点のデータベースを新たなデータベースとして別途登録する操作</dd>
  </dl>

  <p>また、オンラインバックアップとオフラインバックアップの
    どちらのバックアップ操作で得られたバックアップファイルに対しても
    同様の操作でリストアまたはマウントが可能です。</p>

  <p>データベース「DB」をリストアする手順を以下に示します。</p>

  <ol>
    <li>リストア対象のデータベースを破棄します。<br>
      drop database文により破棄した場合、
      これ以降のリストア処理が失敗するとDBの内容は完全に失われます。
      <pre>
SQL&gt; drop database DB;
</pre>
      それを避けたい場合は、drop database文の代わりに
      unmount文を実行してからデータベースを構成するファイルを退避してください。
      <pre>
SQL&gt; unmount DB;
</pre>
    </li>

    <li>バックアップしたデータベースのコピー。<br>
      外部ツールによりバックアップファイルをデータベースパスの位置に戻します
      (<a href="#sec30805">3.8.5 データベースファイルのコピー</a>)。
    </li>
    <li>mount文の実行。
      <pre>
SQL&gt; mount DB path '/{インストールディレクトリ}/db/data/DB'
        logicallog '/{インストールディレクトリ}/db/data/DB'
        system '/{インストールディレクトリ}/db/system/DB';
</pre>
    </li>
  </ol>

  <p>マウントは以下の手順で実施します。</p>

  <ol>
    <li>バックアップファイルをコピーします。<br>
      外部ツールにより、バックアップファイルをバックアップ時とは異なる場所
      (たとえばnewDBフォルダ)にコピーします
      (<a href="#sec30805">3.8.5 データベースファイルのコピー</a>)。
    </li>
    <li>mount文の実行。
      新しいデータベース名「newDB」を用いて実行します。
      <pre>
SQL&gt; mount newDB path '/{インストールディレクトリ}/db/data/newDB'
        logicallog '/{インストールディレクトリ}/db/data/newDB'
        system '/{インストールディレクトリ}/db/system/newDB';
</pre>
    </li>
  </ol>

  <p>これらの手順は、<a href="#sec30801">オンラインバックアップ</a>にて
    正常な手順で作成されたバックアップファイルに対する手順です。
    正常な手順で作成されていないバックアップファイルに対しては、
    次節に示すように、強制的にリストアする方法があります。</p>

  <h4><a id="sec30805">3.8.5 データベースファイルのコピー</a></h4>

  <p class="first">
    データベースファイルをバックアップあるいはリストアする際に必要なのは、
    データベースパス以下のファイルをまるごと任意のディレクトリにコピーし、
    あるいはその逆を行うことです。
    パッケージにはそのためのスクリプトdump.sh、restore.shが含まれています。
  </p>
  <p>
    dump.shはデータベースパスにあるすべてのファイルを、
    インストールディレクトリの指定したサブディレクトリ(省略時はsave)にコピーします。
    dump.shはインストールディレクトリやデータベースパスを取得するために、
    パッケージディレクトリのconf.shを参照します。
  </p>
  <pre>
$ ./dump.sh
(データベースパス以下のファイルを&lt;インストールディレクトリ&gt;/saveにコピーします。)

$ ./dump.sh backup
(データベースパス以下のファイルを&lt;インストールディレクトリ&gt;/backupにコピーします。)
</pre>
  <p>
    restore.shはインストールディレクトリの指定したサブディレクトリ
    (省略時はsave)にあるすべてのファイルを、データベースパスにコピーします。
    restore.shはインストールディレクトリやデータベースパスを取得するために、
    パッケージディレクトリのconf.shを参照します。
  </p>
  <pre>
$ ./restore.sh
(&lt;インストールディレクトリ&gt;/save以下のファイルをデータベースパスにコピーします。)

$ ./restore.sh backup
(&lt;インストールディレクトリ&gt;/backup以下のファイルをデータベースパスにコピーします。)
</pre>
  <p>
    インストールディレクトリ以外の場所にデータベースファイルをコピーしたり、
    あるいは書き戻したりしたい場合は、dump.shやrestore.shの内容を見て、
    同様の処理を行ってください。
  </p>

  <h4><a id="sec30806">3.8.6 強制リストア手順</a></h4>

  <p class="first">正常な手順で得られたバックアップファイルでないデータベースファイルを用いて、
    強制的にリストアすることができます。
    動作は保証できませんが、たとえば、何らかの原因により
    データベース一覧を管理するメタデータベースが異常な状態になったが、
    個別のデータベースは救いたい、といったケースでは有用です。</p>

  <p>以下の手順で実施します。</p>

  <ol>
    <li>バックアップファイルをコピーします。<br>
      外部ツールにより、正常な手順で得られていないバックアップファイルを
      取得時とは異なる場所(たとえばnewDBフォルダ)にコピーします
      (<a href="#sec30805">3.8.5 データベースファイルのコピー</a>)。
    </li>
    <li>mount文の実行。
      新しいデータベース名「newDB」を用いて
      with recoveryオプション付きで実行します。
      <pre>
SQL&gt; mount newDB path '/{インストールディレクトリ}/db/data/newDB'
        logicallog '/{インストールディレクトリ}/db/data/newDB'
        system '/{インストールディレクトリ}/db/system/newDB' with recovery;
</pre>
    </li>
  </ol>

  <h3><a id="sec309">3.9 自動復旧</a></h3>

  <p class="first">本節では障害発生後の再起動で実施する自動復旧処理について記述します。
    DoqueDBは、プロセスが異常終了した後のプロセス再起動時に、
    自動的にデータベースを使用可能な状態にします。
    管理者の作業は必要ありません。
    以下では自動復旧処理が必要になる具体的なケースと、
    自動復旧処理について説明します。</p>

  <h4><a id="sec30901">3.9.1 Not available</a></h4>

  <p class="first">DoqueDBではプロセスが致命的な異常状態になったときに、
    データベースが壊れるような状態にならないように、
    発生以後のデータベース操作を一切行わなくなります。
    致命的な異常状態になるのは以下のようなケースがあります。</p>

  <ul>
    <li>予期せぬ例外の発生</li>
    <li>トランザクションのロールバックの失敗</li>
    <li>その他何らかのエラー処理の失敗</li>
    <li>自動復旧処理の失敗</li>
  </ul>

  <p>この状態になるとデータベース操作を行おうとしても
    「Database is not available」または「Server is not available」という例外が
    発生して操作できません。
    この状態になっていることは、ログをチェックすることで確認できます。</p>

  <p>Not availableな状態は正常に動作している状態ではないので、
    このプロセスの終了は異常終了であり、
    終了後の再起動で自動復旧が行われることになります。</p>

  <h4><a id="sec30902">3.9.2 終了処理なしのプロセスの終了</a></h4>

  <p class="first">DoqueDBプロセスが正常終了した場合、終了処理の中で論理ログにその旨記録します。
    終了処理が行われないでプロセスが終了した場合、
    次のプロセスの起動時に前回異常終了したと判断され、自動復旧が行われます。
    終了処理が行われないのは以下のようなケースがあります。</p>

  <ul>
    <li>サーバーホストの急な停止

      <ul>
        <li>急な電源断</li>
        <li>OSの異常動作</li>
        <li>ハードの異常</li>
      </ul>
    </li>
    <li>終了処理のタイムアウト

      <ul>
        <li>OSシャットダウン時にOSがすべてのサービスを停止しようとするが、
          サービスプロセスの終了処理に時間がかかったために、
          タイムアウトによるプロセスの強制終了</li>
      </ul>
    </li>
  </ul>

  <h4><a id="sec30903">3.9.3 自動復旧処理</a></h4>

  <p class="first">自動復旧処理は以下のような手順で行われます。</p>

  <ol>
    <li>サービスの起動。</li>
    <li>論理ログのチェック。
      最後尾に正常終了したことを示す記録がなければ、
      以降の復旧処理を開始する。</li>
    <li>論理ログのスキャン。
      論理ログを最後からスキャンし、
      整合性の取れたデータがファイルにフラッシュされている時点
      (最後から2つ目のチェックポイント処理)を求める。</li>
    <li>データベースイメージの復旧。
      物理ログを使用して、3.で求めた時点に戻す。</li>
    <li>UNDO処理。
      論理ログをスキャンして、3.で求めた時点に実行中のトランザクションで、
      異常終了時までにコミットされなかったものの中で実行された更新操作を取り消す。</li>
    <li>REDO処理。
      論理ログをスキャンして、3.で求めた時点に実行中のトランザクションで
      異常終了時までにコミットされたものの中で実行された更新操作を再実行する。</li>
  </ol>

  <p>上記手順の結果、異常終了時までにコミットされていたトランザクションが
    実行された状態に回復します。 自動復旧が正常に実行されたかどうかは
    ログにDatabase recoveredと出力されたことで確認できます。</p>

  <h3><a id="sec310">3.10 ロールフォワードリカバリ</a></h3>

  <p class="first">
    ロールフォワードリカバリは、バックアップとロールフォワードリカバリログから
    データベースを最新の状態に復旧するための機能です。
    ロールフォワードリカバリはデータベース単位でON/OFFすることができます。
    本節ではロールフォワードリカバリの使用方法について説明します。</p>

  <h4><a id="sec31001">3.10.1 データベース属性の変更</a></h4>

  <p class="first">データベースはデフォルトの状態では、ロールフォワードリカバリ機能が
    OFFになっています。ロールフォワードリカバリ機能をONにするには、
    データベースのリカバリ属性を FULL に変更する必要があります。</p>

  <pre class="example">
SQL&gt; alter database TEST recovery full;
</pre>

  <p>データベース作成時に指定することも可能です。</p>

  <pre class="example">
SQL&gt; create database TEST recovery full;
</pre>

  <p>データベースを一度 unmount すると、リカバリ属性指定は失われます。
    mount 時にリカバリ属性を指定する必要があります。</p>

  <pre class="example">
SQL&gt; mount database TEST path '...' logicallog '...' system '...' recovery full;
</pre>

  <h4><a id="sec31002">3.10.2 ロールフォワードリカバリログ</a></h4>

  <p class="first">データベースのロールフォワードリカバリログは、論理ログと兼用されます。
    よって、データベース作成時の論理ログ格納パス指定で指定したパスにある
    LOGICALLOG.SYD および LOGICALLOGDIR フォルダー内のファイルがそれにあたります。</p>

  <pre class="example">
&lt;論理ログ格納パス&gt;
 ├ LOGICALLOG.SYD
 └ LOGICALLOGDIR/
     ├ LOGFILE1.SYD
     ├ LOGFILE2.SYD
     │  ・
     │  ・
     │  ・
     └ LOGFILEM.SYD
</pre>

  <h4><a id="sec31003">3.10.3 ロールフォワードリカバリのためのバックアップ</a></h4>

  <p class="first">ロールフォワードリカバリでサポートされるバックアップ手段は、以下のものです。</p>

  <ul>
    <li>オフライン状態でバックアップしたしたデータベース</li>
    <li>DISCARD SNAPSHOT でオンラインバックアップしたデータベース</li>
    <li>システム停止中にバックアップしたデータベース</li>
    <li>アンマウント状態でバックアップしたデータベース</li>
  </ul>

  <p>バックアップが成功した場合、それまでのロールフォワードリカバリは
    不要になりますので、古いロールフォワードリカバリログを削除します。</p>

  <ul>
    <li>オンライン時に削除する
      <pre>
SQL&gt; alter database TEST online with discard logicallog;
</pre>
    </li>
    <li>オンラインバックアップ終了時に削除する
      <pre>
SQL&gt; end backup with discard logicallog;
</pre>
    </li>
    <li>マウント時に削除する
      <pre>
SQL&gt; mount TEST path '...' logicallog '...' system '...' with discard logicallog;
</pre>
    </li>
  </ul>

  <h4><a id="sec31004">3.10.4 ロールフォワードリカバリの実行</a></h4>

  <p class="first">適切な手段でバックアップしたデータベースと、別途保存されている
    ロールフォワードリカバリログからロールフォワードリカバリを行う方法を説明します。</p>

  <ol>
    <li>バックアップしたデータベースをコピー
      適切な手段でバックアップしたデータベースをコピーします。</li>
    <li>ロールフォワードリカバリログのコピー
      バックアップ時のロールフォワードリカバリログをいったん削除し、
      最新のログで上書きしてください。</li>
    <li>ロールフォワードリカバリの実行
      ロールフォワードリカバリの実行は mount コマンドで行います。
      <pre>
SQL&gt; mount TEST_R path '...' logicallog '...' system '..' recovery full with recovery;
</pre>
    </li>
  </ol>

  <h3><a id="sec311">3.11 ログ</a></h3>

  <p class="first">何らかの障害が発生したとき、
    DoqueDBが出力するログを見ることは原因究明に役立ちます。
    本節では、アクセスプランやSQL文のトレースを出力する方法を説明します。</p>

  <p>DoqueDBが出力するログの格納場所およびファイル名については、
    <a href="#sec203">インストールファイル</a>を参照してください。
  </p>

  <h4><a id="sec31101">3.11.1 ログ出力設定</a></h4>

  <p><a href="#sec30306">ログ用パラメーター</a>を設定することで、ログに出力する内容を変更することができます。</p>

  <p>たとえば、どのセッションが実行したSQL文かを区別したい場合は、
    以下のパラメーターを設定します。</p>

  <ul>
    <li>Server_PrintSessionID</li>
    <li>Server_PrintSQLStatement</li>
    <li>Server_PrintParameter</li>
    <li>Server_PrintTime</li>
  </ul>

  <p>これらの設定によるパフォーマンスの低下はわずかですので、
    設定されることをおすすめします。</p>

  <p>また、アクセスプランを確認したい場合は、以下のパラメーターを設定します。</p>

  <ul>
    <li>Plan_TraceOptimizationOutput</li>
    <li>Plan_TraceExecutionOutput</li>
    <li>Statement_KeepSQLStatement</li>
  </ul>

  <p>ただし、アクセスプランの出力は、
    パフォーマンスを大きく低下させることに注意してください。</p>

  <h4><a id="sec31102">3.11.2 アクセスプラン</a></h4>

  <p class="first">以下では、アクセスプランの見かたを説明します。</p>

  <p>たとえば以下のように定義されたスキーマがあるとします。</p>

  <pre class="example">
SQL&gt;create table t (f int );
SQL&gt;create index i on t(f);
</pre>

  <p>これに対して普通のselect文を実行すると以下のように出力されます。</p>

  <pre class="example">
SQL&gt;select * from t;
(Output[collection: STREAM]
    (Projection[t.f[retrieve]]
        t
                [ScanPlan
                    (ScanFile(RCD_t))]))
</pre>

  <p>木構造がインデントによって表された形で出ます。
    最後の「ScanPlan」がスキャンアクセスのプランになったことを示し、
    「ScanFile(RCD_t)」がレコードファイルからスキャンしていることを示します。</p>

  <p>order by が付いている場合は以下のようになります。</p>

  <pre class="example">
SQL&gt;select f from t order by f;
(Output[collection: SORTED [1:0]]
    t
            [ScanPlan
                (ScanFile(RCD_t))])
(Output[collection: STREAM]
    (Projection[t.f[retrieve]]
        Input[collection: SORTED [1:0]]))
</pre>

  <p>ソートするために索引を使えないので、
    RCD_tからスキャンしていったん溜めるプランと、
    ソートしたものから取得してクライアントに返すプランの2つがあります。
    「collection: SORTED」は、
    メモリ上でソートするためにいったん貯めていることを意味します。
    「collection: STREAM」は、クライアントに返すことを意味します。</p>

  <p>order by と同時に f に対する条件がついていると以下のようになります。</p>

  <pre class="example">
SQL&gt;select f from t where f &gt; 0 order by f;
(Output[collection: STREAM]
    (Projection[t.f[retrieve]]
        t[order by:(t.f[retrieve])]
                [SearchPlan
                    (SearchFile[cond][sorted](BTR_i)
                           {(GreaterThan
                                t.f
                                0)})]))
</pre>

  <p>今度はソートするために索引を使えるので、
    BTR_i から直に取得するプランだけになります。
    「SearchFile[cond][sorted](BTR_i)」が、
    BTR_i に対して条件が指定され([cond])、ソート順も指定され([sorted])、
    取得されることを示します。</p>

  <h4><a id="sec31103">3.11.3 ログメッセージ</a></h4>

  <p class="first">ここでは主なログメッセージを説明します。
    ログには[INFO]と[ERR]の二種類があります。
    以下に主な[INFO]のログメッセージをあげます。</p>

  <dl>
    <dt class="bold">[INFO] Server initialized</dt>
    <dd>
      サーバーが処理を受け付ける状態になったことを示します。</dd>
    <dt class="bold">[INFO] Server terminated</dt>
    <dd>
      正常終了したことを示します。</dd>
    <dt class="bold">[INFO] Checkpoint occurred</dt>
    <dd>
      チェックポイント処理が行われたことを示します。</dd>
    <dt class="bold">[INFO] Database recovered</dt>
    <dd>
      自動復旧処理が行われ、成功したことを示します。</dd>
  </dl>

  <p>以下に主な[ERR]のログメッセージをあげます。</p>

  <dl>
    <dt class="bold">[ERR] Recovering database ‘&lt;データベース名&gt;’ failed.</dt>
    <dd>
      データベースの自動復旧に失敗したことを示します。
      このログが出ていても、他のデータベースの復旧に成功した場合は
      Database recoveredのログがこの後に出力されます。
      この場合、復旧に失敗したデータベースは使用できませんが、
      他のデータベースは使用できます。</dd>
    <dt class="bold">[ERR] Database ‘&lt;データベース名&gt;' is not available</dt>
    <dd></dd>
    <dt class="bold">[ERR] Server is not available</dt>
    <dd>
      前述のように、これらの出力があったら
      一切の問い合わせを受け付けない状態になっているため、
      サービスの停止および再開が必要です。</dd>
    <dt class="bold">[ERR] Database '&lt;データベース名&gt;' may be corrupted</dt>
    <dd>
      データベースを構成するファイルに整合性がなくなっていることを示します。
      データベースが壊れている可能性が高いです。
      自動復旧を試みた後に再度この出力が出たら壊れていると判断すべきです。</dd>
    <dt class="bold">[ERR] Data in bad page &lt;整数値&gt; of file &lt;パス名&gt;</dt>
    <dd>
      データベースを構成するファイルのうち
      &lt;パス名&gt;の位置に示されるものの中身が不正な状態を示します。
      データベースが壊れている可能性が高いです。
      自動復旧を試みた後に再度この出力が出たら壊れていると判断すべきです。</dd>
    <dt class="bold">[ERR] Not enough space on the disk</dt>
    <dd>
      ディスク容量の不足を示します。</dd>
    <dt class="bold">[ERR] Can’t allocate memory</dt>
    <dd>
      メモリ確保に失敗したことを示します。</dd>
    <dt class="bold">[ERR] Unexpected exception</dt>
    <dd>
      予期せぬ例外が発生したことを意味します。プログラムの不具合の可能性が高いです。
      多くの場合データベースは壊れておらず、自動復旧で回復します。</dd>
  </dl>

  <h2><a id="sec4">4章 クライアントインターフェース</a></h2>

  <p class="first">ここでは、DoqueDBが提供するクライアントインターフェースについて説明します。</p>

  <h3><a id="sec401">4.1 バージョン</a></h3>

  <p class="first">DoqueDBのクライアントのバージョンを確認する方法について説明します。</p>

  <dl>
    <dt class="bold">MANIFEST.MF</dt>
    <dd><a href="#sec403">JDBC</a>のバージョンはdoquedb.jar内のMANIFEST.MFに記載されています。</dd>
  </dl>

  <p>サーバについては<a href="#sec3">3章 サーバ管理</a>の<a href="#sec302">バージョン</a>を参照してください。</p>

  <p>なお、上記方法で確認できるバージョン番号と、
    <a href="#sec2">2章 インストール</a>の<a href="#sec201">パッケージ</a>等で使われるバージョン番号の採番方法は異なります。
  </p>

  <h3><a id="sec402">4.2 sqli</a></h3>

  <p class="first">sqliとは、SQL文を実行するDoqueDBのクライアントコマンドです。
    sqliシェルスクリプトが実行ファイルです。</p>

  <p>sqliの実行方法は以下の3通りあります。</p>

  <ul>
    <li>ファイルを使用した一括実行</li>
    <li>-sqlオプションを使用した一文実行</li>
    <li>上記以外の対話的実行</li>
  </ul>

  <p>また、sqliは複数のクライアントを立ち上げて、
    サーバに同時アクセスすることができます。</p>

  <h4><a id="sec40201">4.2.1 sqliの引数</a></h4>

  <p class="first">以下ではsqliの引数を説明します。
    コマンドの書式は以下のとおりです。</p>

  <pre class="example">
sqli [オプション] [ファイル名]
</pre>

  <p>引数の書式と説明は以下のとおりです。</p>

  <dl>
    <dt class="bold">-remote &lt;ホスト名&gt; &lt;ポート番号&gt;</dt>
    <dd>
      接続するDoqueDBサーバーのホスト名とポート番号を指定します。</dd>
    <dt class="bold">-database &lt;データベース名&gt;</dt>
    <dd>
      接続するデータベース名を指定します。
      省略した場合には、組込みデータベースであるDefaultDBに接続します。
      1つのsqliは、1つのデータベースにしかアクセスできません。</dd>
    <dt class="bold">-user &lt;ユーザー名&gt;</dt>
    <dd>
      接続するユーザー名を指定します。
      省略すると起動後に入力を促すプロンプトが表示されます。</dd>
    <dt class="bold">-password &lt;パスワード&gt;</dt>
    <dd>
      ユーザー認証のためのパスワードを指定します。
      省略すると起動後に入力を促すプロンプトが表示されます。</dd>

    <dt class="bold">-sql &lt;SQL文&gt;</dt>
    <dd>
      コマンドラインに与えられた、SQL文を実行します。</dd>
    <dt class="bold">-code utf-8</dt>
    <dd>
      入出力の文字コードにUTF-8を指定します。
      省略するとEUCが使われます。</dd>

    <dt class="bold">-time</dt>
    <dd>
      1文ごとにその実行時間が出力されます。
      出力される実行時間の分解能はOSに依存します。
      出力される時間は、SQL文をサーバに送信してから、
      すべての結果を取得するまでの時間です。</dd>
  </dl>

  <dl>
    <dt class="bold">ファイル名</dt>
    <dd>
      SQL文およびsqliのコマンドが記述されたファイルを指定します。
      ファイル名と-sqlオプションのどちらも指定されなかった場合は、
      対話的に実行されます。</dd>
  </dl>

  <h4><a id="sec40202">4.2.2 sqliのコマンド</a></h4>

  <p class="first">sqliは、DoqueDBで使用できるすべてのSQL文を実行可能です。
    SQL文の区切りには、&lt;セミコロン&gt;を使用します。</p>

  <pre class="example">
SQL&gt; SELECT * FROM T;
</pre>

  <p>sqliの組込みコマンドとして、exitがあります。
    以下のように入力することによって、sqliを終了できます。</p>

  <pre class="example">
SQL&gt; EXIT;
</pre>

  <p>また、Ctrl+Dでも終了できます。</p>

  <h3><a id="sec403">4.3 JDBC</a></h3>

  <p class="first">DoqueDBのJDBCドライバーについて説明します。
    JDBCドライバーは、DoqueDBサーバーに対して、
    JavaクライアントがJDBCによるアクセスを行うのに必要なドライバーです。
    詳細については、<a href="../doquedb-javadoc/javadoc/index.html">DoqueDB JDBC Driver</a>を参照してください。
  <p>

  <h4><a id="sec40301">4.3.1 JDBCのユーザー認証</a></h4>

  <p class="first">DoqueDBのユーザー認証は以下のメソッドを使います。</p>

  <pre class="example">
java.sql.Driver.connect(url_, info_)
</pre>

  <p>&lt;ユーザー名&gt;および&lt;パスワード&gt;はinfo_のプロパティとして設定します。</p>

  <h4><a id="sec40302">4.3.2 JDBCのURL</a></h4>

  <p class="first">DoqueDBのJDBCのURLは、以下のとおりです。</p>

  <pre class="example">
jdbc:ricoh:doquedb://&lt;ホスト名&gt;:&lt;ポート番号&gt;/&lt;データベース名&gt;
</pre>

  <p>&lt;データベース名&gt;には接続先のデータベース名を指定します。
    create databaseを実行するときは、組み込みデータベースDefaultDBに接続してください。
    &lt;データベース名&gt;を省略するとDefaultDBを指定したことになります。</p>

  <h4><a id="sec40303">4.3.3 JDBCのサンプルプログラム</a></h4>

  <p class="first">JDBCのサンプルプログラムです。</p>

  <pre class="example">
Class.forName(&quot;jp.co.ricoh.doquedb.jdbc.Driver&quot;);
String url = &quot;jdbc:ricoh:doquedb://localhost:54321/DefaultDB&quot;;
String user = &quot;user1&quot;;
String password = &quot;&quot;;
Connection conn = DriverManager.getConnection(url, user, password);
Statement state = conn.createStatement();
ResultSet resultSet = state.executeQuery(&quot;SELECT * FROM T&quot;);
int count = 0;
while (resultSet.next() == true)
    count++;
resultSet.close();
state.close();
conn.close();
System.out.println(&quot;count = &quot; + count);
</pre>

  <h2><a id="sec5">5章 ロード/アンロードコマンド</a></h2>

  <p>JDBC経由でデータをロード/アンロードするコマンドが用意されています。
    これらのコマンドを使うためにはJava実行環境が必要です。
  </p>

  <h3><a id="sec501">5.1 ロードコマンド</a></h3>

  <p>
    ロードコマンドはデータをテーブルにロードします。
    ロードコマンドを実行するには、
    ロードスクリプトファイルとロードするレコードデータファイルが必要です。
  </p>

  <h4><a id="sec50101">5.1.1 実行コマンド</a></h4>

  <p>
    ロードコマンドには引数として、
    レコードデータファイルを記述したスクリプトファイルとデータベース接続情報を指定します。
  </p>
  <p>
    ロードコマンドは&lt;インストールディレクトリ&gt;/binにあります。<br>
    使い方は以下のとおりです。
  </p>
  <pre>
dqload &lt;スクリプトファイル名&gt; &lt;ユーザー名&gt; &lt;パスワード&gt;
</pre>

  <h4><a id="sec50102">5.1.2 スクリプトファイルの作成</a></h4>

  <p>
    スクリプトファイルには、ロードに必要な情報を記述します。
  </p>
  <ul>
    <li>「&lt;キー名&gt;=&lt;値&gt;」の形式で記述します。</li>
    <li>「=」の前後に空白を置くことはできません。</li>
    <li>先頭文字が#の行はコメント行です。</li>
  </ul>
  <p>
    指定できるキーと値は以下のとおりです。
  </p>
  <table>
    <thead>
      <tr>
        <td>キー名</td>
        <td>内容</td>
        <td>デフォルト値</td>
        <td>備考</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>HOSTNAME</td>
        <td>接続先のホスト名</td>
        <td>－</td>
        <td>大文字小文字を区別します。</td>
      </tr>
      <tr>
        <td>PORT</td>
        <td>接続先のポート番号</td>
        <td>－</td>
        <td>数字以外を記述した場合、例外の処理はJDBCに任せます。</td>
      </tr>
      <tr>
        <td>DATABASE</td>
        <td>ロード先のデータベース名</td>
        <td>－</td>
        <td>大文字小文字を区別します。</td>
      </tr>
      <tr>
        <td>FORMAT</td>
        <td>ロードファイル形式</td>
        <td>TEXT</td>
        <td>
          TEXTと記述するとテキスト形式でロードファイルを読み込みます。<br>
          XMLと記述するとXML形式のロードファイルを読み込みます。<br>
          大文字小文字は区別しません。<br>
          FORMATにより読み込む拡張子が異なります。<br>
          TEXTのときは拡張子「.dat」が対象です。<br>
          XMLのときは拡張子「.xml」が対象です。</td>
      </tr>
      <tr>
        <td>DIRECTORY</td>
        <td>ロードファイルがある場所</td>
        <td>カレントディレクトリ</td>
        <td>フルパスで正確に指定してください。<br>
          存在しない場合はエラーになります。</td>
      </tr>
      <tr>
        <td>LOAD_CODE</td>
        <td>ロードする文字コード</td>
        <td>UTF-8</td>
        <td>
          以下のいずれかを指定してください。
          <ul>
            <li>UTF-8</li>
            <li>EUC-JP</li>
            <li>Shift_JIS</li>
          </ul>
          このキーワードはFORMATがTEXTのときのみ有効です。<br>
          FORMATがXMLの場合、XML宣言で指定される文字コードが有効となり、
          本キーワードは無視されます。
        </td>
      </tr>
      <tr>
        <td>FILES</td>
        <td>ロードするファイル名</td>
        <td>DIRECTORYのすべてのファイル</td>
        <td>ロードするファイル名を記述します。
          FILES=以降にあるすべての行のファイル名が対象になります。<br>
          &nbsp;&nbsp;例）FILES=table1.xml table2.xml table3.xml<br>
          &nbsp;&nbsp;例）FILES=<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table1.xml<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table2.xml<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table3.xml<br>
          ファイル名を指定しない場合、
          DIRECTORYで指定したディレクトリにあるすべてのファイルを処理します。<br>
          注意）FILESは最後のキーとして指定してください。<br>
          注意）対象ファイル名はキーワードFORMATの仕様に従ってください。<br>
          備考）DIRECTORYを基準とした相対パスが指定可能ですが、上位パスはサポートしていません。
          たとえば../../table.xmlは対象外です。/data/table.xmlはサポートします。</td>
      </tr>
    </tbody>
  </table>
  <p>
    <a id="load-script-example">ロードスクリプトの記述例</a>を以下に示します。
  </p>
  <ul>
    <li>ローカルマシン、ポート番号54321で、
      データベースCabinet1に２つのテキスト形式ロードファイルをロードします。</li>
  </ul>
  <pre>
#************************************
#* database information
#************************************
HOSTNAME=localhost
PORT=54321
DATABASE=Cabinet1

#************************************
#* FORMAT: load file format
#* text: text file (.dat)
#* xml: xml file (.xml)
#* default: text
#************************************
FORMAT=TEXT

#************************************
#* DIRECTORY: load directory
#* default: current directory
#************************************
DIRECTORY=/work/load

#************************************
#* LOAD_CODE: load file encoding
#* default: system code
#************************************
LOAD_CODE=UTF-8

#************************************
#* FILES: load file
#************************************
FILES=
table1-text.dat
table2-text.dat
</pre>

  <h4><a id="sec50103">5.1.3 ロードファイルの用意</a></h4>

  <p>
    <a href="#sec503">5.3 ロードファイル仕様</a>を参照し、ロードファイルを作成してください。
  </p>
  <ul>
    <li><a href="#sec50301">5.3.1 テキスト形式のロードファイル</a></li>
    <li><a href="#sec50302">5.3.2 XML形式のロードファイル</a></li>
  </ul>

  <h4><a id="sec50104">5.1.4 ロードの実行</a></h4>

  <p>
    実行コマンドを入力します。以下に実行例を示します。
  </p>
  <pre>
$ dqload load_script.txt root &lt;rootのパスワード&gt;
</pre>
  <p>
    実行結果が表示されます。
    エラーが出力された場合は、表示された内容またはロードのログを参考に、
    スクリプトファイルまたはロードファイルを修正してください。
  </p>

  <h4><a id="sec50105">5.1.5 ロードのログ</a></h4>

  <p>
    ロードのログは、load.log.0という名前でカレントディレクトリに保存されます。
    ～.0から～.9の最大10個のファイルをローテーションして使い、
    ひとつのファイルは上限の1MBに達するまで続けて書き込まれます。
    ～.9まで使い切ったときは、～.0を上書きします。
  </p>

  <h3><a id="sec502">5.2 アンロードコマンド</a></h3>

  <p>
    アンロードコマンドはテーブル内のデータをファイルに書き出します。
    アンロードコマンドを実行するには、アンロードスクリプトファイルが必要です。</p>

  <h4><a id="sec50201">5.2.1 実行コマンド</a></h4>

  <p>
    アンロードコマンドには引数として、
    出力するテーブルなどを記述したスクリプトファイルとデータベース接続情報を指定します。
  </p>
  <p>
    アンロードコマンドは&lt;インストールディレクトリ&gt;/binにあります。<br>
    使い方は以下のとおりです。
  </p>
  <pre>
dqunload &lt;スクリプトファイル名&gt; &lt;ユーザー名&gt; &lt;パスワード&gt;
</pre>

  <h4><a id="sec50202">5.2.2 スクリプトファイルの作成</a></h4>

  <p>
    スクリプトファイルには、アンロードに必要な情報を記述します。
  </p>
  <ul>
    <li>「&lt;キー名&gt;=&lt;値&gt;」の形式で記述します。</li>
    <li>「=」の前後に空白を置くことはできません。</li>
    <li>先頭文字が#の行はコメント行です。</li>
  </ul>
  <p>
    指定できるキーと値は以下のとおりです。
  </p>
  <table>
    <thead>
      <tr>
        <td>キー名</td>
        <td>内容</td>
        <td>デフォルト値</td>
        <td>備考</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>HOSTNAME</td>
        <td>接続先のホスト名</td>
        <td>－</td>
        <td>大文字小文字を区別します。</td>
      </tr>
      <tr>
        <td>PORT</td>
        <td>接続先のポート番号</td>
        <td>－</td>
        <td>数字以外を記述した場合、例外の処理はJDBCに任せます。</td>
      </tr>
      <tr>
        <td>DATABASE</td>
        <td>アンロード元のデータベース名</td>
        <td>－</td>
        <td>大文字小文字を区別します。</td>
      </tr>
      <tr>
        <td>FORMAT</td>
        <td>アンロード形式</td>
        <td>TEXT</td>
        <td>
          TEXTと記述するとテキスト形式でアンロードファイルを作成します。<br>
          XMLと記述するとXML形式でアンロードファイルを作成します。<br>
          大文字小文字は区別しません。</td>
      </tr>
      <tr>
        <td>DIRECTORY</td>
        <td>アンロードファイルの出力先</td>
        <td>カレントディレクトリ</td>
        <td>フルパスで正確に指定してください。<br>
          ディレクトリが存在しない場合は作成します。<br>
          作成できない場合のみエラーなります。</td>
      </tr>
      <tr>
        <td>UNLOAD_CODE</td>
        <td>アンロードする文字コード</td>
        <td>UTF-8</td>
        <td>
          以下のいずれかが指定できます。
          <ul>
            <li>UTF-8</li>
            <li>EUC-JP</li>
            <li>Shift_JIS</li>
          </ul>
          このキーワードはFORMATがTEXTのときのみ有効です。<br>
          FORMATがXMLの場合、XML宣言で指定される文字コードが有効となり、
          本キーワードは無視されます。
        </td>
      </tr>
      <tr>
        <td>TABLE</td>
        <td>アンロードするテーブル名</td>
        <td>－</td>
        <td>
          アンロードするテーブル名を記述します。
          TABLE=以降にあるすべての行のテーブル名が対象になります。<br>
          &nbsp;&nbsp;例）TABLE=table1 table2 table3<br>
          &nbsp;&nbsp;例）TABLE=<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table1<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table2<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table3<br>
          バイナリデータなど巨大なデータを別ファイルとしてアンロードすることができます。
          その場合、テーブル名に括弧を付けて括弧内に「列名:拡張子」を記述します。
          たとえばtable1の列cと列eを別ファイルにアンロードするには以下のようにします。<br>
          &nbsp;&nbsp;例）TABLE=table1(c:doc,e:bmp) table2 table3<br>
          このとき、メインのアンロードデータは以下のようになります。<br>
          &nbsp;&nbsp;a,b,/work/table1.1.c.1.doc,d,/work/table1.1.e.1.bmp,f......<br>
          &nbsp;&nbsp;a,b,/work/table1.1.c.2.doc,d,/work/table1.1.e.2.bmp,f......<br>
          注意）TABLEは最後のキーとして指定してください。<br>
          備考）別ファイルのパス名は「DIRECTORYで指定されたディレクトリ/テーブル名.アンロード回数.列名.レコード番号.指定拡張子」となります。
        </td>
      </tr>
    </tbody>
  </table>

  <p>
    アンロードスクリプトの記述例を以下に示します。
  </p>
  <ul>
    <li>ローカルマシン、ポート番号54321で、
      データベースCabinet1のテーブルtable1、table2をアンロードします。</li>
  </ul>
  <pre>
#************************************
#* database information
#************************************
HOSTNAME=localhost
PORT=54321
DATABASE=Cabinet1

#************************************
#* FORMAT: unload file format
#* text: text file (.dat)
#* xml: xml file (.xml)
#* default: text
#************************************
FORMAT=XML

#************************************
#* DIRECTORY: unload directory
#* default: current directory
#************************************
DIRECTORY=/work/unload

#************************************
#* UNLOAD_CODE: unload file encoding
#* default: system code
#************************************
UNLOAD_CODE=UTF-8

#************************************
#* TABLE: table to unload
#************************************
TABLE=
table1(col2:jpg,col3:jpg)
table2
</pre>

  <h4><a id="sec50203">5.2.3 アンロードの実行</a></h4>

  <p>
    実行コマンドを入力します。以下に実行例を示します。
  </p>
  <pre>
$ dqunload unload_script.txt root &lt;rootのパスワード&gt;
</pre>
  <p>
    実行結果が表示されます。
    また、指定ディレクトリ/workの下にアンロードされたファイルが出力されます。
    エラーが出力された場合は、表示された内容またはアンロードのログを参考に、
    スクリプトファイルを修正してください。
  </p>

  <h4><a id="sec50204">5.2.4 アンロードのログ</a></h4>

  <p>
    アンロードのログは、unload.log.0という名前でカレントディレクトリに保存されます。
    ～.0から～.9の最大10個のファイルをローテーションして使い、
    ひとつのファイルは上限の1MBに達するまで続けて書き込まれます。
    ～.9まで使い切ったときは、～.0を上書きします。
  </p>

  <h3><a id="sec503">5.3 ロードファイル仕様</a></h3>

  <p><a href="#sec5">5章 ロード/アンロードコマンド</a>
    で用いるロードファイルの仕様について説明します。
  </p>

  <h4><a id="sec50301">5.3.1 テキスト形式のロードファイル</a></h4>

  <p>
    ロードファイルはヘッダー部とデータ部に分けて記述します。
    拡張子は「.dat」である必要があります。
    全体像は以下のとおりです。
  </p>
  <pre>
&lt;header&gt;
  &lt;ヘッダー部&gt;
&lt;/header&gt;
&lt;データ部&gt;
</pre>
  <dl>
    <dt class="bold">ヘッダー部</dt>
    <dd>
      ヘッダー部は、&lt;header&gt;～&lt;/header&gt;の間に記述します。
      ヘッダー部には、データ挿入先のテーブル名、
      データ部の記述に外部ファイルを使用するか、などを指定します。
      指定する項目は次のとおりです。
      <table>
        <thead>
          <tr>
            <th>項目名</th>
            <th>必須</th>
            <th>デフォルト値</th>
            <th>内容</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>table</td>
            <td>○</td>
            <td>なし</td>
            <td>データ挿入先のテーブル名を指定します。</td>
          </tr>
          <tr>
            <td>column_separator</td>
            <td>○</td>
            <td>なし</td>
            <td>挿入するデータの区切り文字を指定します。</td>
          </tr>
          <tr>
            <td>arrayelement_separator</td>
            <td>×</td>
            <td>なし</td>
            <td>挿入する配列要素の区切り文字を指定します。</td>
          </tr>
          <tr>
            <td>record_separator</td>
            <td>×</td>
            <td>\n</td>
            <td>挿入するレコードの区切り文字を指定します。</td>
          </tr>
          <tr>
            <td>separated_file</td>
            <td>×</td>
            <td>false</td>
            <td>データ部を記述する際に外部ファイルを使用するかどうかを指定します。
              <ul class="none">
                <li>
                  true：外部ファイルを使用します。</li>
                <li>
                  false：外部ファイルを使用しません。</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>extern</td>
            <td>×</td>
            <td>なし</td>
            <td>他のファイルに格納されているデータを挿入する列名を指定します。<br>
              複数の列がある場合は、カンマで区切って記述してください。
            </td>
          </tr>
        </tbody>
      </table>
      <ul>
        <li>項目は「&lt;項目名&gt;=&lt;値&gt;」の形式で指定します。</li>
        <li>区切り文字に改行を指定するときは、イコールの直後に「\n」を記述します。</li>
        <li>改行以外の区切り文字は、イコールの直後にその文字自身を記述します。</li>
      </ul>
    </dd>
    <dt class="bold">データ部</dt>
    <dd>
      データ部には、挿入するデータやデータ格納先のファイル名を区切り文字で区切って記述します。
      <pre>
データA &lt;区切り文字&gt; データB &lt;区切り文字&gt; データC &lt;区切り文字&gt; ...
</pre>
      配列の場合は、配列型の列内のデータを区切り文字で区切ります。
      以下はB列が配列型のデータ列であり、配列要素区切り文字がカンマの場合です。
      <pre>
データA &lt;区切り文字&gt; データB1,データB2,データB3 &lt;区切り文字&gt; データC &lt;区切り文字&gt; ...
</pre>
      <p>
        挿入先のテーブルに列a、b(配列型)、cがあるとき、
        上の例では列aにデータA、列bにデータB1～B3、列cにデータCが挿入されます。
      </p>
      <p>
        次の例では、
        列cにディレクトリ/work/load/imageにあるファイルsample1.jpgのデータが挿入されます。
      </p>
      <pre>
データA &lt;区切り文字&gt; データB &lt;区切り文字&gt; /work/load/image/sample1.jpg
</pre>
      <p>
        ファイル名は絶対パスで指定します。
        このように、他のファイルに格納されたデータを挿入する列は、
        ヘッダー部のexternキーに列名を指定しておきます。
        この場合は「extern=c」となります。
      </p>
      <p>
        ヘッダー部に「separated_file=true」を指定した場合は、外部ファイルを作成し、
        ロードファイルのデータ部には外部ファイル名を絶対パスで指定します。
        外部ファイル/work/load/insertdata.datを作成し、
        列a、b、cにデータA、データB、データCを挿入するときは、次のようにします。
      </p>
      <p>
        ロードファイルのデータ部：
      </p>
      <pre>
/work/load/insertdata.dat
</pre>
      <p>
        外部ファイルinsertdata.dat：
      </p>
      <pre>
データA &lt;区切り文字&gt; データB &lt;区切り文字&gt; データC
</pre>
    </dd>
  </dl>

  <h4>記述例</h4>

  <p>
    テキスト形式のロードファイルの記述例を示します。
    挿入先のテーブルは以下のようなものです。
  </p>
  <pre>
table1 (
    col1 nvarchar(128),
    col2 image,
    col3 image
)
table2 (
    col1 int,
    col2 int array[4],
    col3 int
)
</pre>
  <ul>
    <li>table1の列col2, col3には、他のファイルにあるデータを挿入します。</li>
    <li>挿入データの区切り文字としてタブを指定します。</li>
    <li>配列要素の区切り文字にカンマを指定します。</li>
  </ul>
  <p>
    外部ファイルを使用せずにtable1にロードする場合 (<a href="#load-script-example">table1-text.dat</a>に相当)：
  </p>
  <pre>
&lt;header&gt;
table=table1
column_separator=&lt;タブ文字&gt;
separated_file=false
extern=col2,col3
&lt;/header&gt;
'A100'  /work/load/image/sample1.jpg    /work/load/image/sample2.jpg
'A200'  /work/load/image/sample2.jpg    /work/load/image/sample1.jpg
</pre>
  <p>
    外部ファイルを使用してtable1にロードする場合 (<a href="#load-script-example">table1-text.dat</a>に相当)：
  </p>
  <pre>
&lt;header&gt;
table=table1
column_separator=&lt;タブ文字&gt;
separated_file=true
extern=col2,col3
&lt;/header&gt;
/work/load/data1.dat
</pre>
  <p>
    外部ファイル(/work/load/data1.dat)の内容：
  </p>
  <pre>
'A100'  /work/load/image/sample1.jpg    /work/load/image/sample2.jpg
'A200'  /work/load/image/sample2.jpg    /work/load/image/sample1.jpg
</pre>
  <p>
    配列データをtable2にロードする場合 (<a href="#load-script-example">table2-text.dat</a>に相当)：
  </p>
  <pre>&lt;header&gt;
table=table2
column_separator=&lt;タブ文字&gt;
arrayelement_separator=,
&lt;/header&gt;
10    1,2,3,4    1000
20    101,102,null,null    2000
</pre>
  <ul>
    <li>区切り文字が連続しているときは、文字と文字の間にNULLが入っているものと解釈します。</li>
    <li>区切り文字の後ろにスペースやタブがあると、エラーとなります。</li>
    <li>挿入先の列のデータ型と挿入するデータが合わないときは、エラーとなります。</li>
    <li>外部ファイル名、externキーに指定する列名、挿入データの格納ファイル名が正しくない場合、
      エラーとなります。</li>
    <li>データ部(データまたは外部ファイル名)最終行の後に改行を2つ以上入れると、
      エラーとなります。</li>
  </ul>

  <h3><a id="sec50302">5.3.2 XML形式のロードファイル</a></h3>

  <p>
    ロードファイルはXML宣言で開始し、&lt;sydney&gt;タグと&lt;/sydney&gt;タグで囲んだ部分に
    ヘッダー部とデータ部を記述します。
    拡張子は「.xml」である必要があります。
    全体像は以下のとおりです。
  </p>
  <pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;sydney&gt;
  &lt;header&gt;
    &lt;ヘッダー部&gt;
  &lt;/header&gt;
  &lt;データ部&gt;(&lt;record&gt;～&lt;/record&gt;の並び)
&lt;/sydney&gt;
</pre>
  <dl>
    <dt class="bold">ヘッダー部</dt>
    <dd>
      ヘッダー部は、&lt;header&gt;～&lt;/header&gt;の間に記述します。
      ヘッダー部には、データ挿入先のテーブル名、
      データ部の記述に外部ファイルを使用するか、などを指定します。
      指定する要素は次のとおりです。
      <table>
        <thead>
          <tr>
            <th>要素名</th>
            <th>必須</th>
            <th>デフォルト値</th>
            <th>内容</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>&lt;table&gt;</td>
            <td>○</td>
            <td>なし</td>
            <td>データ挿入先のテーブル名を指定します。</td>
          </tr>
          <tr>
            <td>&lt;separated_file&gt;</td>
            <td>×</td>
            <td>false</td>
            <td>データ部を記述する際に外部ファイルを使用するかどうかを指定します。
              <ul class="none">
                <li>
                  true：外部ファイルを使用します。</li>
                <li>
                  false：外部ファイルを使用しません。</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>&lt;extern&gt;</td>
            <td>×</td>
            <td>なし</td>
            <td>他のファイルに格納されているデータを挿入する列名を指定します。<br>
              複数の列があるときは、&lt;extern&gt;タグと&lt;/extern&gt;タグで1つずつ囲みます。
            </td>
          </tr>
        </tbody>
      </table>
    </dd>
    <dt class="bold">データ部</dt>
    <dd>
      <p>データ部には、挿入するデータやデータ格納先のファイル名を、
        1レコードごとに&lt;record&gt;タグと&lt;/record&gt;タグで囲んで記述します。
        各データは任意のタグで囲みます。
      </p>
      <pre>
&lt;record&gt;
  &lt;a&gt;データA&lt;/a&gt;
  &lt;b&gt;データB&lt;/b&gt;
  &lt;c&gt;データC&lt;/c&gt;
&lt;/record&gt;
</pre>
      <p>配列の場合は、データ全体を&lt;arrayvalue&gt;タグと&lt;/arrayvalue&gt;タグで囲み、
        列内の各データを&lt;element&gt;タグと&lt;/element&gt;タグで囲みます。
        以下はB列を配列データ列とした場合です。</p>
    <dd>
      <pre>
&lt;record&gt;
  &lt;a&gt;データA&lt;/a&gt;
  &lt;arrayvalue&gt;
    &lt;element&gt;データB1&lt;/element&gt;
    &lt;element&gt;データB2&lt;/element&gt;
    &lt;element&gt;データB3&lt;/element&gt;
  &lt;/arrayvalue&gt;
  &lt;c&gt;データC&lt;/c&gt;
&lt;/record&gt;
</pre>
      <p>挿入先のテーブルに列a、b(配列型)、cがあるとき、
        上の例では列aにデータA、列bにデータB1～B3、列cにデータCが挿入されます。
      </p>
      <p>
        次の例では、
        列cにディレクトリ/work/load/imageにあるファイルsample1.jpgのデータが挿入されます。
      <pre>
&lt;record&gt;
  &lt;a&gt;データA&lt;/a&gt;
  &lt;b&gt;データB&lt;/b&gt;
  &lt;c&gt;/work/load/image/sample1.jpg&lt;/c&gt;
&lt;/record&gt;
</pre>
      <p>
        ファイル名は絶対パスで指定します。
        このように、他のファイルに格納されたデータを挿入する列があれば、
        ロードファイルのヘッダー部に&lt;extern&gt;タグをつけて列名を指定しておきます。
        この場合は&lt;extern&gt;c&lt;/extern&gt;となります。
      </p>

      <p>
        ヘッダー部に&lt;separated_file&gt;true&lt;/separated_file&gt;を指定した場合は、
        外部ファイルを作成し、ロードファイルのデータ部には
        外部ファイル名を&lt;record&gt;タグをつけて絶対パスで指定します。
        外部ファイル/work/load/insertdata.xmlを作成し、
        列a、b、cにデータA、データB、データCを挿入するときは、次のようにします。
      </p>
      <p>
        ロードファイルのデータ部：
      </p>
      <pre>
&lt;record&gt;/work/load/insertdata.xml&lt;/record&gt;
</pre>
      <p>
        外部ファイル：
      </p>
      <pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;example&gt; ← ①
  &lt;item&gt; ← ②
    &lt;a&gt;データA&lt;/a&gt; ← ③
    &lt;b&gt;データB&lt;/b&gt; ← ③
    &lt;c&gt;データC&lt;/c&gt; ← ③
  &lt;/item&gt;
&lt;/example&gt;
</pre>
      <ul>
        <li>
          外部ファイルで使用するタグ名には、任意のタグが使えます。</li>
        <li>
          タグに属性を付加しても無視されます。</li>
        <li>
          第一階層のタグ(①)をルートタグとみなします。</li>
        <li>
          第二階層のタグ(②)をレコード開始タグとみなします。<br>
          このタグ以下で囲まれた部分(③)を1レコード分のデータと解釈します。</li>
        <li>
          第三階層のタグ(③)で囲まれた部分を、ひとつの列データとみなして取得します。</li>
      </ul>
    </dd>
  </dl>

  <h4>記述例</h4>

  <p>
    XML形式のロードファイルの記述例を示します。
    挿入先のテーブルはテキスト形式と同じとします。
  </p>
  <p>
    外部ファイルを使用せずにtable1にロードする場合：
  </p>
  <pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;sydney&gt;
  &lt;header&gt;
    &lt;table&gt;table1&lt;/table&gt;
    &lt;separated_file&gt;false&lt;/separated_file&gt;
    &lt;extern&gt;col2&lt;/extern&gt;
    &lt;extern&gt;col3&lt;/extern&gt;
  &lt;/header&gt;
  &lt;record&gt;
    &lt;a&gt;A100&lt;/a&gt;
    &lt;b&gt;/work/load/image/sample1.jpg&lt;/b&gt;
    &lt;c&gt;/work/load/image/sample2.jpg&lt;/c&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;a&gt;A200&lt;/a&gt;
    &lt;b&gt;/work/load/image/sample2.jpg&lt;/b&gt;
    &lt;c&gt;/work/load/image/sample1.jpg&lt;/c&gt;
  &lt;/record&gt;
&lt;/sydney&gt;
</pre>
  <p>
    外部ファイルを使用してtable1にロードする場合：
  </p>
  <pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;sydney&gt;
  &lt;header&gt;
    &lt;table&gt;table1&lt;/table&gt;
    &lt;separated_file&gt;true&lt;/separated_file&gt;
    &lt;extern&gt;col2&lt;/extern&gt;
    &lt;extern&gt;col3&lt;/extern&gt;
  &lt;/header&gt;
  &lt;record&gt;/work/load/data1.xml&lt;/record&gt;
&lt;/sydney&gt;
</pre>
  <p>
    外部ファイル（/work/load/data1.xml）の内容：
  </p>
  <pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;example&gt;
  &lt;item&gt;
    &lt;a&gt;A100&lt;/a&gt;
    &lt;b&gt;/work/load/image/sample1.jpg&lt;/b&gt;
    &lt;c&gt;/work/load/image/sample2.jpg&lt;/c&gt;
  &lt;/item&gt;
  &lt;item2&gt;
    &lt;a&gt;A200&lt;/a&gt;
    &lt;b&gt;/work/load/image/sample2.jpg&lt;/b&gt;
    &lt;c&gt;/work/load/image/sample1.jpg&lt;/c&gt;
  &lt;/item2&gt;
&lt;/example&gt;
</pre>
  <p>
    配列データをtable2にロードする場合：
  </p>
  <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;sydney&gt;
  &lt;header&gt;
    &lt;table&gt;table2&lt;/table&gt;
  &lt;/header&gt;
  &lt;record&gt;
    &lt;a&gt;10&lt;/a&gt;
    &lt;arrayvalue&gt;
      &lt;element&gt;1&lt;/element&gt;
      &lt;element&gt;2&lt;/element&gt;
      &lt;element&gt;3&lt;/element&gt;
      &lt;element&gt;4&lt;/element&gt;
    &lt;/arrayvalue&gt;
    &lt;c&gt;1000&lt;/c&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;a&gt;20&lt;/a&gt;
    &lt;arrayvalue&gt;
      &lt;element&gt;101&lt;/element&gt;
      &lt;element&gt;102&lt;/element&gt;
      &lt;element&gt;null&lt;/element&gt;
      &lt;element&gt;null&lt;/element&gt;
    &lt;/arrayvalue&gt;
    &lt;c&gt;2000&lt;/c&gt;
  &lt;/record&gt;
&lt;/sydney&gt;
</pre>
  <ul>
    <li>挿入先の列のデータ型と挿入するデータが合わないときは、エラーとなります。</li>
    <li>外部ファイル名、externキーに指定する列名、挿入データの格納ファイル名が正しくない場合、
      エラーとなります。</li>
  </ul>

  <h2><a id="sec6">6章 SQL言語</a></h2>

  <p class="first">ここでは、DoqueDBがサポートするSQLについて説明します。
    DoqueDBのSQLはSQL99規格にほぼ準拠するとともに、
    DoqueDBで拡張された機能をもっています。</p>

  <h3><a id="sec601">6.1 定数および識別子</a></h3>

  <p class="first">定数および識別子について説明します。</p>

  <h4><a id="sec60101">6.1.1 定数</a></h4>

  <p class="first">NULLでない値を指定します。</p>

  <dl>
    <dt class="bold">&lt;定数&gt; ::=</dt>
    <dd>&lt;符号付き数定数&gt;</dd>
    <dd>|&nbsp;&lt;一般定数&gt;</dd>

    <dt class="bold">&lt;符号なし定数&gt; ::=</dt>
    <dd>&lt;符号なし数定数&gt;</dd>
    <dd>|&nbsp;&lt;一般定数&gt;</dd>

    <dt class="bold">&lt;一般定数&gt; ::=</dt>
    <dd>&lt;文字列定数&gt;</dd>
    <dd>|&nbsp;&lt;日時定数&gt;</dd>
  </dl>

  <ul>
    <li>DoqueDBでは、&lt;国際文字列定数&gt;はサポートしていません。&lt;文字列定数&gt;を使用してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;文字列定数&gt; ::=</dt>
    <dd>&lt;引用符&gt; [&lt;文字表現&gt;... ] &lt;引用符&gt;</dd>

    <dt class="bold">&lt;文字表現&gt; ::=</dt>
    <dd>&lt;非引用文字&gt;</dd>
    <dd>|&nbsp;&lt;引用表現&gt;</dd>

    <dt class="bold">&lt;非引用文字&gt; ::=</dt>
    <dd>&lt;引用符&gt;以外の任意の文字</dd>

    <dt class="bold">&lt;引用表現&gt; ::=</dt>
    <dd>&lt;引用符&gt; &lt;引用符&gt;</dd>

    <dt class="bold">&lt;符号付き数定数&gt; ::=</dt>
    <dd>[ &lt;符号&gt; ] &lt;符号なし数定数&gt;</dd>

    <dt class="bold">&lt;符号なし数定数&gt; ::=</dt>
    <dd>&lt;真数定数&gt;</dd>
    <dd>|&nbsp;&lt;概数定数&gt;</dd>

    <dt class="bold">&lt;真数定数&gt; ::=</dt>
    <dd>&lt;符号なし整数&gt; [ &lt;ピリオド&gt; [ &lt;符号なし整数&gt; ] ]</dd>
    <dd>|&nbsp;&lt;ピリオド&gt; &lt;符号なし整数&gt;</dd>
  </dl>

  <ul>
    <li>&lt;ピリオド&gt;をつけた場合、その定数は&lt;概数定数&gt;を表します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;符号&gt; ::=</dt>
    <dd>&lt;正符号&gt;</dd>
    <dd>|&nbsp;&lt;負符号&gt;</dd>

    <dt class="bold">&lt;概数定数&gt; ::=</dt>
    <dd>&lt;仮数&gt; E &lt;指数&gt;</dd>

    <dt class="bold">&lt;仮数&gt; ::=</dt>
    <dd>&lt;真数定数&gt;</dd>

    <dt class="bold">&lt;指数&gt; ::=</dt>
    <dd>&lt;符号付き整数&gt;</dd>

    <dt class="bold">&lt;符号付き整数&gt; ::=</dt>
    <dd>[ &lt;符号&gt; ] &lt;符号なし整数&gt;</dd>

    <dt class="bold">&lt;符号なし整数&gt; ::=</dt>
    <dd>&lt;数字&gt;...</dd>

    <dt class="bold">&lt;日時定数&gt; ::=</dt>
    <dd>&lt;日付定数&gt;</dd>
    <dd>|&nbsp;&lt;時刻印定数&gt;</dd>

    <dt class="bold">&lt;日付定数&gt; ::=</dt>
    <dd>DATE &lt;日付データ列&gt;</dd>

    <dt class="bold">&lt;時刻印定数&gt; ::=</dt>
    <dd>TIMESTAMP &lt;時刻印データ列&gt;</dd>

    <dt class="bold">&lt;日付データ列&gt; ::=</dt>
    <dd>&lt;引用符&gt; &lt;日付値&gt; &lt;引用符&gt;</dd>

    <dt class="bold">&lt;時刻印データ列&gt; ::=</dt>
    <dd>&lt;引用符&gt; &lt;日付値&gt; &lt;スペース&gt; &lt;時刻値&gt; &lt;引用符&gt;</dd>

    <dt class="bold">&lt;日付値&gt; ::=</dt>
    <dd>&lt;年&gt; &lt;負符号&gt; &lt;月&gt; &lt;負符号&gt; &lt;日&gt;</dd>

    <dt class="bold">&lt;時刻値&gt; ::=</dt>
    <dd>&lt;時&gt; &lt;コロン&gt; &lt;分&gt; &lt;コロン&gt; &lt;秒&gt;</dd>

    <dt class="bold">&lt;年&gt; ::=</dt>
    <dd>&lt;日時値&gt;</dd>

    <dt class="bold">&lt;月&gt; ::=</dt>
    <dd>&lt;日時値&gt;</dd>

    <dt class="bold">&lt;日&gt; ::=</dt>
    <dd>&lt;日時値&gt;</dd>

    <dt class="bold">&lt;時&gt; ::=</dt>
    <dd>&lt;日時値&gt;</dd>

    <dt class="bold">&lt;分&gt; ::=</dt>
    <dd>&lt;日時値&gt;</dd>

    <dt class="bold">&lt;秒&gt; ::=</dt>
    <dd>&lt;整数秒&gt; [ &lt;ピリオド&gt; [ &lt;小数秒&gt; ] ]</dd>

    <dt class="bold">&lt;整数秒&gt; ::=</dt>
    <dd>&lt;符号なし整数&gt;</dd>

    <dt class="bold">&lt;小数秒&gt; ::=</dt>
    <dd>&lt;符号なし整数&gt;</dd>

    <dt class="bold">&lt;日時値&gt; ::=</dt>
    <dd>&lt;符号なし整数&gt;</dd>
  </dl>

  <h4><a id="sec60102">6.1.2 識別子</a></h4>

  <p class="first">種々の名前を指定します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;識別子&gt; ::=</dt>
    <dd>&lt;識別子開始&gt; [ { &lt;下線文字&gt; |&nbsp;&lt;識別子部分&gt; } ... ]</dd>

    <dt class="bold">&lt;識別子開始&gt; ::=</dt>
    <dd>&lt;単一ラテン文字&gt;</dd>
    <dd>|&nbsp;&lt;UCS2で0x80以上の文字&gt;</dd>
    <dd>|&nbsp;&lt;シャープ記号&gt;＊</dd>
  </dl>

  <ul>
    <li>シャープ記号が表名の先頭についた表は、一時表になります。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;識別子部分&gt; ::=</dt>
    <dd>&lt;識別子開始&gt;</dd>
    <dd>|&nbsp;&lt;数字&gt;</dd>
  </dl>

  <ul>
    <li>&lt;識別子&gt;に、<a href="#sec60103">キーワード</a>を含めることはできません。</li>
  </ul>

  <h4><a id="sec60103">6.1.3 キーワード</a></h4>

  <p class="first">DoqueDBで使用できるキーワードを示します。
    DoqueDBでは、SQL99規格のキーワードの一部と、
    DoqueDBで拡張したキーワードをサポートしています。
    ＊の付いた語は、DoqueDBで拡張されたキーワードです。</p>

  <dl>
    <dt class="bold">&lt;キーワード&gt; ::=</dt>
    <dd>&lt;予約語&gt;</dd>

    <dt class="bold">&lt;予約語&gt; ::=</dt>
    <dd>ABS
      | ALL
      | ALTER
      | AND
      | APPROXIMATEWORD＊
      | AREA＊
      | ARRAY
      | AS
      | ASC
      | ASYMMETRIC
      | AVERAGE＊
      | AVG</dd>
    <dd>|&nbsp;BACKUP＊
      | BETWEEN
      | BIGINT
      | BINARY
      | BLOB
      | BY</dd>
    <dd>|&nbsp;CALCULATOR＊
      | CASCADE
      | CATEGORY＊
      | CHAR
      | CHAR_LENGTH
      | CLUSTERED＊
      | COLUMN
      | COMBINER＊
      | COMMIT
      | COMMITTED
      | CONSTRAINT
      | CONSTRAINS
      | CONTINUE
      | CORRECT＊
      | CORRESPONDING
      | CONST＊
      | CONSTANT＊
      | COUNT
      | CREATE
      | CROSS
      | CURRENT_PATH
      | CURRENT_USER</dd>
    <dd>|&nbsp;DATE
      | DATABASE＊
      | DATETIME＊
      | DEFAULT
      | DELETE
      | DESC
      | DF＊
      | DISCARD＊
      | DISTINCT
      | DROP</dd>
    <dd>|&nbsp;END
      | ESCAPE
      | EQUALS
      | EXACTWORD＊
      | EXCEPT
      | EXISTS
      | EXPAND＊
      | EXPAND_SYNONYM＊
      | EXTRACTOR＊</dd>
    <dd>|&nbsp;FILE＊
      | FLOAT
      | FOR
      | FREETEXT＊
      | FROM
      | FULL
      | FULLTEXT＊</dd>
    <dd>|&nbsp;GLOBAL
      | GROUP
      | GO</dd>
    <dd>|&nbsp;HAVING
      | HEAD＊
      | HEAP＊
      | HINT＊</dd>
    <dd>|&nbsp;IMAGE＊
      | IN
      | INDEX＊
      | INNER
      | INSERT
      | INT
      | INTERSECT
      | INTO
      | IS
      | ISOLATION</dd>
    <dd>|&nbsp;JOIN</dd>
    <dd>|&nbsp;KEY</dd>
    <dd>|&nbsp;LANGUAGE
      | LEFT
      | LENGTH
      | LEVEL
      | LIKE
      | LIMIT＊
      | LOCAL
      | LOGICALLOG＊
      | LOWER</dd>
    <dd>|&nbsp;MASTER＊
      | MAX
      | MIN
      | MODIFY＊
      | MOUNT＊</dd>
    <dd>|&nbsp;NATURAL
      | NCHAR
      | NCLOB
      | NO
      | NONCLUSTERED＊
      | NOT
      | NTEXT＊
      | NULL
      | NVARCHAR＊</dd>
    <dd>|&nbsp;OCTET_LENGTH
      | OFFLINE＊
      | OFFSET＊
      | ON
      | ONLINE＊
      | ONLY
      | OR
      | ORDER
      | OUTER
      | OVERLAY</dd>
    <dd>|&nbsp;PATH
      | PLACING＊
      | PRIMARY
      | PHYSICALLOG＊</dd>
    <dd>|&nbsp;READ
      | RECOVERY＊
      | REPEATABLE＊
      | RIGHT
      | ROLLBACK
      | ROW</dd>
    <dd>|&nbsp;SCALE
      | SCORE＊
      | SECTIONIZED＊
      | SELECT
      | SERIALIZABLE
      | SESSION_USER
      | SET
      | SIMPLEWORD＊
      | SLAVE＊
      | SNAPSHOT＊
      | START
      | STOP＊
      | SUBSTRING
      | SUM
      | SYSTEM
      | SYMMETRIC
      | SYNONYM＊</dd>
    <dd>|&nbsp;TABLE
      | TAIL＊
      | TEMPORARY
      | TIME
      | TIMESTAMP
      | TO
      | TRANSACTION
      | TRIGGER</dd>
    <dd>|&nbsp;UNCOMMITTED
      | UNION
      | UNIQUE
      | UNIQUEIDENTIFIER＊
      | UPDATABLE＊
      | UPDATE
      | UPPER
      | USER
      | USING
      | UNMOUNT＊</dd>
    <dd>|&nbsp;VALUES
      | VARCHAR
      | VERIFY＊</dd>
    <dd>|&nbsp;WEIGHT＊
      | WHERE
      | WITH
      | WITHIN＊
      | WORD＊
      | WORDLIST＊
      | WORK
      | WRITE</dd>
  </dl>

  <ul>
    <li>&lt;キーワード&gt;は将来追加される可能性があります。
      特に、SQL99規格の&lt;キーワード&gt;は、&lt;識別子&gt;として使用しないでください。</li>
  </ul>

  <h4><a id="sec60104">6.1.4 デリミタ</a></h4>

  <p class="first">DoqueDBで使用できる、デリミタを示します。</p>

  <dl>
    <dt class="bold">&lt;デリミタ付き識別子&gt; ::=</dt>
    <dd>
      &lt;二重引用符&gt; &lt;デリミタ付き識別子部分&gt;... &lt;二重引用符&gt;</dd>

    <dt class="bold">&lt;デリミタ付き識別子部分&gt; ::=</dt>
    <dd>&lt;二重引用符以外の文字&gt;</dd>
    <dd>|&nbsp;&lt;二重引用符指定子&gt;</dd>

    <dt class="bold">&lt;連結演算子&gt; ::=</dt>
    <dd>||</dd>

    <dt class="bold">&lt;セパレータ－&gt; ::=</dt>
    <dd>{ &lt;コメント&gt; |&nbsp;&lt;空白スペース&gt; }...</dd>

    <dt class="bold">&lt;コメント&gt; ::=</dt>
    <dd>&lt;コメント開始文字&gt; [ &lt;任意の文字&gt;... ] &lt;改行&gt;</dd>

    <dt class="bold">&lt;コメント開始文字&gt; ::=</dt>
    <dd>&lt;負符号&gt;&lt;負符号&gt;[&lt;負符号&gt;...]</dd>
  </dl>

  <h3><a id="sec602">6.2 スカラ式</a></h3>

  <p class="first">DoqueDBがサポートするスカラ式について説明します。
    DoqueDBで拡張された要素には、＊がついています。</p>

  <h4><a id="sec60201">6.2.1 データ型</a></h4>

  <p class="first">データ型を指定します。</p>

  <dl>
    <dt class="bold">&lt;データ型&gt; ::=</dt>
    <dd>&lt;組込みデータ型&gt;</dd>
    <dd>|&nbsp;&lt;コレクション型&gt;</dd>
    <dd>|&nbsp;&lt;バイナリ型&gt;＊</dd>
    <dd>|&nbsp;&lt;言語型&gt;＊</dd>
  </dl>

  <dl>
    <dt class="bold">&lt;組込みデータ型&gt; ::=</dt>
    <dd>&lt;文字列型&gt;</dd>
    <dd>|&nbsp;&lt;国際文字列型&gt;</dd>
    <dd>|&nbsp;&lt;BLOB型&gt;</dd>
    <dd>|&nbsp;&lt;数型&gt;</dd>
    <dd>|&nbsp;&lt;日時型&gt;</dd>
    <dd>|&nbsp;&lt;一意識別子型&gt;</dd>

    <dt class="bold">&lt;文字列型&gt; ::=</dt>
    <dd>CHAR &lt;左括弧&gt; &lt;長さ&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;VARCHAR &lt;左括弧&gt; &lt;長さ |&nbsp;NO LIMIT＊&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>ASCII文字だけを格納できます。</li>
    <li>CHAR型は固定長文字列型です。</li>
    <li>VARCHAR型は可変長文字列型です。</li>
    <li>文字列を挿入するとき、
      文字列の長さが確保した文字列より長い場合は、
      警告なしで、超えた部分が切り捨てられて格納されます。</li>
    <li>CHAR型に文字列を挿入するとき、
      文字列の長さが確保した列の長さよりも短い場合は、
      値の後ろに空白を入れ、列の長さに合わせます。</li>
    <li>VARCHAR型の末尾の空白は、削除して挿入されます。
      削除したくない場合は<a href="#sec60505">ヒント句</a>にNONTRUNCATEを指定してください。</li>
    <li>&lt;長さ| NO LIMIT＊ &gt;の指定は必須です。
      漢字などのマルチバイト文字(UCS2で0x0080以上の文字)は格納できません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;国際文字列型&gt; ::=</dt>
    <dd>NCHAR &lt;左括弧&gt; &lt;長さ&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;NVARCHAR＊ &lt;左括弧&gt; &lt;長さ |&nbsp;NO LIMIT＊&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;NCLOB</dd>
    <dd>|&nbsp;NTEXT＊</dd>
    <dd>|&nbsp;FULLTEXT＊</dd>
  </dl>

  <ul>
    <li>マルチバイト文字を格納できます。</li>
    <li>NCHAR型は固定長国際文字列型です。</li>
    <li>NVARCHAR型は可変長国際文字列型です。</li>
    <li>指定した長さより長い文字列が挿入されたときの動作は、
      &lt;文字列型&gt;と同様です。</li>
    <li>NCHAR型に、指定した長さより短い文字列が挿入されたときの動作は、
      CHAR型と同様です。</li>
    <li>NVARCHAR型の末尾の空白は、削除して挿入されます。
      削除したくない場合は<a href="#sec60505">ヒント句</a>にNONTRUNCATEを指定してください。</li>
    <li>NCHAR、NVARCHARは、&lt;長さ| NO LIMIT＊ &gt;の指定が必須です。</li>
    <li>NTEXT、FULLTEXTは、NVARCHAR(NO LIMIT)を指定したのと同義です。</li>
    <li>NCLOB型は、大きな長さの文字列を格納する場合におすすめです。
      詳細については、<a href="#secappc">LOB型の使い方</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;BLOB型&gt; ::=</dt>
    <dd>BLOB</dd>
  </dl>

  <ul>
    <li>詳細については、<a href="#secappc">LOB型の使い方</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;数型&gt; ::=</dt>
    <dd>&lt;真数型&gt;</dd>
    <dd>|&nbsp;&lt;概数型&gt;</dd>

    <dt class="bold">&lt;真数型&gt; ::=</dt>
    <dd>INT</dd>
    <dd>|&nbsp;BIGINT＊</dd>
    <dd>|&nbsp;DECIMAL [ &lt;左括弧&gt; &lt;精度&gt; [ &lt;カンマ&gt; &lt;位取り&gt; ] &lt;右括弧&gt; ]</dd>
    <dd>|&nbsp;DEC [ &lt;左括弧&gt; &lt;精度&gt; [ &lt;カンマ&gt; &lt;位取り&gt; ] &lt;右括弧&gt; ]</dd>
    <dd>|&nbsp;NUMERIC [ &lt;左括弧&gt; &lt;精度&gt; [ &lt;カンマ&gt; &lt;位取り&gt; ] &lt;右括弧&gt; ]</dd>
  </dl>

  <ul>
    <li>DECとNUMERICは、DECIMALと同義です。</li>
    <li>DECIMALの&lt;精度&gt;を省略した場合の値は、「9」です。</li>
    <li>DECIMALの&lt;位取り&gt;を省略した場合の値は、「0」です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;概数型&gt; ::=</dt>
    <dd>FLOAT</dd>

    <dt class="bold">&lt;日時型&gt; ::=</dt>
    <dd>DATETIME＊</dd>

    <dt class="bold">&lt;一意識別子型&gt; ::=</dt>
    <dd>UNIQUEIDENTIFIER</dd>
  </dl>

  <ul>
    <li>UNIQUEIDENTIFIER型はCHAR(36)を指定したのと同義です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;コレクション型&gt; ::=</dt>
    <dd>&lt;データ型&gt; &lt;配列指定&gt;</dd>

    <dt class="bold">&lt;配列指定&gt; ::=</dt>
    <dd>ARRAY &lt;左角括弧&gt; &lt;長さ |&nbsp;NO LIMIT＊&gt; &lt;右角括弧&gt;</dd>
  </dl>

  <ul>
    <li>DoqueDBでは、配列を使用できます。
      配列とは、順序番号をもつデータ要素の集合です。
      ある配列に含まれる要素は、すべて同じデータ型になります。</li>
    <li>配列の大きさを指定しなければなりません。
      配列の大きさとは、その配列に格納可能な要素の最大数を表します。</li>
    <li>&lt;左角括弧&gt; &lt;長さ&gt; &lt;右角括弧&gt; を指定しないとき、
      実装依存の大きさとなるという仕様はサポートしません。</li>
    <li>NO LIMITを指定した場合は、無制限可変サイズの配列が定義されます。</li>
    <li>配列をサポートしているデータ型は、以下のとおりです。

      <ul>
        <li>CHAR</li>
        <li>VARCHAR</li>
        <li>NCHAR</li>
        <li>NVARCHAR</li>
        <li>INT</li>
        <li>BIGINT</li>
        <li>FLOAT</li>
        <li>BINARY</li>
        <li>IMAGE</li>
        <li>DATETIME</li>
        <li>LANGUAGE</li>
        <li>NTEXT</li>
        <li>FULLTEXT</li>
        <li>UNIQUEIDENTIFIER</li>
      </ul>
    </li>
  </ul>

  <dl>
    <dt class="bold">&lt;長さ&gt; ::=</dt>
    <dd>&lt;符号なし整数&gt;</dd>
  </dl>

  <ul>
    <li>符号なし整数とは、1以上の整数値のことです。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;バイナリ型&gt;＊ ::=</dt>
    <dd>BINARY &lt;左括弧&gt; &lt;長さ |&nbsp;NO LIMIT &gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;IMAGE</dd>

    <dt class="bold">&lt;言語型&gt;＊ ::=</dt>
    <dd>LANGUAGE</dd>
  </dl>

  <ul>
    <li>&lt;言語型&gt;の値としてサポートしているのは以下の言語です。

      <dl>
        <dt class="bold">ja</dt>
        <dd>日本語</dd>
        <dt class="bold">en</dt>
        <dd>英語</dd>
      </dl>
    </li>
  </ul>

  <p>以下に、DoqueDBで使用できるデータ型を一覧にまとめました。</p>

  <table>
    <thead>
      <tr>
        <th>書式</th>
        <th>説明</th>
        <th>制限</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>CHAR(n)</td>
        <td>n文字(バイト)の固定長文字列型。<ul>
            <li>UTF-8でファイルに格納されます。</li>
            <li>ASCII文字のみ格納できます。</li>
          </ul>
        </td>
        <td>nは1以上400以下</td>
      </tr>
      <tr>
        <td>VARCHAR(n)</td>
        <td>最大n文字(バイト)の可変長文字列型。<ul>
            <li>UTF-8でファイルに格納されます。</li>
            <li>ASCII文字のみ格納できます。</li>
            <li>nにNO LIMITを指定した場合は、無制限可変長になります。</li>
          </ul>
        </td>
        <td>nは1以上2GB(2の31乗-1)以下</td>
      </tr>
      <tr>
        <td>NCHAR(n)</td>
        <td>n文字の固定長国際文字列型。<ul>
            <li>UCS2でファイルに格納されます。</li>
            <li>マルチバイト文字を格納できます。</li>
          </ul>
        </td>
        <td>nは1以上400以下</td>
      </tr>
      <tr>
        <td>NVARCHAR(n)</td>
        <td>最大n文字の可変長国際文字列型。DoqueDBで拡張されたデータ型です。<ul>
            <li>UCS2でファイルに格納されます。</li>
            <li>マルチバイト文字を格納できます。</li>
            <li>nにNO LIMITを指定した場合は、無制限可変長になります。</li>
          </ul>
        </td>
        <td>nは1以上2GB(2の31乗-1)以下</td>
      </tr>
      <tr>
        <td>INT</td>
        <td>32ビット整数型。</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>BIGINT</td>
        <td>64ビット整数型。</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>FLOAT</td>
        <td>倍精度浮動小数点数型。</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>BINARY(n)</td>
        <td>固定長バイト列型。</td>
        <td>nは1以上400以下</td>
      </tr>
      <tr>
        <td>IMAGE</td>
        <td>無制限可変長バイト列型。</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>DATETIME</td>
        <td>日時型。</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>LANGUAGE</td>
        <td>言語型。DoqueDBで拡張されたデータ型です。</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>BLOB</td>
        <td>最大2GBのバイナリラージオブジェクト型。</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>NCLOB</td>
        <td>最大2GBのキャラクターラージオブジェクト型。</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>NTEXT / FULLTEXT</td>
        <td>無制限可変長国際文字列型。共に、DoqueDBで拡張されたデータ型です。<ul>
            <li>NVARCHAR(NO LIMIT)と同義です。</li>
          </ul>
        </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>UNIQUEIDENTIFIER</td>
        <td>36文字の固定長文字列型。<ul>
            <li>CHAR(36)と同義です。</li>
          </ul>
        </td>
        <td>&nbsp;</td>
      </tr>
    </tbody>
  </table>

  <h4><a id="sec60202">6.2.2 値指定</a></h4>

  <p class="first">1つ以上の値、またはパラメーターを指定します。
    DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;値指定&gt; ::=</dt>
    <dd>&lt;定数&gt;</dd>
    <dd>|&nbsp;&lt;プレースホルダー&gt;＊</dd>

    <dt class="bold">&lt;プレースホルダー&gt;＊ ::=</dt>
    <dd>&lt;疑問符&gt;</dd>
  </dl>

  <h4><a id="sec60203">6.2.3 データベース名</a></h4>

  <p class="first">データベース名を指定します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;データベース名&gt; ::=</dt>
    <dd>&lt;組込みデータベース名&gt;＊</dd>
    <dd>|&nbsp;&lt;ユーザー定義データベース名&gt;</dd>

    <dt class="bold">&lt;組込みデータベース名&gt;＊ ::=</dt>
    <dd>$$SYSTEMDB</dd>
  </dl>

  <ul>
    <li>組込みデータベースについては、
      <a href="#sec30401">3.4.1 組込みデータベース</a>を参照してください。
    </li>
  </ul>

  <h4><a id="sec60204">6.2.4 表参照</a></h4>

  <p class="first">表を参照します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;表参照&gt; ::=</dt>
    <dd>&lt;表一次子&gt;</dd>
    <dd>|&nbsp;&lt;結合表&gt;</dd>

    <dt class="bold">&lt;表一次子&gt; ::=</dt>
    <dd>&lt;表名&gt; [ AS &lt;識別子&gt; ]</dd>
    <dd>|&nbsp;&lt;導出表&gt; [ AS ] &lt;識別子&gt; [ &lt;左括弧&gt; &lt;導出列リスト&gt; &lt;右括弧&gt; ]</dd>

    <dt class="bold">&lt;導出表&gt; ::=</dt>
    <dd>&lt;副問合せ&gt;</dd>

    <dt class="bold">&lt;導出列リスト&gt; ::=</dt>
    <dd>&lt;列名&gt; [ { &lt;カンマ&gt; &lt;列名&gt; } ... ]</dd>

    <dt class="bold">&lt;表名&gt; ::=</dt>
    <dd>&lt;組込み表名&gt;＊</dd>
    <dd>|&nbsp;&lt;ユーザー定義表名&gt;</dd>

    <dt class="bold">&lt;組込み表名&gt;＊ ::=</dt>
    <dd>SYSTEM_DATABASE</dd>
    <dd>|&nbsp;SYSTEM_USER</dd>
    <dd>|&nbsp;SYSTEM_SESSION</dd>
    <dd>|&nbsp;SYSTEM_PRIVILEGE</dd>
    <dd>|&nbsp;SYSTEM_TABLE</dd>
    <dd>|&nbsp;SYSTEM_COLUMN</dd>
    <dd>|&nbsp;SYSTEM_INDEX</dd>
    <dd>|&nbsp;SYSTEM_FILE</dd>
  </dl>
  <ul>
    <li>組込み表については、
      <a href="#sec30402">3.4.2 組込み表</a>を参照してください。
    </li>
  </ul>

  <dl>
    <dt class="bold">&lt;列名&gt; ::=</dt>
    <dd>&lt;組込み列名&gt;＊</dd>
    <dd>|&nbsp;&lt;ユーザー定義列名&gt;</dd>

    <dt class="bold">&lt;組込み列名&gt;＊ ::=</dt>
    <dd>ROWID</dd>
  </dl>

  <ul>
    <li>ROWIDは、表を定義すると自動的に定義されます。</li>
    <li>ROWIDには、表に挿入するごとに1増える、0から始まる数字が入ります。</li>
    <li>ROWIDの値を明示して挿入したり更新したりすることはできません。</li>
    <li>ROWIDは、ユーザー定義の列と同様に、条件に使えます。</li>
    <li>ROWIDは、全文索引作成では指定できません。</li>
    <li>ROWIDは、&lt;<a href="#sec61101">問合せ指定</a>&gt;の&lt;選択リスト&gt;等で
      &lt;アスタリスク&gt;を使っても、出力の対象には含まれません。</li>
  </ul>

  <h4><a id="sec60205">6.2.5 列参照</a></h4>

  <p class="first">列を参照します。</p>

  <dl>
    <dt class="bold">&lt;列参照&gt; ::=</dt>
    <dd>[ &lt;表名&gt; &lt;ピリオド&gt; ] &lt;列名&gt;</dd>
  </dl>

  <h4><a id="sec60206">6.2.6 全文検索結果参照</a></h4>

  <p class="first">全文検索結果を参照します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;全文検索結果参照&gt;＊ ::=</dt>
    <dd>SCORE &lt;左括弧&gt; &lt;列参照&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;WORD &lt;左括弧&gt; &lt;列参照&gt; &lt;右括弧&gt; [ &lt;ピリオド&gt; { DF |&nbsp;SCALE } ]</dd>
    <dd>|&nbsp;TF &lt;左括弧&gt; &lt;列参照&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;全文検索結果参照&gt;に指定する&lt;列参照&gt;には、
      全文索引が定義されていなければなりません。</li>
    <li>SCOREは、&lt;列参照&gt;により参照された列を全文検索したときの、適合度を表します。</li>
    <li>SCOREは、&lt;<a href="#sec60404">LIKE述語</a>&gt;または&lt;<a href="#sec60407">CONTAINS述語</a>&gt;の結果に使えます。</li>
    <li>WORDは、&lt;列参照&gt;により参照された列を全文検索したときに使われる、
      検索語の集合を表します。</li>
    <li>WORDは、&lt;<a href="#sec60407">CONTAINS述語</a>&gt;の&lt;<a href="#sec60408">CONTAINSオペランド</a>&gt;に、
      FREETEXTまたはWORDLISTを指定したときの結果に使えます。</li>
    <li>WORDのDFは、文書頻度で並べ替えることを示します。</li>
    <li>WORDのSCALEは、重要度で並べ替えることを示します。</li>
    <li>WORDのDFとSCALEは、&lt;<a href="#sec60407">CONTAINS述語</a>&gt;の&lt;拡張指定&gt;の&lt;ORDER BY句&gt;に
      使え、そのときはどちらかを指定する必要があります。</li>
    <li>TFは、&lt;列参照&gt;により参照された列を全文検索したときに使われた検索語の、
      文書内頻度を表します。</li>
    <li>TFは、&lt;<a href="#sec60407">CONTAINS述語</a>&gt;の&lt;<a href="#sec60408">CONTAINSオペランド</a>&gt;に、
      WORDLISTを指定したときの結果に使えます。</li>
    <li>使用例については、<a href="#secapp">附録</a>の<a href="#secapph">全文索引の使い方</a>を参照してください。</li>
  </ul>

  <h4><a id="sec60207">6.2.7 集合関数</a></h4>

  <p class="first">引数への関数の適用によって導出される値を指定します。</p>

  <dl>
    <dt class="bold">&lt;集合関数&gt; ::=</dt>
    <dd>COUNT &lt;左括弧&gt; &lt;アスタリスク&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;&lt;一般集合関数&gt;</dd>

    <dt class="bold">&lt;一般集合関数&gt; ::=</dt>
    <dd>&lt;集合関数型&gt; &lt;左括弧&gt; &lt;値式&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;集合関数型&gt; ::=</dt>
    <dd>AVG</dd>
    <dd>|&nbsp;MAX</dd>
    <dd>|&nbsp;MIN</dd>
    <dd>|&nbsp;SUM</dd>
    <dd>|&nbsp;COUNT</dd>
  </dl>

  <h4><a id="sec60208">6.2.8 数値関数</a></h4>

  <p class="first">数型の値をとる関数を指定します。</p>

  <dl>
    <dt class="bold">&lt;数値関数&gt; ::=</dt>
    <dd>&lt;LENGTH式&gt;</dd>
    <dd>|&nbsp;&lt;ABS式&gt;</dd>

    <dt class="bold">&lt;LENGTH式&gt; ::=</dt>
    <dd>&lt;CHARACTER LENGTH式&gt;</dd>
    <dd>|&nbsp;&lt;WORD COUNT式&gt;＊</dd>
    <dd>|&nbsp;&lt;FULLTEXT LENGTH式&gt;＊</dd>

    <dt class="bold">&lt;CHARACTER LENGTH式&gt; ::=</dt>
    <dd>CHAR_LENGTH &lt;左括弧&gt; &lt;文字列式&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;CHARACTER LENGTH式&gt;は、平均文書長を取得します。</li>
    <li>全文索引が付いているときの&lt;CHARACTER LENGTH式&gt;の動作は、
      <a href="#secapp">附録</a>の<a href="#secapph3">全文索引の問合せ</a>を参照してください。
    </li>
  </ul>

  <dl>
    <dt class="bold">&lt;WORD COUNT式&gt;＊ ::=</dt>
    <dd>WORD_COUNT &lt;左括弧&gt; &lt;文字列式&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;WORD_COUNT式&gt;は、AVGと一緒に使う必要があります。</li>
    <li>&lt;文字列式&gt;の示す列には、単語単位の全文索引が付いている必要があります。</li>
    <li>「AVG(WORD_COUNT(X))」で
      文字列型または国際文字列型列 X の平均単語数を取得します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;FULLTEXT LENGTH式&gt;＊ ::=</dt>
    <dd>FULLTEXT_LENGTH &lt;左括弧&gt; &lt;文字列式&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>AVGと一緒に使う必要があります。</li>
    <li>文字列式の示す列には、全文索引が付いている必要があります。</li>
    <li>単語単位の全文索引が付いている場合、
      「AVG(FULLTEXT_LENGTH(X))」で
      文字列型列または国際文字列型列 X の平均単語数を取得します。</li>
    <li>文字単位の全文索引が付いている場合、
      「AVG(FULLTEXT_LENGTH(X))」で
      文字列型列または国際文字列型列 X の平均文字数を取得します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;ABS式&gt; ::=</dt>
    <dd>ABS &lt;左括弧&gt; &lt;数値式&gt; &lt;右括弧&gt;</dd>
  </dl>

  <h4><a id="sec60209">6.2.9 データ列値関数</a></h4>

  <p class="first">文字列型または国際文字列型またはビット列型の値をとる関数を指定します。
    DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;データ列値関数&gt; ::=</dt>
    <dd>&lt;文字列関数&gt;</dd>
    <dd>|&nbsp;&lt;BLOB関数&gt;</dd>

    <dt class="bold">&lt;文字列関数&gt; ::=</dt>
    <dd>&lt;SUBSTRING関数&gt;</dd>
    <dd>|&nbsp;&lt;OVERLAY関数&gt;</dd>
    <dd>|&nbsp;&lt;NORMALIZE関数&gt;＊</dd>
    <dd>|&nbsp;&lt;KWIC関数&gt;＊</dd>
    <dd>|&nbsp;&lt;EXPAND_SYNONYM関数&gt;＊</dd>

    <dt class="bold">&lt;SUBSTRING関数&gt; ::=</dt>
    <dd>
      SUBSTRING &lt;左括弧&gt; &lt;文字列式&gt; FROM &lt;開始位置&gt; [ FOR &lt;データ列長&gt; ] &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;OVERLAY関数&gt; ::=</dt>
    <dd>
      OVERLAY &lt;左括弧&gt; &lt;文字列式&gt; PLACING &lt;文字列式&gt; FROM &lt;開始位置&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;NORMALIZE関数&gt;＊ ::=</dt>
    <dd>
      NORMALIZE &lt;左括弧&gt; &lt;文字列式&gt; USING &lt;正規化仕様指定&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;NORMALIZE関数&gt;は、
      &lt;文字列式&gt;を&lt;正規化仕様指定&gt;が表す正規化方法で正規化した結果を返します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;EXPAND_SYNONYM関数&gt;＊ ::=</dt>
    <dd>
      EXPAND_SYNONYM &lt;左括弧&gt; &lt;文字列式&gt; USING &lt;正規化仕様指定&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;EXPAND_SYNONYM関数&gt;は、
      &lt;文字列式&gt;を&lt;正規化仕様指定&gt;が保持する同義語辞書を利用し、
      同義語展開した結果を返します。
      &lt;正規化仕様指定&gt;で指定できるのは、UNA:&lt;数値&gt;のみです。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;正規化仕様指定&gt; ::=</dt>
    <dd>
      &lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;正規化仕様指定&gt;に指定する文字列式の値は、
      以下のいずれかでなければなりません。(大文字小文字の違いは無視されます。)

      <table>
        <thead>
          <tr>
            <th>値</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>BuiltIn</td>
            <td>大文字/小文字の同一視、半角カタカナ/全角カタカナの同一視、ひらがな/カタカナの濁点/半濁点の合字処理、半角記号/全角記号の同一視(ASCII範囲の記号のみ)を行います。</td>
          </tr>
          <tr>
            <td>BuiltIn_HK</td>
            <td>上記BuiltInに加え、半角全角スペースと、ひらがな/カタカナの同一視を行います。</td>
          </tr>
          <tr>
            <td>UNA:&lt;数値&gt;</td>
            <td><a href="#secappe">異表記正規化辞書</a>を使って正規化されます。<a
                href="#sec303">パラメーター</a>で定義されているCommon_UnaResource_&lt;数値&gt;に対応する辞書が使われます。
            </td>
          </tr>
        </tbody>
      </table>
    </li>

  </ul>

  <dl>
    <dt class="bold">&lt;KWIC関数&gt;＊ ::=</dt>
    <dd>
      KWIC &lt;左括弧&gt; &lt;列参照&gt; FOR &lt;KWIC長&gt; [ ENCLOSE WITH &lt;開始タグ&gt; [ AND &lt;終了タグ&gt; ] ]
      [ ESCAPE &lt;エスケープ指定&gt; ] [ ELLIPSIS &lt;省略記号&gt; ] &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;KWIC関数&gt;は、検索条件にヒットした文書から検索語を含む部分文字列、
      KWIC(Key Word In Context)、を返します。</li>
    <li>&lt;KWIC関数&gt;に指定する&lt;列参照&gt;には、
      <a href="#sec60505">ヒント句</a>に「KWIC」が指定された全文索引が定義されていなければなりません。
    </li>
    <li>&lt;KWIC関数&gt;に指定する&lt;列参照&gt;は、
      &lt;<a href="#sec60303">表式</a>&gt;の&lt;探索条件&gt;で&lt;<a href="#sec60407">CONTAINS述語</a>&gt;の&lt;述語対象式&gt;に
      使われていなければなりません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;KWIC長&gt;＊ ::=</dt>
    <dd>&lt;数値式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;KWIC長&gt;はKWICの文字列長です。
      ただし、この値はヒントです。常にこの長さのKWICが返されるとは限りません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;開始タグ&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;開始タグ&gt;は、検索語の開始位置に挿入される文字列です。
      デフォルトは空文字列です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;終了タグ&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;終了タグ&gt;は、検索語の終了位置に挿入される文字列です。
      デフォルトは&lt;開始タグ&gt;です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;エスケープ指定&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;エスケープ指定&gt;は、KWIC内の文字のエスケープ方法を示します。
      デフォルトはエスケープしません。</li>
    <li>&lt;エスケープ指定&gt;は、以下のエスケープ方法をサポートします。

      <table>
        <thead>
          <tr>
            <th>値</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>HTML</td>
            <td>「&lt;」、「&gt;」、「&amp;」、「&quot;」を「&amp;lt;」、「&amp;gt;」、「&amp;amp;」、「&amp;quot;」にエスケープします。</td>
          </tr>
          <tr>
            <td>NONE</td>
            <td>エスケープしません。
            </td>
          </tr>
        </tbody>
      </table>
    </li>

  </ul>

  <dl>
    <dt class="bold">&lt;省略記号&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;省略記号&gt;は、KWICの前後に付加する省略文字列です。
      デフォルトは空文字列です。</li>
    <li>&lt;省略記号&gt;を指定しても、
      KWICの開始位置の直前やKWICの終了位置が「。」(句点)だった場合、
      &lt;省略記号&gt;は付加されません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;BLOB関数&gt; ::=</dt>
    <dd>&lt;BLOB SUBSTRING関数&gt;</dd>
    <dd>|&nbsp;&lt;BLOB TRIM関数&gt;</dd>
    <dd>|&nbsp;&lt;BLOB OVERLAY関数&gt;</dd>
  </dl>

  <ul>
    <li>詳細については、<a href="#secappc">LOB型の使い方</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;BLOB SUBSTRING関数&gt; ::=</dt>
    <dd>
      SUBSTRING &lt;左括弧&gt; &lt;BLOB式&gt; FROM &lt;開始位置&gt; [ FOR &lt;データ列長&gt; ] &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;BLOB式&gt;は、データ型が&lt;BLOB型&gt;の&lt;列参照&gt;でなければなりません。</li>
    <li>&lt;BLOB SUBSTRING関数&gt;および&lt;CHARACTER LENGTH式&gt;が同じSQL文の中で指定された場合、
      &lt;BLOB SUBSTRING関数&gt;の&lt;BLOB式&gt;と&lt;CHARACTER LENGTH式&gt;の&lt;文字列式&gt;は、
      それぞれ異なる列を参照します</li>
  </ul>

  <dl>
    <dt class="bold">&lt;BLOB OVERLAY関数&gt; ::=</dt>
    <dd>
      OVERLAY &lt;左括弧&gt; &lt;BLOB式&gt; PLACING &lt;BLOB式&gt; FROM &lt;開始位置&gt;
      [ FOR &lt;データ列長&gt; ] &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>BLOB型およびNCLOB型の列値を、BLOB OVERLAY関数を使用して変更する場合、
      変更後の値が異なる長さになるような指定はできません。</li>
    <li>&lt;BLOB式&gt;にNULLを指定することはできません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;BLOB式&gt; ::=</dt>
    <dd>&lt;BLOB連結&gt;</dd>
    <dd>|&nbsp;&lt;BLOB因子&gt;</dd>

    <dt class="bold">&lt;BLOB因子&gt; ::=</dt>
    <dd>&lt;BLOB一次子&gt;</dd>

    <dt class="bold">&lt;BLOB一次子&gt; ::=</dt>
    <dd>&lt;値式一次子&gt;</dd>
    <dd>|&nbsp;&lt;BLOB関数&gt;</dd>

    <dt class="bold">&lt;BLOB連結&gt; ::=</dt>
    <dd>&lt;BLOB式&gt;
      || &lt;BLOB一次子&gt;</dd>
  </dl>

  <ul>
    <li>&lt;BLOB式&gt;にNULLを指定することはできません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;開始位置&gt; ::=</dt>
    <dd>&lt;数値式&gt;</dd>

    <dt class="bold">&lt;データ列長&gt; ::=</dt>
    <dd>&lt;数値式&gt;</dd>
  </dl>

  <h4><a id="sec60210">6.2.10 日時値関数</a></h4>

  <p class="first">日時型の値をとる関数を指定します。</p>

  <dl>
    <dt class="bold">&lt;日時値関数&gt; ::=</dt>
    <dd>CURRENT_TIMESTAMP</dd>
  </dl>

  <ul>
    <li>datetime型の<a href="#sec60504">列定義</a>と<a href="#sec610">データ操作</a>の組み合わせにより、入力値は以下となります。

      <table>
        <tbody>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td colspan=2>列定義</td>
            <!-- <td></td> -->
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td>DEFAULT CURRENT_TIMESTAMP</td>
            <td>DEFAULT CURRENT_TIMESTAMP USING ON UPDATE</td>
          </tr>
          <tr>
            <td rowspan=5>データ操作</td>
            <td>INSERT</td>
            <td>列値の指定なし</td>
            <td>現在時刻</td>
            <td>現在時刻</td>
          </tr>
          <tr>
            <!-- <td></td> -->
            <td>INSERT</td>
            <td>列値の指定あり</td>
            <td>指定された値</td>
            <td>指定された値</td>
          </tr>
          <tr>
            <!-- <td></td> -->
            <td>UPDATE</td>
            <td>列値の指定なし</td>
            <td>変化しない</td>
            <td>現在時刻</td>
          </tr>
          <tr>
            <!-- <td></td> -->
            <td>UPDATE</td>
            <td>列値の指定あり</td>
            <td>指定された値</td>
            <td>指定された値</td>
          </tr>
          <tr>
            <!-- <td></td> -->
            <td>UPDATE</td>
            <td>別の列の入力値</td>
            <td>変更前の値</td>
            <td>変更前の値</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ul>

  <h4><a id="sec60211">6.2.11 値式</a></h4>

  <p class="first">値を指定します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;値式&gt; ::=</dt>
    <dd>&lt;数値式&gt;</dd>
    <dd>|&nbsp;&lt;データ列値式&gt;</dd>
    <dd>|&nbsp;&lt;ブール値式&gt;</dd>
    <dd>|&nbsp;&lt;値式一次子&gt;</dd>

    <dt class="bold">&lt;値式一次子&gt; ::=</dt>
    <dd>&lt;符号なし値指定&gt;</dd>
    <dd>|&nbsp;&lt;列参照&gt;</dd>
    <dd>|&nbsp;&lt;集合関数&gt;</dd>
    <dd>|&nbsp;&lt;全文検索結果参照&gt;＊</dd>
    <dd>|&nbsp;&lt;左括弧&gt; &lt;値式&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;配列値式&gt; ::=</dt>
    <dd>ARRAY &lt;左角括弧&gt; &lt;値式&gt; [ { &lt;カンマ&gt; &lt;値式&gt; } ... ] &lt;右角括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;配列値式&gt;の要素に並べる&lt;値式&gt;は、配列値式でなければなりません。</li>
  </ul>

  <h4><a id="sec60212">6.2.12 数値式</a></h4>

  <p class="first">数値を指定します。</p>

  <dl>
    <dt class="bold">&lt;数値式&gt; ::=</dt>
    <dd>&lt;項&gt;</dd>
    <dd>|&nbsp;&lt;数値式&gt; &lt;正符号&gt; &lt;項&gt;</dd>
    <dd>|&nbsp;&lt;数値式&gt; &lt;負符号&gt; &lt;項&gt;</dd>

    <dt class="bold">&lt;項&gt; ::=</dt>
    <dd>&lt;因子&gt;</dd>
    <dd>|&nbsp;&lt;項&gt; &lt;アスタリスク&gt; &lt;因子&gt;</dd>
    <dd>|&nbsp;&lt;項&gt; &lt;斜線&gt; &lt;因子&gt;</dd>

    <dt class="bold">&lt;因子&gt; ::=</dt>
    <dd>[ &lt;符号&gt; ] &lt;数一次子&gt;</dd>

    <dt class="bold">&lt;数一次子&gt; ::=</dt>
    <dd>&lt;値式一次子&gt;</dd>
    <dd>|&nbsp;&lt;数値関数&gt;</dd>
  </dl>

  <h4><a id="sec60213">6.2.13 データ列値式</a></h4>

  <p class="first">文字列値またはビット列を指定します。</p>

  <dl>
    <dt class="bold">&lt;データ列値式&gt; ::=</dt>
    <dd>&lt;文字列式&gt;</dd>

    <dt class="bold">&lt;文字列式&gt; ::=</dt>
    <dd>&lt;連結&gt;</dd>
    <dd>|&nbsp;&lt;文字因子&gt;</dd>

    <dt class="bold">&lt;連結&gt; ::=</dt>
    <dd>&lt;文字列式&gt;
      || &lt;文字因子&gt;</dd>

    <dt class="bold">&lt;文字因子&gt; ::=</dt>
    <dd>&lt;文字一次子&gt;</dd>

    <dt class="bold">&lt;文字一次子&gt; ::=</dt>
    <dd>&lt;値式一次子&gt;</dd>
    <dd>|&nbsp;&lt;文字列関数&gt;</dd>
  </dl>

  <h4><a id="sec60214">6.2.14 ブール値式</a></h4>

  <p class="first">真理値(「真」、「偽」および「不定」)を指定します。</p>

  <dl>
    <dt class="bold">&lt;ブール値式&gt; ::=</dt>
    <dd>&lt;ブール項&gt; [ { OR &lt;ブール項&gt; } ... ]</dd>

    <dt class="bold">&lt;ブール項&gt; ::=</dt>
    <dd>&lt;ブール因子&gt; [ { AND &lt;ブール因子&gt; } ... ]</dd>

    <dt class="bold">&lt;ブール因子&gt; ::=</dt>
    <dd>[ NOT ] &lt;ブールテスト&gt;</dd>

    <dt class="bold">&lt;ブールテスト&gt; ::=</dt>
    <dd>&lt;ブール一次子&gt;</dd>

    <dt class="bold">&lt;ブール一次子&gt; ::=</dt>
    <dd>&lt;述語&gt;</dd>
    <dd>|&nbsp;&lt;左括弧&gt; &lt;ブール値式&gt; &lt;右括弧&gt;</dd>
  </dl>

  <h3><a id="sec603">6.3 問合せ式</a></h3>

  <p class="first">DoqueDBがサポートする問合せ式について説明します。</p>

  <h4><a id="sec60301">6.3.1 行値構成子</a></h4>
  <p class="first">行または部分行を構成する、順序付けられた値の集合を指定します。
    DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;行値構成子&gt; ::=</dt>
    <dd>&lt;行値構成子要素&gt;</dd>
    <dd>|&nbsp;&lt;左括弧&gt; &lt;行値構成子要素リスト&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;行値構成子要素リスト&gt; ::=</dt>
    <dd>
      &lt;行値構成子要素&gt; [ { &lt;カンマ&gt; &lt;行値構成子要素&gt; } ... ]</dd>

    <dt class="bold">&lt;行値構成子要素&gt; ::=</dt>
    <dd>&lt;値式&gt;</dd>
    <dd>|&nbsp;&lt;NULL指定&gt;</dd>

    <dt class="bold">&lt;NULL指定&gt; ::=</dt>
    <dd>NULL</dd>

    <dt class="bold">&lt;行値式&gt; ::=</dt>
    <dd>&lt;特殊行値&gt;</dd>
    <dd>|&nbsp;&lt;行値構成子&gt;</dd>

    <dt class="bold">&lt;特殊行値&gt; ::=</dt>
    <dd>&lt;符号なし値指定&gt;</dd>
    <dd>|&nbsp;&lt;列参照&gt;</dd>
    <dd>|&nbsp;&lt;集合関数&gt;</dd>
    <dd>|&nbsp;&lt;全文検索結果参照&gt;＊</dd>
  </dl>

  <h4><a id="sec60302">6.3.2 表値構成子</a></h4>

  <p class="first">表を構成する&lt;<a href="#sec60301">行値構成子</a>&gt;の集合を指定します。</p>

  <dl>
    <dt class="bold">&lt;表値構成子&gt; ::=</dt>
    <dd>VALUES &lt;表値構成子リスト&gt;</dd>

    <dt class="bold">&lt;表値構成子リスト&gt; ::=</dt>
    <dd>&lt;行値構成子&gt; [ { &lt;カンマ&gt; &lt;行値構成子&gt; } ... ]</dd>
  </dl>

  <h4><a id="sec60303">6.3.3 表式</a></h4>

  <p class="first">表またはグループ表を指定します。</p>

  <dl>
    <dt class="bold">&lt;表式&gt; ::=</dt>
    <dd>&lt;FROM句&gt; [ &lt;WHERE句&gt; ] [ &lt;GROUP BY句&gt; ] [ &lt;HAVING句&gt; ]</dd>

    <dt class="bold">&lt;FROM句&gt; ::=</dt>
    <dd>FROM &lt;表参照&gt; [ { &lt;カンマ&gt; &lt;表参照&gt; } ]</dd>

    <dt class="bold">&lt;WHERE句&gt; ::=</dt>
    <dd>WHERE &lt;探索条件&gt;</dd>

    <dt class="bold">&lt;GROUP BY句&gt; ::=</dt>
    <dd>GROUP BY &lt;グループ化要素リスト&gt;</dd>

    <dt class="bold">&lt;グループ化要素リスト&gt; ::=</dt>
    <dd>
      &lt;グループ化要素&gt; [ { &lt;カンマ&gt; &lt;グループ化要素&gt; } ... ]</dd>

    <dt class="bold">&lt;グループ化要素&gt; ::=</dt>
    <dd>&lt;通常グループ化セット&gt;</dd>

    <dt class="bold">&lt;通常グループ化セット&gt; ::=</dt>
    <dd>&lt;グループ化列参照&gt;</dd>
    <dd>|&nbsp;&lt;左括弧&gt; &lt;グループ化列参照リスト&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;グループ化列参照リスト&gt; ::=</dt>
    <dd>
      &lt;グループ化列参照&gt; [ { &lt;カンマ&gt; &lt;グループ化列参照&gt; } ... ]</dd>

    <dt class="bold">&lt;グループ化列参照&gt; ::=</dt>
    <dd>&lt;列参照&gt;</dd>

    <dt class="bold">&lt;HAVING句&gt; ::=</dt>
    <dd>HAVING &lt;探索条件&gt;</dd>

    <dt class="bold">&lt;探索条件&gt; ::=</dt>
    <dd>&lt;ブール値式&gt;</dd>
  </dl>

  <h4><a id="sec60304">6.3.4 結合表</a></h4>

  <p class="first">直積、内結合、外結合、または和結合から導出される列表を指定します。</p>

  <dl>
    <dt class="bold">&lt;結合表&gt; ::=</dt>
    <dd>&lt;交差結合&gt;</dd>
    <dd>|&nbsp;&lt;修飾付き結合&gt;</dd>
    <dd>|&nbsp;&lt;自然結合&gt;</dd>

    <dt class="bold">&lt;交差結合&gt; ::=</dt>
    <dd>&lt;表参照&gt; CROSS JOIN &lt;表一次子&gt;</dd>

    <dt class="bold">&lt;修飾付き結合&gt; ::=</dt>
    <dd>&lt;表参照&gt; [ &lt;結合型&gt; ] JOIN &lt;表参照&gt; [ &lt;結合指定&gt; ]</dd>

    <dt class="bold">&lt;自然結合&gt; ::=</dt>
    <dd>&lt;表参照&gt; NATURAL [ &lt;結合型&gt; ] JOIN &lt;表一次子&gt;</dd>

    <dt class="bold">&lt;結合指定&gt; ::=</dt>
    <dd>&lt;結合条件&gt;</dd>
    <dd>|&nbsp;&lt;名前付き列結合&gt;</dd>

    <dt class="bold">&lt;結合条件&gt; ::=</dt>
    <dd>ON &lt;探索条件&gt;</dd>

    <dt class="bold">&lt;名前付き列結合&gt; ::=</dt>
    <dd>USING &lt;左括弧&gt; &lt;結合列リスト&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;結合型&gt; ::=</dt>
    <dd>INNER</dd>
    <dd>|&nbsp;&lt;外結合型&gt; [ OUTER ]</dd>

    <dt class="bold">&lt;外結合型&gt; ::=</dt>
    <dd>LEFT</dd>
    <dd>|&nbsp;RIGHT</dd>

    <dt class="bold">&lt;結合列リスト&gt; ::=</dt>
    <dd>&lt;列名リスト&gt;</dd>
  </dl>

  <h4><a id="sec60305">6.3.5 問合せ式本体</a></h4>

  <p class="first">表を指定します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;問合せ式&gt; ::=</dt>
    <dd>&lt;問合せ式本体&gt; [ &lt;ORDER BY句&gt; ] [ &lt;LIMIT句&gt;＊ ]</dd>

    <dt class="bold">&lt;問合せ式本体&gt; ::=</dt>
    <dd>&lt;非結合問合せ式&gt;</dd>
    <dd>|&nbsp;&lt;結合表&gt;</dd>

    <dt class="bold">&lt;非結合問合せ式&gt; ::=</dt>
    <dd>&lt;非結合問合せ項&gt;</dd>

    <dt class="bold">&lt;非結合問合せ項&gt; ::=</dt>
    <dd>&lt;非結合問合せ一次子&gt;</dd>

    <dt class="bold">&lt;非結合問合せ一次子&gt; ::=</dt>
    <dd>&lt;単純表&gt;</dd>

    <dt class="bold">&lt;単純表&gt; ::=</dt>
    <dd>&lt;問合せ指定&gt;</dd>
    <dd>|&nbsp;&lt;表値構成子&gt;</dd>

    <dt class="bold">&lt;ORDER BY句&gt; ::=</dt>
    <dd>ORDER BY &lt;ソート指定リスト&gt;</dd>

    <dt class="bold">&lt;ソート指定リスト&gt; ::=</dt>
    <dd>&lt;ソート指定&gt; [ { &lt;カンマ&gt; &lt;ソート指定&gt; } ... ]</dd>

    <dt class="bold">&lt;ソート指定&gt; ::=</dt>
    <dd>&lt;ソートキー&gt; [ &lt;順序付け指定&gt; ]</dd>

    <dt class="bold">&lt;ソートキー&gt; ::=</dt>
    <dd>&lt;値式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;ソートキー&gt;に、&lt;全文検索結果参照&gt;を使う場合は、
      さまざまな方法でソートすることができます。
      詳細については、<a href="#sec60206">全文検索結果参照</a>&gt;を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;順序付け指定&gt; ::=</dt>
    <dd>ASC</dd>
    <dd>|&nbsp;DESC</dd>

    <dt class="bold">&lt;LIMIT句&gt;＊ ::=</dt>
    <dd>&lt;LIMIT指定&gt; [ &lt;OFFSET指定&gt; ]</dd>
  </dl>

  <ul>
    <li>&lt;LIMIT句&gt;において、
      &lt;LIMIT指定&gt;、&lt;OFFSET指定&gt;に0以下の値を指定することはできません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;LIMIT指定&gt;＊ ::=</dt>
    <dd>LIMIT &lt;数値式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;LIMIT指定&gt;は問合せの結果集合を&lt;数値式&gt;で計算される件数を上限とします。
      問合せの結果集合の先頭から件数分を取り出すことになります。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;OFFSET指定&gt;＊ ::=</dt>
    <dd>OFFSET &lt;数値式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;OFFSET指定&gt;により、
      問合せの結果集合の先頭から&lt;数値式&gt;で計算される数番目の行から取り出します。</li>
  </ul>

  <h4><a id="sec60306">6.3.6 副問合せ</a></h4>

  <p>&lt;問合せ式&gt;から導出される表を指定します。</p>

  <dl>
    <dt class="bold">&lt;副問合せ&gt; ::=</dt>
    <dd>&lt;左括弧&gt; &lt;問合せ式&gt; &lt;右括弧&gt;</dd>
  </dl>

  <h3><a id="sec604">6.4 述語</a></h3>

  <p class="first">「真」、「偽」、または「不定」の真理値を与えるために評価できる条件を指定します。
    サポートしている述語は、以下のとおりです。
    DoqueDBで拡張されたものには、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;述語&gt; ::=</dt>
    <dd>&lt;比較述語&gt;</dd>
    <dd>|&nbsp;&lt;BETWEEN述語&gt;</dd>
    <dd>|&nbsp;&lt;IN述語&gt;</dd>
    <dd>|&nbsp;&lt;LIKE述語&gt;</dd>
    <dd>|&nbsp;&lt;NULL述語&gt;</dd>
    <dd>|&nbsp;&lt;EXISTS述語&gt;</dd>
    <dd>|&nbsp;&lt;CONTAINS述語&gt;＊</dd>
  </dl>

  <h4><a id="sec60401">6.4.1 比較述語</a></h4>

  <p class="first">2つの行値の比較を指定します。</p>

  <dl>
    <dt class="bold">&lt;比較述語&gt; ::=</dt>
    <dd>&lt;述語対象式&gt; &lt;比較演算子&gt; &lt;行値式&gt;</dd>

    <dt class="bold">&lt;述語対象式&gt; ::=</dt>
    <dd>&lt;行値式&gt;</dd>
    <dd>|&nbsp;&lt;配列任意要素指定式&gt;＊</dd>

    <dt class="bold">&lt;配列任意要素指定式&gt; ::=</dt>
    <dd>&lt;列参照&gt; &lt;左角括弧&gt; &lt;右角括弧&gt;</dd>

    <dt class="bold">&lt;比較演算子&gt; ::=</dt>
    <dd>&lt;等号演算子&gt;</dd>
    <dd>|&nbsp;&lt;不等号演算子&gt;</dd>
    <dd>|&nbsp;&lt;小なり演算子&gt;</dd>
    <dd>|&nbsp;&lt;大なり演算子&gt;</dd>
    <dd>|&nbsp;&lt;以下演算子&gt;</dd>
    <dd>|&nbsp;&lt;以上演算子&gt;</dd>

    <dt class="bold">&lt;等号演算子&gt; ::=</dt>
    <dd>=</dd>

    <dt class="bold">&lt;不等号演算子&gt; ::=</dt>
    <dd>&lt;&gt;</dd>
    <dd>|&nbsp;!=＊</dd>
  </dl>

  <ul>
    <li>「!=」は「&lt;&gt;」と同義です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;小なり演算子&gt; ::=</dt>
    <dd>&lt;</dd>

    <dt class="bold">&lt;大なり演算子&gt; ::=</dt>
    <dd>&gt;</dd>

    <dt class="bold">&lt;以下演算子&gt; ::=</dt>
    <dd>&lt;=</dd>

    <dt class="bold">&lt;以上演算子&gt; ::=</dt>
    <dd>&gt;=</dd>
  </dl>

  <ul>
    <li>&lt;配列任意要素指定式&gt;を使った述語は、
      要素ごとの述語をORで結合したものとして評価されます。
      たとえば、f[] = 1 は
      f[1] = 1 or f[2] = 1 or ...
      と書き換えることができます。
      評価結果の例を以下に示します。

      <table>
        <thead>
          <tr>
            <th>ARRAY列値</th>
            <th>f[] = 1</th>
            <th>not(f[] = 1)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>[1]</td>
            <td>true</td>
            <td>false</td>
          </tr>
          <tr>
            <td>[2]</td>
            <td>false</td>
            <td>true</td>
          </tr>
          <tr>
            <td>[null]</td>
            <td>unknown</td>
            <td>unknown</td>
          </tr>
          <tr>
            <td>[null, 1]</td>
            <td>true</td>
            <td>false</td>
          </tr>
          <tr>
            <td>[null, 2]</td>
            <td>unknown</td>
            <td>unknown</td>
          </tr>
        </tbody>
      </table>

      <p>配列要素にNULLが含まれる場合は注意が必要です。
        not(f[] = 1)では、[null] や [null, 2] は検索されません。
        したがって、明確な目的がないかぎり、配列要素にNULLを入れるのは避ける必要があります。</p>
    </li>

    <li>&lt;配列任意要素指定式&gt;で使用できる&lt;列参照&gt;は、ARRAY指定つきで定義された列です。
      ここでは、ARRAY列に対して任意要素を包含するデータを検索します。
      これは、DoqueDBで拡張された式です。
      評価結果の例を以下に示します。

      <table>
        <thead>
          <tr>
            <th>ARRAY列値</th>
            <th>f[] &lt;&gt; 1</th>
            <th>not(f[] = 1)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>[1]</td>
            <td>false</td>
            <td>false</td>
          </tr>
          <tr>
            <td>[2]</td>
            <td>true</td>
            <td>true</td>
          </tr>
          <tr>
            <td>[1,2]</td>
            <td>true</td>
            <td>false</td>
          </tr>
        </tbody>
      </table>

      <p>ARRAY列に対する検索式において、
        列名[] &lt;&gt; 1 と NOT (列名[] = 1) では意味が異なります。
        列名[] &lt;&gt; 1 は「1でない要素をもつデータ」を検索し、
        NOT (列名[] = 1) は「1を要素に持たないデータ」を検索します。</p>
    </li>

    <li>長さの違う固定長文字列型または国際文字列型の列を比較する場合は、
      長いほうの列に合わせるため、短い列の値の後ろは空白で埋められます。
      比較は、この空白埋めの後に行われます。</li>
  </ul>

  <ul>
    <li>固定長文字列型または固定長国際文字列型列の最後に
      '\n'などの制御文字が使われている場合、
      大小比較の結果が予想とは異なることがあります。
      char(5)のカラムに「abc\n」が挿入されている例を示します。
      <table>
        <thead>
          <tr>
            <th>述語</th>
            <th>比較結果</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>&gt; 'abc'</td>
            <td>ヒットしない</td>
          </tr>
          <tr>
            <td>&gt;= 'abc'</td>
            <td>ヒットしない</td>
          </tr>
          <tr>
            <td>&lt; 'abc'</td>
            <td>ヒットする</td>
          </tr>
          <tr>
            <td>&lt;= 'abc'</td>
            <td>ヒットする</td>
          </tr>
          <tr>
            <td>= 'abc'</td>
            <td>ヒットしない</td>
          </tr>
          <tr>
            <td>like 'abc%'</td>
            <td>ヒットする</td>
          </tr>
          <tr>
            <td>like 'abc'</td>
            <td>ヒットしない
            </td>
          </tr>
        </tbody>
      </table>
    </li>

  </ul>

  <h4><a id="sec60402">6.4.2 BETWEEN述語</a></h4>

  <p class="first">指定した範囲に含まれるかどうかをテストします。</p>

  <dl>
    <dt class="bold">&lt;BETWEEN述語&gt; ::=</dt>
    <dd>&lt;行値式&gt; [ NOT ] BETWEEN &lt;行値式&gt; AND &lt;行値式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;配列任意要素指定式&gt;を使用したBETWEEN述語には、
      ビットマップ索引は利用されません。</li>
  </ul>

  <h4><a id="sec60403">6.4.3 IN述語</a></h4>

  <p class="first">行値または副問合わせ内のメンバーシップをテストします。</p>

  <dl>
    <dt class="bold">&lt;IN述語&gt; ::=</dt>
    <dd>&lt;述語対象式&gt; [ NOT ] IN &lt;IN述語値&gt;</dd>

    <dt class="bold">&lt;IN述語値&gt; ::=</dt>
    <dd>&lt;副問合わせ&gt;</dd>
    <dd>|&nbsp;&lt;左括弧&gt; &lt;行値式&gt; { &lt;カンマ&gt; &lt;行値式&gt; }... &lt;右括弧&gt;</dd>
  </dl>

  <h4><a id="sec60404">6.4.4 LIKE述語</a></h4>

  <p class="first">パターンによる文字列照合を指定します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;LIKE述語&gt; ::=</dt>
    <dd>
      &lt;述語対象式&gt; [ NOT ] LIKE &lt;パターン&gt;
      [ ESCAPE &lt;エスケープ文字&gt; ] [ LANGUAGE＊ &lt;言語値&gt;＊ ]</dd>
  </dl>

  <ul>
    <li>LANGUAGEの&lt;言語値&gt;は、全文索引が付いていない場合、無視されます。</li>
    <li>全文索引が付いていて、LANGUAGEの&lt;言語値&gt;が省略された場合は、
      索引の定義時に使用した&lt;UNAリソース指定&gt;で指定された辞書のデフォルト言語が
      使用されます。</li>
    <li>全文索引が付いている場合に、LIKE検索で使われる索引単位については、
      <a href="#sec60408">CONTAINSオペランド</a>の&lt;CONTAINSオペランド一次子&gt;の説明を参照してください。
    </li>
  </ul>

  <dl>
    <dt class="bold">&lt;述語対象式&gt; ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>LIKEの&lt;述語対象式&gt;が文字配列型の場合、
      &lt;述語対象式&gt;の&lt;配列任意要素指定式&gt;の「&lt;左角括弧&gt; &lt;右角括弧&gt;」は省略可能です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;パターン&gt; ::=</dt>
    <dd>&lt;文字列式&gt;</dd>

    <dt class="bold">&lt;エスケープ文字&gt; ::=</dt>
    <dd>&lt;文字列式&gt;</dd>

    <dt class="bold">&lt;言語値&gt;＊ ::=</dt>
    <dd>&lt;値指定&gt;</dd>
  </dl>

  <ul>
    <li>&lt;言語値&gt;としてサポートしている値は、<a href="#sec60201">データ型</a>の&lt;言語型&gt;を参照してください。</li>
  </ul>

  <h4><a id="sec60405">6.4.5 NULL述語</a></h4>

  <p class="first">NULL値のテストを指定します。</p>

  <dl>
    <dt class="bold">&lt;NULL述語&gt; ::=</dt>
    <dd>&lt;述語対象式&gt; IS [ NOT ] NULL</dd>
  </dl>

  <h4><a id="sec60406">6.4.6 EXISTS述語</a></h4>

  <p class="first">空でない集合のテストを指定します。</p>

  <dl>
    <dt class="bold">&lt;EXISTS述語&gt; ::=</dt>
    <dd>EXISTS &lt;副問合せ&gt;</dd>
  </dl>

  <h4><a id="sec60407">6.4.7 CONTAINS述語</a></h4>

  <p class="first">パターンを包含する行のテストを指定します。
    これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;CONTAINS述語&gt;＊ ::=</dt>
    <dd>
      &lt;述語対象式&gt; CONTAINS &lt;CONTAINSオペランド&gt;
      [ &lt;スコア計算器指定&gt; ] [ &lt;スコア調整器指定&gt; ]
      [ &lt;平均文書長指定&gt; ] [ &lt;文書頻度指定&gt; ] [ &lt;拡張指定&gt; ]
      [ &lt;抽出指定&gt; ] [ &lt;複合索引スコア合成指定&gt; ]</dd>

    <dt class="bold">&lt;述語対象式&gt; ::=</dt>
    <dd>&lt;列参照&gt;</dd>
  </dl>

  <dl>
    <dd>&lt;左括弧&gt; &lt;列参照&gt; [ { &lt;カンマ&gt; &lt;列参照&gt; } ... ] &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>CONTAINSの&lt;述語対象式&gt;は文字列型または国際文字列型のみサポートしています。</li>
    <li>&lt;平均文書長指定&gt;を省略した場合は、付けられている索引に応じて、
      平均単語数または平均文字数が渡されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;スコア計算器指定&gt;＊ ::=</dt>
    <dd>CALCULATOR &lt;スコア計算器&gt;</dd>

    <dt class="bold">&lt;スコア計算器&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;スコア計算器&gt;として、以下の値をサポートしています。

      <table>
        <thead>
          <tr>
            <th>計算器</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>TfIdf</td>
            <td>文書内頻度(tf)と文書頻度(df)の逆数を組み合わせたもの</td>
          </tr>
          <tr>
            <td>NormalizedTfIdf</td>
            <td>TfIdfを元に、文書内頻度を文書長で正規化したもの</td>
          </tr>
          <tr>
            <td>OkapiTfIdf</td>
            <td>Okapi BM25と呼ばれるランキング手法に基づき、<br>
              TfIdfとは文書内頻度の調整方法が異なるもの</td>
          </tr>
          <tr>
            <td>NormalizedOkapiTfIdf</td>
            <td>OkapiTfIdfを元に、文書内頻度を文書長で正規化したもの (デフォルト)</td>
          </tr>
          <tr>
            <td>OkapiTf</td>
            <td>OkapiTfIdfを元に、文書頻度を組み合わせないもの</td>
          </tr>
          <tr>
            <td>NormalizedOkapiTf</td>
            <td>OkapiTfを元に、文書内頻度を文書長で正規化したもの
            </td>
          </tr>
        </tbody>
      </table>
    </li>

    <li>&lt;スコア計算器&gt;に使われる値は、大文字小文字を区別します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;スコア調整器指定&gt;＊ ::=</dt>
    <dd>SCORE FUNCTION &lt;スコア調整器&gt;</dd>

    <dt class="bold">&lt;スコア調整器&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;スコア調整器&gt;としてサポートしているのは、以下のものです。
      <dl>
        <dt>Sum</dt>
        <dd>算術和</dd>
        <dt>Multiply</dt>
        <dd>算術積</dd>
      </dl>
      使い方は<a href="#secapp">附録</a>の<a href="#secapph4">全文索引のランキング検索</a>を参照してください。
    </li>
  </ul>

  <dl>
    <dt class="bold">&lt;平均文書長指定&gt;＊ ::=</dt>
    <dd>AVERAGE LENGTH ( &lt;数値式&gt; |&nbsp;&lt;文字列式&gt; )</dd>

    <dt class="bold">&lt;文書頻度指定&gt;＊ ::=</dt>
    <dd>DF ( &lt;数値式&gt; |&nbsp;&lt;文字列式&gt; )</dd>

    <dt class="bold">&lt;拡張指定&gt;＊ ::=</dt>
    <dd>
      EXPAND &lt;左括弧&gt; FROM &lt;副問合せ&gt; [ &lt;ORDER BY句&gt; ] [ &lt;LIMIT句&gt; ] &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;副問合せ&gt;は、文字列の集合を返すものであれば、
      select文でも文字列の列挙でもかまいません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;抽出指定&gt;＊ ::=</dt>
    <dd>EXTRACTOR &lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;抽出指定&gt;の値として、以下を指定できます。

      <table>
        <thead>
          <tr>
            <th>抽出指定</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ESTIMATEDF</td>
            <td>関連語のDFを推定値とします。</td>
          </tr>
          <tr>
            <td>@TERMRSCID:n</td>
            <td><a href="#secappf">質問処理辞書</a>用リソースIDを指定します。
              以下の辞書が指定できます。
              <dl>
                <dt>0</dt>
                <dd>一般的な用途(日英)</dd>
                <dt>1</dt>
                <dd>技術文書向け(日英)</dd>
              </dl>
            </td>
          </tr>
          <tr>
            <td>@UNARSCID:n</td>
            <td><a href="#secappe">異表記正規化辞書</a>用リソースIDを指定します。
              以下の辞書が指定できます。
              <dl>
                <dt>1</dt>
                <dd>一般的な用途(日英)</dd>
              </dl>
            </td>
          </tr>
        </tbody>
      </table>
    </li>

    <li>&lt;抽出指定&gt;の値には、複数の値を空白で区切って並べて指定することができます。</li>
    <li>&lt;<a href="#sec60505">ヒント句</a>&gt;の&lt;抽出パラメーター&gt;とは書式が異なります。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;複合索引スコア合成指定&gt;＊ ::=</dt>
    <dd>SCORE COMBINER &lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;複合索引スコア合成指定&gt;の値として、以下を指定できます。

      <table>
        <thead>
          <tr>
            <th>合成指定</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>concatinate</td>
            <!-- "concatInate" is left as it is, due to spelling error in the source code -->
            <td>擬似的にカラムを連結してスコアを計算します。</td>
          </tr>
          <tr>
            <td>sum</td>
            <td>それぞれのカラムで求めたスコア値を合計します。</td>
          </tr>
          <tr>
            <td>max</td>
            <td>それぞれのカラムで求めたスコア値の最大値を利用します。
            </td>
          </tr>
        </tbody>
      </table>
    </li>

    <li>concatenite がデフォルトの動作になります。</li>
  </ul>

  <h4><a id="sec60408">6.4.8 CONTAINSオペランド</a></h4>

  <p class="first">包含行テストのCONTAINSオペランドを指定します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;CONTAINSオペランド&gt;＊ ::=</dt>
    <dd>&lt;CONTAINSオペランドリスト&gt; [ &lt;スコア合成器指定&gt; ]</dd>
    <dd>|&nbsp;&lt;単語リスト&gt;</dd>
    <dd>|&nbsp;&lt;自然文指定&gt;</dd>

    <dt class="bold">&lt;CONTAINSオペランドリスト&gt;＊ ::=</dt>
    <dd>
      &lt;CONTAINSオペランド一次子&gt;
      [ { &lt;CONTAINS演算子&gt; &lt;CONTAINSオペランド一次子&gt; } ... ]</dd>

    <dt class="bold">&lt;CONTAINSオペランド一次子リスト&gt;＊ ::=</dt>
    <dd>
      &lt;CONTAINSオペランド一次子&gt; [ &lt;CONTAINSオペランド一次子&gt; ... ]</dd>

    <dt class="bold">&lt;CONTAINSオペランド一次子&gt;＊ ::=</dt>
    <dd>
      &lt;CONTAINSオペランド小詞&gt;</dd>
    <dd>|&nbsp;&lt;左括弧&gt; &lt;CONTAINSオペランドリスト&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;WEIGHT &lt;左括弧&gt; &lt;CONTAINSオペランドリスト&gt; &lt;スケール&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;CONTAINSオペランド小詞リスト&gt;＊ ::=</dt>
    <dd>
      &lt;CONTAINSオペランド小詞&gt; [ &lt;CONTAINSオペランド小詞&gt; ... ]</dd>

    <dt class="bold">&lt;CONTAINSオペランド小詞&gt;＊ ::=</dt>
    <dd>
      &lt;CONTAINSワード&gt;</dd>
    <dd>|&nbsp;SYNONYM &lt;左括弧&gt; &lt;CONTAINSオペランドワードリスト&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;EXPAND_SYNONYM &lt;左括弧&gt; &lt;CONTAINSオペランドワード&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;WITHIN &lt;左括弧&gt; &lt;CONTAINSオペランド小詞リスト&gt;
      [ &lt;出現順序指定&gt; ] [ &lt;下限指定&gt; ] &lt;上限指定&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;HEAD &lt;左括弧&gt; &lt;CONTAINSオペランド小詞&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;TAIL &lt;左括弧&gt; &lt;CONTAINSオペランド小詞&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;CONTAINSオペランドワードリスト&gt;＊ ::=</dt>
    <dd>
      &lt;CONTAINSオペランドワード&gt; [ &lt;CONAINSオペランドワード&gt; ... ]</dd>

    <dt class="bold">&lt;CONTAINSオペランドワード&gt;＊ ::=</dt>
    <dd>&lt;CONTAINSオペランドパターン&gt;</dd>
    <dd>|&nbsp;STRING &lt;左括弧&gt; &lt;CONTAINSオペランドパターン&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;EXACTWORD &lt;左括弧&gt; &lt;CONTAINSオペランドパターン&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;SIMPLEWORD &lt;左括弧&gt; &lt;CONTAINSオペランドパターン&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;WORDHEAD &lt;左括弧&gt; &lt;CONTAINSオペランドパターン&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;WORDTAIL &lt;左括弧&gt; &lt;CONTAINSオペランドパターン&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;CONTAINSオペランド一次子&gt;が
      &lt;CONTAINSオペランドパターン&gt;のみから構成される場合に適用される検索単位は
      索引タイプにより異なります。

      <table>
        <thead>
          <tr>
            <th>索引タイプ</th>
            <th>検索単位</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>NGRAM</td>
            <td>文字列</td>
          </tr>
          <tr>
            <td>WORD</td>
            <td>単語</td>
          </tr>
          <tr>
            <td>DUAL</td>
            <td>&lt;オペランドパターン&gt;がASCIIの範囲内なら単語、それ以外は文字列
            </td>
          </tr>
        </tbody>
      </table>
    </li>

    <li>単語単位検索では、
      形態素解析で得られた文書中の単語(形態素)境界を含んだ索引を利用しています。</li>

    <li>検索モードには、文字列単位検索と単語単位検索と
      文字列単位と単語単位を組み合わせた検索の3種類あります。
      各検索モードの説明は以下のとおりです。

      <table>
        <thead>
          <tr>
            <th>検索モード名</th>
            <th>検索単位</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>STRING</td>
            <td>文字列</td>
            <td>検索文字列を含むデータを検索する。</td>
          </tr>
          <tr>
            <td>EXACTWORD</td>
            <td>単語</td>
            <td>検索文字列を含み、かつ検索文字列の前方と後方と検索文字列内部のすべての単語境界も一致するデータを検索します。</td>
          </tr>
          <tr>
            <td>SIMPLEWORD</td>
            <td>混合</td>
            <td>検索文字列を含み、かつ検索文字列の前方と後方の単語境界も一致するデータを検索します。</td>
          </tr>
          <tr>
            <td>WORDHEAD</td>
            <td>単語</td>
            <td>検索文字列を含み、かつ検索文字列の前方の単語境界も一致するデータを検索します。</td>
          </tr>
          <tr>
            <td>WORDTAIL</td>
            <td>混合</td>
            <td>検索文字列を含み、かつ検索文字列の後方の単語境界も一致するデータを検索します。
            </td>
          </tr>
        </tbody>
      </table>
    </li>

    <li>各検索モードを使用できる索引タイプは以下のとおりです。

      <table>
        <thead>
          <tr>
            <th rowspan=2>検索モード名</th>
            <th rowspan=2>検索単位</th>
            <th colspan=3>索引タイプ</th>
            <!-- <th></th> -->
            <!-- <th></th> -->
          </tr>
          <tr>
            <!-- <td></td> -->
            <!-- <td></td> -->
            <td>NGRAM</td>
            <td>WORD</td>
            <td>DUAL</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>STRING</td>
            <td>文字列</td>
            <td>○</td>
            <td>×</td>
            <td>○</td>
          </tr>
          <tr>
            <td>EXACTWORD</td>
            <td>単語</td>
            <td>×</td>
            <td>○</td>
            <td>○</td>
          </tr>
          <tr>
            <td>SIMPLEWORD</td>
            <td>混合</td>
            <td>×</td>
            <td>×</td>
            <td>○</td>
          </tr>
          <tr>
            <td>WORDHEAD</td>
            <td>単語</td>
            <td>×</td>
            <td>○</td>
            <td>○</td>
          </tr>
          <tr>
            <td>WORDTAIL</td>
            <td>混合</td>
            <td>×</td>
            <td>×</td>
            <td>○</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ul>

  <ul>
    <li>SYNONYMは&lt;CONTANSオペランドワードリスト&gt;を同義語として検索します。
      単純に同義語を論理和で並べて検索すると、同義語が多い検索語の方がスコアが大きく
      なりますが、SYNONYMを利用するとそれを防ぐことができます。</li>

    <li>EXPAND_SYNONYMは同義語辞書を利用し&lt;CONTAINSオペランドワード&gt;を展開して
      検索します。</li>

    <li>WITHINは近接演算を行います。</li>
    <li>&lt;上限指定&gt;と&lt;下限指定&gt;は、
      最初に現れた&lt;CONTAINSオペランドパターン&gt;の末尾と、
      最後に現れた&lt;CONTAINSオペランドパターン&gt;の先頭との
      距離の最大値と最小値を示します。</li>
    <li>WITHINの距離の単位は、
      &lt;索引タイプ&gt;がNGRAMまたはDUALのときは文字数、WORDのときは単語数です。</li>
    <li>&lt;CONTAINSオペランドパターン&gt;が連なった場合、距離は 1 となります。</li>

    <li>HEADは、&lt;CONTAINSオペランド小詞&gt;の先頭が一致するデータを検索します。</li>
    <li>TAILは、&lt;CONTAINSオペランド小詞&gt;の末尾が一致するデータを検索します。</li>

    <li>WEIGHTは個々のパターンの重要度を調整します。</li>
    <li>WEIGHTが使われなかったときの&lt;スケール&gt;のデフォルトは1.0です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;出現順序指定&gt; ::=</dt>
    <dd>SYMMETRIC</dd>
    <dd>|&nbsp;ASYMMETRIC</dd>
  </dl>

  <ul>
    <li>SYMMETRICは、&lt;CONTAINSオペランドパターン&gt;が
      &lt;CONTAINSオペランドパターンリスト&gt;順に出現することを指定します。</li>
    <li>ASYMMETRICは、&lt;CONTAINSオペランドパターン&gt;の出現順に
      制約がないことを意味します。</li>
    <li>&lt;出現順序指定&gt;が省略された場合は、SYMMETRICが指定されたとみなされます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;CONTAINSオペランドパターンリスト&gt;＊ ::=</dt>
    <dd>
      &lt;CONTAINSオペランドパターン&gt; [ &lt;CONTAINSオペランドパターン&gt; ... ]</dd>

    <dt class="bold">&lt;CONTAINSオペランドパターン&gt;＊ ::=</dt>
    <dd>&lt;単語式&gt; [ LANGUAGE &lt;言語値&gt; ]</dd>
  </dl>

  <ul>
    <li>LANGUAGEの&lt;言語値&gt;が省略された場合は、
      索引の定義時に使用した&lt;UNAリソース指定&gt;で指定された辞書のデフォルト言語が
      使用されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;単語式&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
    <dd>|&nbsp;STRING &lt;左括弧&gt; &lt;文字列式&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;EXACTWORD &lt;左括弧&gt; &lt;文字列式&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;SIMPLEWORD &lt;左括弧&gt; &lt;文字列式&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;WORDHEAD &lt;左括弧&gt; &lt;文字列式&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;WORDTAIL &lt;左括弧&gt; &lt;文字列式&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;CONTAINS演算子&gt;＊ ::=</dt>
    <dd>&lt;アンパーサンド&gt;</dd>
    <dd>|&nbsp;&lt;縦棒&gt;</dd>
    <dd>|&nbsp;&lt;負符号&gt;</dd>
  </dl>

  <ul>
    <li>&lt;アンパーサンド&gt;は、AND演算子(&amp;)を意味します。</li>
    <li>&lt;縦棒&gt;は、OR演算子(|)を意味します。</li>
    <li>&lt;負符号&gt;は、ANDNOT演算子(-)を意味します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;スコア合成器指定&gt;＊ ::=</dt>
    <dd>COMBINER &lt;スコア合成器&gt;</dd>
  </dl>

  <ul>
    <li>&lt;スコア合成器指定&gt;の省略時は、&lt;スコア合成器&gt;にはSumが指定されたとみなします。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;スコア合成器&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;スコア合成器&gt;としてサポートしているのは、以下のものです。

      <dl>
        <dt>Sum</dt>
        <dd>算術和</dd>
        <dt>ASum</dt>
        <dd>代数和</dd>
        <dt>Prod</dt>
        <dd>算術積</dd>
        <dt>Max</dt>
        <dd>最大値</dd>
        <dt>Min</dt>
        <dd>最小値</dd>
      </dl>
    </li>
  </ul>

  <ul>
    <li>代数和は、スコアX、Yを X + Y - XY で演算します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;下限指定&gt;＊ ::=</dt>
    <dd>LOWER &lt;値指定&gt;</dd>

    <dt class="bold">&lt;上限指定&gt;＊ ::=</dt>
    <dd>UPPER &lt;値指定&gt;</dd>

    <dt class="bold">&lt;スケール&gt;＊ ::=</dt>
    <dd>SCALE &lt;値指定&gt;</dd>
  </dl>

  <ul>
    <li>&lt;スケール&gt;の&lt;値指定&gt;は、0以上の実数値で指定します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;単語リスト&gt;＊ ::=</dt>
    <dd>WORDLIST &lt;左括弧&gt; &lt;単語要素リスト&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;単語要素リスト&gt;＊ ::=</dt>
    <dd>&lt;単語要素&gt; [ { &lt;カンマ&gt; &lt;単語要素&gt; } ... ]</dd>

    <dt class="bold">&lt;単語要素&gt;＊ ::=</dt>
    <dd>&lt;単語式&gt;</dd>
    <dd>|&nbsp;CATEGORY &lt;単語カテゴリー&gt;</dd>
    <dd>|&nbsp;SCALE &lt;数値式&gt;</dd>
    <dd>|&nbsp;LANGUAGE &lt;言語値&gt;</dd>
    <dd>|&nbsp;DF &lt;数値式&gt;</dd>
  </dl>

  <ul>
    <li>LANGUAGEの&lt;言語値&gt;が指定されなかった場合は、
      索引の定義時に使用した&lt;UNAリソース指定&gt;で指定された辞書のデフォルト言語が
      使用されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;単語カテゴリー&gt;＊ ::=</dt>
    <dd>&lt;文字列式&gt;</dd>
  </dl>

  <ul>
    <li>&lt;単語カテゴリー&gt;としてサポートしているものは、以下のものです。

      <table>
        <thead>
          <tr>
            <th>単語カテゴリー</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Essential</td>
            <td>必須</td>
          </tr>
          <tr>
            <td>Important</td>
            <td>重要</td>
          </tr>
          <tr>
            <td>Helpful</td>
            <td>有用 (デフォルト)</td>
          </tr>
          <tr>
            <td>EssentialRelated</td>
            <td>必須関連語</td>
          </tr>
          <tr>
            <td>ImportantRelated</td>
            <td>重要関連語</td>
          </tr>
          <tr>
            <td>HelpfulRelated</td>
            <td>有用関連語
            </td>
          </tr>
        </tbody>
      </table>
    </li>

  </ul>

  <dl>
    <dt class="bold">&lt;自然文指定&gt;＊ ::=</dt>
    <dd>FREETEXT &lt;左括弧&gt; &lt;文字列式&gt; [ LANGUAGE &lt;言語値&gt;] &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;自然文指定&gt;は、論理演算や近接演算と同時使用できません。</li>
    <li>LANGUAGEの&lt;言語値&gt;が省略された場合は、
      索引の定義時に使用した&lt;UNAリソース指定&gt;で指定された辞書のデフォルト言語が
      使用されます。</li>
  </ul>

  <h3><a id="sec605">6.5 スキーマ定義</a></h3>

  <p class="first">DoqueDBがサポートするスキーマ定義および操作について説明します。
    スキーマ定義および操作は、SQLトランザクション中には実行できません。</p>

  <p>&lt;データベース名&gt;、&lt;エリア名&gt;、&lt;表名&gt;、&lt;列名&gt;、&lt;子サーバー名&gt;
    に共通する仕様は以下のとおりです。</p>

  <ul>
    <li>ASCII以外の文字を含む任意の文字を使用できます。
      ただし、OSでパス名を構成する文字
      (スラッシュ、バックスラッシュ、コロンなど)とセミコロンを除きます。</li>
    <li>先頭の文字に数字は使えません。</li>
    <li>&lt;<a href="#sec60103">キーワード</a>&gt;と同一の文字列は使えません。</li>
    <li>文字列が50文字を超えるとエラーを返します。</li>
    <li>大文字と小文字の違いは無視されます。</li>
    <li>文字列に空白や引用符を含めるときは、文字列全体を二重引用符で囲みます。</li>
    <li>文字列に二重引用符を含めるときは、二重引用符を2つ書きます。</li>
  </ul>

  <h4><a id="sec60501">6.5.1 データベース定義</a></h4>

  <p class="first">データベースを定義します。これらは、DoqueDBで拡張された式です。
    データベースとは、表、索引などの集合を管理するためのものです。
    また、データベースはセッションがアクセスする単位ともなります。
    セッションは、1つのデータベースにしかアクセスできません。</p>

  <dl>
    <dt class="bold">&lt;データベース定義&gt;＊ ::=</dt>
    <dd>
      CREATE DATABASE &lt;データベース名&gt; [ &lt;データベース属性指定&gt;... ]</dd>
  </dl>

  <ul>
    <li>&lt;データベース定義&gt;では、&lt;データベース名&gt;は省略できません。</li>
    <li>&lt;データベース名&gt;には、
      既存の&lt;データベース名&gt;と同じ名前の&lt;データベース名&gt;を使えません。</li>
    <li>&lt;データベース名&gt;の詳細については、<a href="#sec605">スキーマ定義</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;データベース属性指定&gt;＊ ::=</dt>
    <dd>&lt;パス指定&gt;</dd>
    <dd>|&nbsp;&lt;書き込み属性&gt;</dd>
    <dd>|&nbsp;&lt;オンライン属性&gt;</dd>
    <dd>|&nbsp;&lt;リカバリ属性&gt;</dd>

    <dt class="bold">&lt;パス指定&gt;＊ ::=</dt>
    <dd>PATH &lt;パス指定要素&gt; [&lt;パス指定要素&gt;...]</dd>

    <dt class="bold">&lt;パス指定要素&gt;＊ ::=</dt>
    <dd>&lt;データ格納パス指定&gt;</dd>
    <dd>|&nbsp;&lt;論理ログ格納パス指定&gt;</dd>
    <dd>|&nbsp;&lt;システム表格納パス指定&gt;</dd>
  </dl>

  <ul>
    <li>&lt;パス指定要素&gt;に指定する&lt;文字列定数&gt;には、
      存在しないディレクトリを指定しなければなりません。</li>
    <li>&lt;パス指定要素&gt;に指定する&lt;文字列定数&gt;の最大長は100文字です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;データ格納パス指定&gt;＊ ::=</dt>
    <dd>&lt;文字列定数&gt;</dd>

    <dt class="bold">&lt;論理ログ格納パス指定&gt;＊ ::=</dt>
    <dd>LOGICALLOG &lt;文字列定数&gt;</dd>

    <dt class="bold">&lt;システム表格納パス指定&gt;＊ ::=</dt>
    <dd>SYSTEM &lt;文字列定数&gt;</dd>
  </dl>

  <h4><a id="sec60502">6.5.2 エリア定義</a></h4>

  <p class="first">エリアを定義します。これらは、DoqueDBで拡張された式です。
    エリアとは、データベースファイルを格納するパスを指定するためのオブジェクトです。</p>

  <dl>
    <dt class="bold">&lt;エリア定義&gt;＊ ::=</dt>
    <dd>CREATE AREA &lt;エリア名&gt; &lt;エリアパス&gt;</dd>

    <dt class="bold">&lt;エリアパス&gt;＊ ::=</dt>
    <dd>&lt;エリアパス要素&gt;</dd>
    <dd>|&nbsp;&lt;エリアパス配列&gt;</dd>

    <dt class="bold">&lt;エリアパス配列&gt;＊ ::=</dt>
    <dd>ARRAY &lt;左角括弧&gt; &lt;エリアパス配列要素リスト&gt; &lt;右角括弧&gt;</dd>
  </dl>

  <ul>
    <li>現在のバージョンでは、&lt;エリアパス&gt;に&lt;エリアパス配列&gt;を設定しても、
      先頭要素のパスしか有効になりません。その他の要素のパスは無視されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;エリアパス配列要素リスト&gt;＊ ::=</dt>
    <dd>
      &lt;エリアパス要素&gt; [ { &lt;カンマ&gt; &lt;エリアパス要素&gt; } ... ]</dd>

    <dt class="bold">&lt;エリアパス要素&gt;＊ ::=</dt>
    <dd>&lt;文字列定数&gt;</dd>
  </dl>

  <h4><a id="sec60503">6.5.3 表定義</a></h4>

  <p class="first">表を定義します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;表定義文&gt; ::=</dt>
    <dd>CREATE TABLE &lt;表名&gt; &lt;表要素リスト&gt; [ &lt;表エリア句&gt; ]</dd>
  </dl>

  <ul>
    <li>&lt;表名&gt;に#で始まる文字列を指定すると、一時表が作成されます。</li>
    <li>&lt;表名&gt;には、同じデータベース内の
      既存の&lt;表名&gt;と同じ名前の&lt;表名&gt;を使えません。</li>
    <li>&lt;表名&gt;の詳細については、<a href="#sec605">スキーマ定義</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;表要素リスト&gt;＊ ::=</dt>
    <dd>&lt;左括弧&gt; &lt;表要素&gt; [ { &lt;カンマ&gt; &lt;表要素&gt; } ... ] &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;表要素&gt; ::=</dt>
    <dd>&lt;列定義&gt;</dd>
    <dd>|&nbsp;&lt;表制約定義&gt;</dd>

    <dt class="bold">&lt;表制約定義&gt; ::=</dt>
    <dd>&lt;表制約&gt;</dd>

    <dt class="bold">&lt;表制約&gt; ::=</dt>
    <dd>&lt;一意性制約定義&gt;</dd>
    <dd>|&nbsp;&lt;参照制約定義&gt;</dd>

    <dt class="bold">&lt;一意性制約定義&gt; ::=</dt>
    <dd>&lt;一意性指定&gt; &lt;左括弧&gt; &lt;一意列リスト&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;一意性指定&gt; ::=</dt>
    <dd>UNIQUE</dd>
    <dd>|&nbsp;PRIMARY KEY</dd>
  </dl>

  <ul>
    <li>&lt;一意性指定&gt;を行うとB木索引が自動的に作成されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;一意列リスト&gt; ::=</dt>
    <dd>&lt;列名リスト&gt;</dd>

    <dt class="bold">&lt;列名リスト&gt; ::=</dt>
    <dd>&lt;列名&gt; [ { &lt;カンマ&gt; &lt;列名&gt; } ... ]</dd>

    <dt class="bold">&lt;参照制約定義&gt; ::=</dt>
    <dd>FOREIGN KEY &lt;左括弧&gt; &lt;参照列&gt; &lt;右括弧&gt; &lt;被参照表指定&gt;</dd>

    <dt class="bold">&lt;被参照表指定&gt; ::=</dt>
    <dd>REFERENCES &lt;被参照表&gt; [ &lt;左括弧&gt; &lt;被参照列&gt; &lt;右括弧&gt; ]</dd>

    <dt class="bold">&lt;参照列&gt; ::=</dt>
    <dd>&lt;列名リスト&gt;</dd>

    <dt class="bold">&lt;非参照列&gt; ::=</dt>
    <dd>&lt;表名&gt;</dd>

    <dt class="bold">&lt;被参照列&gt; ::=</dt>
    <dd>&lt;列名リスト&gt;</dd>

    <dt class="bold">&lt;表エリア句&gt; ::=</dt>
    <dd>AREA &lt;表エリア指定&gt;</dd>

    <dt class="bold">&lt;表エリア指定&gt; ::=</dt>
    <dd>
      &lt;エリア名&gt; [ HEAP &lt;エリア名&gt; ] [ INDEX &lt;エリア名&gt; ] [ FULLTEXT &lt;エリア名&gt; ]</dd>
  </dl>

  <ul>
    <li>&lt;一意性指定&gt;を行うとB木索引が自動的に作成されます。</li>
    <li>&lt;表名&gt;に#で始まる文字列を指定すると、一時表が作成されます。</li>
    <li>参照制約定義を行うと参照列をキーにしたB木索引が自動的に作成されます。</li>
    <li>参照制約定義を行うと、以下のような更新操作が制約違反になります。<br>
      まず、被参照表(ReferredTable)と参照制約つきの表(TBL)を定義し、被参照表に値を登録します。
      <pre>
SQL&gt; create table ReferredTable (p int, primary key(p));
SQL&gt; create table TBL (f int, ref int, foreign key(ref) references ReferredTable(p));
SQL&gt; insert into ReferredTable values (1), (2), (3);
</pre>
      このとき、たとえばNULLでもなく被参照表の被参照列にも登録されていない値を
      参照列の値に設定することは制約違反です。<br>
      以下は正しいSQLです。
      <pre>
SQL&gt; insert into TBL(f, ref) values (100, 1);
</pre>
      1はReferredTable.pの値として存在するため、insertに成功します。<br>
      以下は参照制約違反のSQLです。
      <pre class="bad-example">
SQL&gt; insert into TBL(f, ref) values (500, 5);
(不正なSQLの例)
</pre>
      5はReferredTable.pの値として存在しないため、insertに失敗します。<br>
      同様に、参照列の値に設定されているものと同じ値を被参照列に持つレコードを
      被参照列から削除することは制約違反です。<br>
      以下は正しいSQLです。
      <pre>
SQL&gt; delete from TBL where p = 2;
</pre>
      2はTBK.refの値として使用されていないため、deleteに成功します。<br>
      以下は参照制約違反のSQLです。
      <pre class="bad-example">
SQL&gt; delete from TBL where p = 1;
(不正なSQLの例)
</pre>
      1はTBK.refの値として使用されているため、deleteに失敗します。
    </li>
  </ul>

  <h4><a id="sec60504">6.5.4 列定義</a></h4>

  <p class="first">列を定義します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;列定義&gt; ::=</dt>
    <dd>
      &lt;列名&gt; &lt;データ型&gt; [ &lt;DEFAULT句&gt; ] [ &lt;IDENTITY列指定&gt; ] [ &lt;列制約定義&gt; ... ]
      [ &lt;ヒント句&gt;＊ ]</dd>
  </dl>

  <ul>
    <li>列を作成するときは、列に格納する値の<a href="#sec60201">データ型</a>を指定しなければなりません。</li>
    <li>データ型により、列はある同一の形式をもつ値の集合と位置付けられます。</li>
    <li>&lt;列名&gt;には、同じ表内の
      既存の&lt;列名&gt;と同じ名前の&lt;列名&gt;を使えません。</li>
    <li>&lt;列名&gt;の詳細については、<a href="#sec605">スキーマ定義</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;DEFAULT句&gt; ::=</dt>
    <dd>DEFAULT &lt;既定値オプション&gt;</dd>
  </dl>

  <ul>
    <li>&lt;DEFAULT句&gt; が省略された場合、
      &lt;既定値オプション&gt;にNULLが指定されたとみなします。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;既定値オプション&gt; ::=</dt>
    <dd>&lt;定数&gt;</dd>
    <dd>|&nbsp;&lt;日時値関数&gt; [ USING ON UPDATE＊]</dd>
    <dd>|&nbsp;NULL</dd>
  </dl>

  <ul>
    <li>&lt;既定値オプション&gt;に&lt;日時値関数&gt;を指定したADD COLUMNはサポートしていません。</li>
    <li>DATETIME型以外に対して、&lt;既定値オプション&gt;に&lt;日時値関数&gt;を指定すると、
      定義時にエラーが発生します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;IDENTITY列指定&gt; ::=</dt>
    <dd>GENERATED { ALWAYS |&nbsp;BY DEFAULT } AS IDENTITY
      [ &lt;左括弧&gt; &lt;シーケンス生成器オプション&gt; ... &lt;右括弧&gt; ]</dd>
  </dl>

  <ul>
    <li>&lt;シーケンス生成器オプション&gt;は、空白で区切って複数書くことができます。</li>
    <li>&lt;シーケンス生成器オプション&gt;は、同じ種類を2つ以上指定できません。</li>
    <li>IDENTITY列指定のある列は1つの表に1つまで定義できます。</li>
    <li>IDENTITY列指定のある列を ADD COLUMN することはできません。</li>
    <li>IDENTITY列指定のある列は、NOT NULL制約が自動的に付加されます。</li>
    <li>INT型列以外にIDENTITY列指定をつけるとエラーになります。</li>
    <li>IDENTITY列に対して生成される値は、
      トランザクションがロールバックしても取り消されません。
      つまり、あるトランザクションで実行されたINSERT文で
      IDENTITY列に対して0から10までの値が生成された場合、
      そのトランザクションがコミットしてもロールバックしても、
      次に生成される値は11からになります。</li>
    <li>ただし、ロールバックした後にサーバーが何らかの理由で異常終了した場合、
      再起動後に行われるINSERT文で異常終了前にロールバックしたトランザクションで
      すでに生成された値が再び現れることがあります。
      この場合でも以前にその値が生成されたトランザクションは
      ロールバックしているので、IDENTITY列の値に重複が生じることはありません。
      (CYCLE指定時を除きます。)</li>
    <li>詳細については、<a href="#secapp">附録</a>の<a href="#secappd">IDENTITY列の使い方</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;シーケンス生成器オプション&gt; ::=</dt>
    <dd>START WITH &lt;数値式&gt;</dd>
    <dd>|&nbsp;INCREMENT BY &lt;数値式&gt;</dd>
    <dd>|&nbsp;{ MAXVALUE &lt;数値式&gt; |&nbsp;NO MAXVALUE }</dd>
    <dd>|&nbsp;{ MINVALUE &lt;数値式&gt; |&nbsp;NO MINVALUE }</dd>
    <dd>|&nbsp;[ NO ] CYCLE</dd>
    <dd>|&nbsp;GET MAX＊</dd>
  </dl>

  <ul>
    <li>&lt;シーケンス生成器オプション&gt;の詳細は以下のとおりです。

      <table>
        <thead>
          <tr>
            <th>書式</th>
            <th>説明</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>START WITH &lt;数値式&gt;</td>
            <td>生成される値の初期値を指定します。<ul>
                <li>省略時は0が指定されたものとみなされます。</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>INCREMENT BY &lt;数値式&gt;</td>
            <td>生成される値の増分を指定します。<ul>
                <li>0は指定できません。</li>
                <li>負の値を指定することもできます。</li>
                <li>省略時は1が指定されたものとみなされます。</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>MAXVALUE &lt;数値式&gt;</td>
            <td>生成される値の最大値を指定します。<ul>
                <li>次に生成される値がこの値を超えるときの動作はCYCLEの指定により変わります。</li>
                <li>省略時は2147483647が指定されたものとみなされます。</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>NO MAXVALUE</td>
            <td>MAXVALUE 2147483647と同じ意味です。</td>
          </tr>
          <tr>
            <td>MINVALUE &lt;数値式&gt;</td>
            <td>生成される値の最小値を指定します。<ul>
                <li>次に生成される値がこの値を下回るときの動作はCYCLEの指定により変わります。</li>
                <li>省略時は0が指定されたものとみなされます。</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>NO MINVALUE</td>
            <td>MINVALUE 0と同じ意味です。</td>
          </tr>
          <tr>
            <td>CYCLE</td>
            <td>生成される値の繰り返しを指定します。<ul>
                <li>増分が正の数のとき、次に生成される値が最大値を超えるときは代わりに最小値の値を生成します。</li>
                <li>増分が負の数のとき、次に生成される値が最小値を下回るときは代わりに最大値の値を生成します。</li>
                <li>省略時はNO CYCLEと同じ意味になります。</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>NO CYCLE</td>
            <td>生成される値を繰り返さない指定をします。<ul>
                <li>次に生成される値が最大値を超えるか、最小値を下回るときはエラーになります。</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>GET MAX</td>
            <td>生成される値の基点を更新する指定をします。<ul>
                <li>増分が正の数のとき、次に生成される値は元の基点とすでに設定された値のうち大きい方を基点とします。</li>
                <li>増分が負の数のとき、次に生成される値は元の基点とすでに設定された値のうち小さい方を基点とします。</li>
                <li>DoqueDBで拡張された仕様です。</li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </li>

  </ul>

  <dl>
    <dt class="bold">&lt;列制約定義&gt; ::=</dt>
    <dd>&lt;列制約&gt;</dd>

    <dt class="bold">&lt;列制約&gt; ::=</dt>
    <dd>NOT NULL</dd>
  </dl>

  <h4><a id="sec60505">6.5.5 ヒント句</a></h4>

  <p class="first">ヒントを指定します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;ヒント句&gt;＊ ::=</dt>
    <dd>HINT [ HEAP ] [NONTRUNCATE] [ &lt;ヒントオプション&gt; ]</dd>
  </dl>

  <ul>
    <li>&lt;ヒント句&gt;には、HEAP、NONTRUNCATE、&lt;ヒントオプション&gt;の
      いずれかを指定しなければなりません。</li>
    <li>HEAPは、<a href="#sec606">索引定義</a>時には指定できません。</li>
    <li>HEAPは、その列のデータだけ別レコードファイルにします。</li>
    <li>HEAPの使用例は、<a href="#secapp">附録</a>の<a href="#secappb">ヒント句の使い方</a>を参照してください。</li>
    <li>NONTRUNCATEは、<a href="#sec606">索引定義</a>時には指定できません。</li>
    <li>NONTRUNCATEは、可変長文字列型および可変長国際文字列型の
      末尾の空白を無視しなくなります。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;ヒントオプション&gt;＊ ::=</dt>
    <dd>&lt;引用符&gt; &lt;ヒントリスト&gt; &lt;引用符&gt;</dd>
  </dl>

  <ul>
    <li>&lt;ヒントオプション&gt;は&lt;引用符&gt;で囲む必要があります。
      上記のHEAPやNONTRUNCATEとは異なることに注意してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;ヒントリスト&gt;＊ ::=</dt>
    <dd>&lt;ヒント&gt; [ { &lt;カンマ&gt; &lt;ヒント&gt; } ... ]</dd>

    <dt class="bold">&lt;ヒント&gt;＊ ::=</dt>
    <dd>&lt;正規化ヒント&gt;</dd>
    <dd>|&nbsp;COMPRESSED</dd>
    <dd>|&nbsp;DELAYED</dd>
    <dd>|&nbsp;FIXED</dd>
    <dd>|&nbsp;INVERTED = &lt;左括弧&gt; &lt;転置ヒントリスト&gt; &lt;右括弧&gt;</dd>
    <dd>|&nbsp;KWIC</dd>
  </dl>

  <ul>
    <li>COMPRESSEDは、文字列やバイナリーを圧縮して格納します。</li>
    <li>DELAYEDの詳細については、<a href="#sec103">遅延更新</a>を参照してください。</li>
    <li>FIXEDは、文字列やバイナリーが可変長の型でも固定長用のファイルに格納します。</li>
    <li>FIXEDの使用例は、<a href="#secapp">附録</a>の<a href="#secappb">ヒント句の使い方</a>を参照してください。</li>
    <li>KWICは、KWIC関数を使用する際に必要な情報を格納します。</li>
  </ul>

  <ul>
    <li>各定義に使える&lt;ヒント&gt;は以下のとおりです。

      <table>
        <thead>
          <tr>
            <th rowspan=2>定義対象</th>
            <th colspan=6>ヒント</th>
            <!-- <th></th> -->
            <!-- <th></th> -->
            <!-- <th></th> -->
            <!-- <th></th> -->
            <!-- <th></th> -->
          </tr>
          <tr>
            <!-- <td></td> -->
            <td>&lt;正規化ヒント&gt;</td>
            <td>COMPRESSED</td>
            <td>DELAYED</td>
            <td>FIXED</td>
            <td>INVERTED</td>
            <td>KWIC</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>&lt;列定義&gt;</td>
            <td>×</td>
            <td>○</td>
            <td>×</td>
            <td>○</td>
            <td>×</td>
            <td>×</td>
          </tr>
          <tr>
            <td>&lt;B+木索引定義&gt;</td>
            <td>○</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
          </tr>
          <tr>
            <td>&lt;全文索引定義&gt;</td>
            <td>× ※</td>
            <td>×</td>
            <td>○</td>
            <td>×</td>
            <td>○</td>
            <td>○</td>
          </tr>
          <tr>
            <td>&lt;ビットマップ索引定義&gt;</td>
            <td>×</td>
            <td>○</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
          </tr>
          <tr>
            <td>&lt;配列索引定義&gt;</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
            <td>×</td>
          </tr>
        </tbody>
      </table>
      ※ &lt;全文索引定義&gt;で正規化する場合は、&lt;転置ヒントリスト&gt;内で&lt;転置正規化ヒント&gt;を使ってください。
    </li>
  </ul>
  <dl>
    <dt class="bold">&lt;正規化ヒント&gt;＊ ::=</dt>
    <dd>NORMALIZED [ &lt;等号演算子&gt; &lt;正規化指定&gt; ]</dd>

    <dt class="bold">&lt;正規化指定&gt;＊ ::=</dt>
    <dd>{ TRUE |&nbsp;FALSE }</dd>

    <dt class="bold">&lt;転置ヒントリスト&gt;＊ ::=</dt>
    <dd>&lt;転置ヒント&gt; [ &lt;カンマ&gt; &lt;転置ヒント&gt; ]</dd>

    <dt class="bold">&lt;転置ヒント&gt;＊ ::=</dt>
    <dd>&lt;転置正規化ヒント&gt;</dd>
    <dd>|&nbsp;&lt;索引タイプ指定&gt;</dd>
    <dd>|&nbsp;&lt;言語指定&gt;</dd>
    <dd>|&nbsp;&lt;トークナイズ指定&gt;</dd>
    <dd>|&nbsp;&lt;圧縮器指定&gt;</dd>
    <dd>|&nbsp;&lt;ヒント抽出指定&gt;</dd>

    <dt class="bold">&lt;転置正規化ヒント&gt;＊ ::=</dt>
    <dd>NORMALIZED &lt;等号演算子&gt; &lt;正規化指定&gt;</dd>

    <dt class="bold">&lt;転置正規化指定&gt;＊ ::=</dt>
    <dd>{ TRUE |&nbsp;FALSE }</dd>
    <dd>|&nbsp;&lt;左括弧&gt; &lt;転置正規化要素リスト&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;転置正規化要素リスト&gt;＊ ::=</dt>
    <dd>&lt;転置正規化要素&gt; [ &lt;カンマ&gt; &lt;転置正規化要素&gt; ]</dd>

    <dt class="bold">&lt;転置正規化要素&gt;＊ ::=</dt>
    <dd>&lt;ステミング指定&gt;</dd>
    <dd>|&nbsp;&lt;スペース削除指定&gt;</dd>

    <dt class="bold">&lt;ステミング指定&gt;＊ ::=</dt>
    <dd>STEMMING = { TRUE |&nbsp;FALSE }</dd>

    <dt class="bold">&lt;スペース削除指定&gt;＊ ::=</dt>
    <dd>DELETESPACE = { TRUE |&nbsp;FALSE }</dd>

    <dt class="bold">&lt;索引タイプ指定&gt;＊ ::=</dt>
    <dd>INDEXING = &lt;索引タイプ&gt;</dd>
  </dl>

  <ul>
    <li>&lt;索引タイプ指定&gt;を省略した場合は、
      索引タイプにNGRAMが指定されたとみなされます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引タイプ&gt;＊ ::=</dt>
    <dd>DUAL</dd>
    <dd>|&nbsp;NGRAM</dd>
    <dd>|&nbsp;WORD</dd>
  </dl>

  <ul>
    <li>各&lt;索引タイプ&gt;の説明は<a href="#sec102">索引タイプ</a>を参照してください。</li>
    <li>WORDまたはDUALを指定して全文索引を作成し、単語単位検索をする場合は、
      &lt;<a href="#sec60602">全文索引定義</a>&gt;の&lt;言語列指定&gt;や<a href="#secappe">異表記正規化辞書</a>を
      適切に指定する必要があります。詳細については、<a href="#sec306">多言語対応</a>を参照してください。</li>
    <li>&lt;索引タイプ&gt;が指定されなかった場合は、NGRAMが使用されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;言語指定&gt;＊ ::=</dt>
    <dd>LANGUAGE = &lt;言語値&gt;</dd>
  </dl>

  <ul>
    <li>&lt;言語列指定&gt;が省略された際に用いられるデフォルト言語を指定します。</li>
    <li>&lt;言語指定&gt;が指定されなかった場合は、
      索引の定義時に使用した&lt;UNAリソース指定&gt;で指定された辞書のデフォルト言語が
      使用されます。</li>
    <li>まったく言語の指定がなく、&lt;正規化指定&gt;を指定した場合は、エラーになります。</li>
    <li>&lt;言語値&gt;としてサポートしている値は、<a href="#sec60201">データ型</a>の&lt;言語型&gt;を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;トークナイズ指定&gt;＊ ::=</dt>
    <dd>
      TOKENIZER = &lt;トークナイズパラメーター&gt; &lt;UNAリソースリスト&gt;</dd>
  </dl>

  <ul>
    <li>&lt;トークナイズ指定&gt;が指定されなかった場合は、
      「NGR:1:1 @NORMRSCID:1」が使用されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;トークナイズパラメーター&gt;＊ ::=</dt>
    <dd>&lt;NGRパラメーター&gt;</dd>
    <dd>|&nbsp;&lt;BNGパラメーター&gt;</dd>
    <dd>|&nbsp;&lt;DUALパラメーター&gt;</dd>
  </dl>

  <ul>
    <li>&lt;トークナイズパラメーター&gt;は&lt;索引タイプ&gt;に応じて指定します。
      &lt;索引タイプ&gt;と指定できる&lt;トークナイズパラメーター&gt;の関係は以下のとおりです。

      <table>
        <thead>
          <tr>
            <th rowspan=2>索引タイプ</th>
            <th colspan=3>トークナイズパラメーター</th>
            <!-- <th></th> -->
            <!-- <th></th> -->
          </tr>
          <tr>
            <!-- <td></td> -->
            <td>NGR</td>
            <td>BNG</td>
            <td>DUAL</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>NGRAM</td>
            <td>○</td>
            <td>○</td>
            <td>○</td>
          </tr>
          <tr>
            <td>DUAL</td>
            <td>×</td>
            <td>×</td>
            <td>○</td>
          </tr>
          <tr>
            <td>WORD</td>
            <td>×</td>
            <td>×</td>
            <td>○</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ul>

  <ul>
    <li>&lt;トークナイズパラメーター&gt;の設定例は、
      <a href="#secapp">附録</a>の<a href="#secapph1">全文索引のスキーマ定義</a>を参照してください。
    </li>
  </ul>

  <dl>
    <dt class="bold">&lt;NGRパラメーター&gt;＊ ::=</dt>
    <dd>NGR [ :&lt;最小値指定&gt; [ :&lt;最大値指定&gt; ] ]</dd>
  </dl>

  <ul>
    <li>NGRは、N-gramのことをさします。</li>
    <li>&lt;最小値指定&gt;以上、&lt;最大値指定&gt;以下の文字数のすべての文字列を切り出して
      索引化します。</li>
    <li>たとえば、常に同じ文字数の検索語しか使わない場合は、&lt;最小値指定&gt;と
      &lt;最大値指定&gt;とに、その文字数を指定することをおすすめします。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;最小値指定&gt;＊ ::=</dt>
    <dd>&lt;符号なし整数&gt;</dd>
  </dl>

  <ul>
    <li>&lt;最小値指定&gt;は、最小切り出し文字数を指定します。</li>
    <li>&lt;最小値指定&gt;が省略された場合は、2が使用されます。</li>
    <li>&lt;最小値指定&gt;に設定できる値は、1以上、8以下の整数です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;最大値指定&gt;＊ ::=</dt>
    <dd>&lt;符号なし整数&gt;</dd>
  </dl>

  <ul>
    <li>&lt;最大値指定&gt;は、最大切り出し文字数を指定します。</li>
    <li>&lt;最大値指定&gt;が省略された場合は、&lt;最小値指定&gt;と同じ値が使用されます。</li>
    <li>&lt;最小値指定&gt;に設定できる値は、&lt;最小値指定&gt;以上、8以下の整数です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;BNGパラメーター&gt;＊ ::=</dt>
    <dd>
      BNG:JAP:ALL:&lt;符号なし整数&gt; [ &lt;文字種別パラメーターリスト&gt; ]</dd>
  </dl>

  <ul>
    <li>BNGは、Blocked N-gramのことをさします。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;DUALパラメーター&gt;＊ ::=</dt>
    <dd>
      DUAL:JAP:ALL:&lt;符号なし整数&gt; [&lt;文字種別パラメーターリスト&gt; ]</dd>
    <dd>|&nbsp;DUAL:JAP</dd>

    <dt class="bold">&lt;文字種別パラメーターリスト&gt;＊ ::=</dt>
    <dd>
      &lt;文字種別パラメーター&gt; [ { &lt;スペース&gt; &lt;文字種別パラメーター&gt; } ... ]</dd>

    <dt class="bold">&lt;文字種別パラメーター&gt;＊ ::=</dt>
    <dd>&lt;文字種別切り出しパラメーター&gt;</dd>
    <dd>|&nbsp;&lt;文字種間結合パラメーター&gt;</dd>

    <dt class="bold">&lt;文字種別切り出しパラメーター&gt;＊ ::=</dt>
    <dd>&lt;文字種&gt;:&lt;符号なし整数&gt;</dd>

    <dt class="bold">&lt;文字種間結合パラメーター&gt;＊ ::=</dt>
    <dd>&lt;文字種&gt;:&lt;文字種&gt;</dd>

    <dt class="bold">&lt;文字種&gt;＊ ::=</dt>
    <dd>ALP</dd>
    <dd>|&nbsp;DIG</dd>
    <dd>|&nbsp;SYM</dd>
    <dd>|&nbsp;ASC</dd>
    <dd>|&nbsp;HIR</dd>
    <dd>|&nbsp;KAT</dd>
    <dd>|&nbsp;KAN</dd>
    <dd>|&nbsp;GRK</dd>
    <dd>|&nbsp;RUS</dd>
    <dd>|&nbsp;KEI</dd>
    <dd>|&nbsp;HAN</dd>
    <dd>|&nbsp;GAI</dd>
    <dd>|&nbsp;OTH</dd>
  </dl>

  <ul>
    <li>各&lt;文字種&gt;の意味は、以下のとおりです。

      <dl>
        <dt>ALP</dt>
        <dd>全角アルファベット</dd>
        <dt>DIG</dt>
        <dd>全角数字</dd>
        <dt>SYM</dt>
        <dd>全角記号</dd>
        <dt>ASC</dt>
        <dd>アスキー</dd>
        <dt>HIR</dt>
        <dd>全角ひらがな</dd>
        <dt>KAT</dt>
        <dd>全角カタカナ</dd>
        <dt>KAN</dt>
        <dd>全角漢字</dd>
        <dt>GRK</dt>
        <dd>全角ギリシャ文字</dd>
        <dt>RUS</dt>
        <dd>全角ロシア文字</dd>
        <dt>KEI</dt>
        <dd>全角罫線素</dd>
        <dt>HAN</dt>
        <dd>半角カタカナ</dd>
        <dt>GAI</dt>
        <dd>全角外字</dd>
        <dt>OTH</dt>
        <dd>上記以外</dd>
      </dl>
    </li>
  </ul>

  <dl>
    <dt class="bold">&lt;UNAリソースリスト&gt;＊ ::=</dt>
    <dd>
      &lt;UNAリソース指定&gt; [ { &lt;スペース&gt; &lt;UNAリソース指定&gt; } ... ]</dd>

    <dt class="bold">&lt;UNAリソース指定&gt;＊ ::=</dt>
    <dd>@UNARSCID:&lt;符号なし整数&gt;</dd>
    <dd>|&nbsp;@NORMRSCID:&lt;符号なし整数&gt;</dd>
  </dl>

  <ul>
    <li>&lt;UNAリソース指定&gt;の詳細については、<a href="#secappe">異表記正規化辞書</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;圧縮器指定&gt;＊ ::=</dt>
    <dd>CODER = &lt;左括弧&gt; &lt;圧縮器パラメーターリスト&gt; &lt;右括弧&gt;</dd>

    <dt class="bold">&lt;圧縮器パラメーターリスト&gt;＊ ::=</dt>
    <dd>
      &lt;圧縮器パラメーター&gt; [ { &lt;カンマ&gt; &lt;圧縮器パラメーター&gt; } ... ]</dd>

    <dt class="bold">&lt;圧縮器パラメーター&gt;＊ ::=</dt>
    <dd>&lt;圧縮器適用種別&gt; = &lt;圧縮器&gt;</dd>

    <dt class="bold">&lt;圧縮器適用種別&gt;＊ ::=</dt>
    <dd>ID</dd>
    <dd>|&nbsp;FREQUENCY</dd>
    <dd>|&nbsp;LENGTH</dd>
    <dd>|&nbsp;LOCATION</dd>
    <dd>|&nbsp;WORDID</dd>
    <dd>|&nbsp;WORDFREQUENCY</dd>
    <dd>|&nbsp;WORDLENGTH</dd>
    <dd>|&nbsp;WORDLOCATION</dd>

    <dt class="bold">&lt;圧縮器&gt;＊ ::=</dt>
    <dd>PEG:&lt;符号なし整数&gt;</dd>
    <dd>|&nbsp;UNA</dd>

    <dt class="bold">&lt;ヒント抽出指定&gt;＊ ::=</dt>
    <dd>EXTRACTOR &lt;左括弧&gt; &lt;抽出パラメーターリスト&gt; &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>&lt;<a href="#sec60407">CONTAINS述語</a>&gt;の&lt;抽出指定&gt;とは書式が異なります。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;抽出パラメーターリスト&gt;＊ ::=</dt>
    <dd>
      &lt;抽出パラメーター&gt; [ { &lt;スペース&gt; &lt;抽出パラメーター&gt; } ... ]</dd>

    <dt class="bold">&lt;抽出パラメーター&gt;＊ ::=</dt>
    <dd>&lt;抽出リソース指定&gt;</dd>
    <dd>|&nbsp;ESTIMATEDF</dd>
  </dl>

  <ul>
    <li>ESTIMATEDFについては<a href="#sec60407">CONTAINS述語</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;抽出リソース指定&gt;＊ ::=</dt>
    <dd>@TERMRSCID:&lt;符号なし整数&gt;</dd>
  </dl>

  <ul>
    <li>@TERMRSCIDについては<a href="#sec60407">CONTAINS述語</a>を参照してください。</li>
    <li>&lt;<a href="#sec60407">CONTAINS述語</a>&gt;の&lt;抽出指定&gt;とは異なり、@UNARSCIDは指定できません。
      &lt;トークナイズ指定&gt;の&lt;UNAリソースリスト&gt;で指定してください。</li>
  </ul>

  <h4><a id="sec60506">6.5.6 データベース定義変更</a></h4>

  <p class="first">データベースの定義を変更します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;データベース定義変更&gt;＊ ::=</dt>
    <dd>
      ALTER DATABASE &lt;データベース名&gt; &lt;データベース変更指定&gt;</dd>
  </dl>

  <ul>
    <li>&lt;データベース名&gt;の詳細については、<a href="#sec60501">データベース定義</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;データベース変更指定&gt;＊ ::=</dt>
    <dd>
      &lt;データベースパス設定&gt; &lt;データベースパス削除&gt; &lt;データベース属性変更&gt;</dd>

    <dt class="bold">&lt;データベースパス設定&gt;＊ ::=</dt>
    <dd>SET &lt;パス指定&gt;</dd>

    <dt class="bold">&lt;データベースパス削除&gt;＊ ::=</dt>
    <dd>DROP &lt;パス指定&gt;</dd>

    <dt class="bold">&lt;データベース属性変更&gt;＊ ::=</dt>
    <dd>&lt;データベース属性リスト&gt;</dd>

    <dt class="bold">&lt;データベース属性リスト&gt;＊ ::=</dt>
    <dd>
      &lt;データベース属性&gt; [ { &lt;スペース&gt; &lt;データベース属性&gt; } ... ]</dd>

    <dt class="bold">&lt;データベース属性&gt;＊ ::=</dt>
    <dd>&lt;読み書き属性&gt;</dd>
    <dd>|&nbsp;&lt;オンライン属性&gt;</dd>
    <dd>|&nbsp;&lt;リカバリ属性&gt;</dd>
    <dd>|&nbsp;&lt;ユーザーモード属性&gt;</dd>

    <dt class="bold">&lt;読み書き属性&gt;＊ ::=</dt>
    <dd>READ WRITE</dd>
    <dd>|&nbsp;READ ONLY</dd>

    <dt class="bold">&lt;オンライン属性&gt;＊ ::=</dt>
    <dd>ONLINE</dd>
    <dd>|&nbsp;ONLINE WITH DISCARD LOGICALLOG</dd>
    <dd>|&nbsp;OFFLINE</dd>

    <dt class="bold">&lt;リカバリ属性&gt;＊ ::=</dt>
    <dd>RECOVERY FULL</dd>
    <dd>|&nbsp;RECOVERY CHECKPOINT</dd>

    <dt class="bold">&lt;ユーザーモード属性&gt;＊ ::=</dt>
    <dd>USER SYSTEM</dd>
    <dd>|&nbsp;USER ALL</dd>
  </dl>

  <h4><a id="sec60507">6.5.7 エリア定義変更</a></h4>

  <p class="first">エリア定義を変更します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;エリア定義変更&gt;＊ ::=</dt>
    <dd>ALTER AREA &lt;エリア名&gt; MODIFY &lt;エリア変更指定&gt;</dd>

    <dt class="bold">&lt;エリア変更指定&gt;＊ ::=</dt>
    <dd>&lt;エリアパス要素&gt;</dd>
    <dd>|&nbsp;&lt;エリアパス配列&gt;</dd>
    <dd>|&nbsp;&lt;左角括弧&gt; &lt;符号なし定数&gt; &lt;右角括弧&gt; &lt;エリアパス要素&gt;</dd>
  </dl>

  <h4><a id="sec60508">6.5.8 表定義変更</a></h4>

  <p class="first">表定義を変更します。DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;表定義変更&gt; ::=</dt>
    <dd>ALTER TABLE &lt;表名&gt; &lt;表変更指定&gt;</dd>
  </dl>

  <ul>
    <li>&lt;表名&gt;の詳細については、<a href="#sec60503">表定義</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;表変更指定&gt; ::=</dt>
    <dd>&lt;表エリア設定&gt;＊</dd>
    <dd>|&nbsp;&lt;表エリア削除&gt;＊</dd>

    <dt class="bold">&lt;表エリア設定&gt;＊ ::=</dt>
    <dd>SET &lt;表エリア句&gt;</dd>

    <dt class="bold">&lt;表エリア削除&gt;＊ ::=</dt>
    <dd>DROP &lt;表エリア句&gt;</dd>
  </dl>

  <h4><a id="sec60509">6.5.9 データベース削除</a></h4>

  <p class="first">データベースを削除します。これは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;データベース削除&gt; ::=</dt>
    <dd>DROP DATABASE &lt;データベース名&gt;</dd>
  </dl>

  <h4><a id="sec60510">6.5.10 エリア削除</a></h4>

  <p class="first">エリアを削除します。これは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;エリア削除&gt; ::=</dt>
    <dd>DROP AREA &lt;エリア名&gt;</dd>
  </dl>

  <h4><a id="sec60511">6.5.11 表削除</a></h4>

  <p class="first">表を削除します。</p>

  <dl>
    <dt class="bold">&lt;表削除&gt; ::=</dt>
    <dd>DROP TABLE &lt;表名&gt;</dd>
  </dl>

  <h4><a id="sec60512">6.5.12 データベースマウント</a></h4>

  <p class="first">データベースをマウントします。
    DoqueDBでは、ファイルシステムをマウントするように
    データベースをマウントすることが可能です。
    バックアップしたデータベースを再利用する際にも、このマウントを使用します。
    これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;データベースマウント&gt;＊ ::=</dt>
    <dd>
      MOUNT &lt;データベース名&gt; &lt;パス指定&gt;
      [ &lt;エリアオプション&gt; ] [ &lt;データベース属性指定&gt; ] [ &lt;回復指定&gt; ]</dd>
  </dl>

  <ul>
    <li>&lt;データベースマウント&gt;の&lt;データベース名&gt;は省略できません。</li>
    <li>&lt;データベースマウント&gt;の&lt;データベース名&gt;と、
      &lt;パス指定&gt;で指定されるパス名を一致させる必要はありません。</li>
    <li>&lt;データベース名&gt;の詳細については、<a href="#sec60501">データベース定義</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;エリアオプション&gt;＊ ::=</dt>
    <dd>&lt;エリア変更リスト&gt; ...</dd>
    <dd>|&nbsp;DROP ALL AREA</dd>

    <dt class="bold">&lt;エリア変更リスト&gt;＊ ::=</dt>
    <dd>&lt;エリア定義変更&gt;</dd>
    <dd>|&nbsp;&lt;エリア定義削除&gt;</dd>

    <dt class="bold">&lt;回復指定&gt;＊ ::=</dt>
    <dd>USING SNAPSHOT WITH RECOVERY</dd>
    <dd>|&nbsp;USING SNAPSHOT</dd>
    <dd>|&nbsp;WITH RECOVERY</dd>
    <dd>|&nbsp;WITH DISCARD LOGICALLOG</dd>
  </dl>

  <ul>
    <li>&lt;回復指定&gt;を指定しない場合、
      アンマウントされたデータベース、またはバックアップされたデータベースしか
      マウントできません。
      アンマウントされたデータベースをマウントすると、
      &lt;データベースアンマウント&gt;実行の直前の状態にリストアされます。
      バックアップされたデータベースをマウントすると、
      このデータベースに&lt;バックアップ開始&gt;を実行した時点の直前の状態にリストアされ、
      バックアップの開始時に実行中だったトランザクションは
      すべてロールバックされます。</li>

    <li>&lt;回復指定&gt;にUSING SNAPSHOTを指定した場合、
      バックアップされたデータベースをマウントすると、
      このデータベースに&lt;バックアップ開始&gt;を実行する直前の版の状態に
      リストアされます。
      ただし、DISCARD SNAPSHOTを指定してバックアップされたデータベースは
      マウントできません。</li>

    <li>&lt;回復指定&gt;にWITH RECOVERYを指定した場合、
      &lt;バックアップ開始&gt;を実行せずにバックアップしたデータベースをマウントできます。
      あるいは、ロールフォワードリカバリを行うことができます。</li>
  </ul>

  <h4><a id="sec60513">6.5.13 データベースアンマウント</a></h4>

  <p class="first">データベースをアンマウントします。
    DoqueDBでは、ファイルシステムをアンマウントするように
    データベースをアンマウントすることが可能です。
    アンマウントしたデータベースを、再びマウントして利用することもできます。
    また、他のDoqueDBでマウントすることも可能です。
    これは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;データベースアンマウント&gt;＊ ::=</dt>
    <dd>UNMOUNT &lt;データベース名&gt;</dd>
  </dl>

  <ul>
    <li>&lt;データベースアンマウント&gt;は、
      アンマウントするデータベースを構成するデータベースファイルが
      保存されているファイルがあるディレクトリを求めます。
      具体的には、データベースの
      &lt;データ格納パス指定&gt;, &lt;論理ログ格納パス指定&gt;, &lt;システム表格納パス指定&gt;と
      使用しているエリアの&lt;エリアパス要素&gt;を集めて、
      重複するものを除いたものを求めます。
      求めたディレクトリは以下の仮想列を持つタプルの形式で返されます。

      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>型</th>
            <th>意味</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>(現在のバージョンでは列名は割り当てられていません)</td>
            <td>文字列</td>
            <td>データベースファイルが保存されているファイルの在るディレクトリ、またはそのファイルの在るディレクトリを下位のディレクトリとして有するディレクトリの絶対パス名。
            </td>
          </tr>
        </tbody>
      </table>
    </li>

  </ul>

  <h3><a id="sec606">6.6 索引定義</a></h3>

  <p class="first">DoqueDBでサポートしている索引は、
    B+木索引、全文索引、ビットマップ索引、配列索引です。</p>

  <p>各索引定義の&lt;索引名&gt;の共通する制限は以下のとおりです。</p>

  <ul>
    <li>各索引定義で使われる&lt;索引名&gt;には、同じ表内の
      既存の&lt;索引名&gt;と同じ名前の&lt;索引名&gt;を使えません。</li>
  </ul>

  <p>&lt;索引名&gt;のその他の制限は、&lt;データベース名&gt;等と同様です。
    詳細については、<a href="#sec605">スキーマ定義</a>を参照してください。</p>

  <h4><a id="sec60601">6.6.1 B+木索引定義</a></h4>

  <p class="first">B+木索引を定義します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;B+木索引定義&gt;＊ ::=</dt>
    <dd>
      CREATE [ALL ROWS] INDEX &lt;索引名&gt; ON &lt;表名&gt; &lt;索引要素リスト&gt;
      [ &lt;ヒント句&gt; ] [ &lt;索引エリア句&gt; ]</dd>
  </dl>

  <ul>
    <li>B+木索引は、列に対する等式または不等式を条件とする検索を速くする、
      データベースシステムで一般的に使われている索引です。</li>
    <li>B+木索引は、列の値にNULLを含むカラムも索引に挿入されますが、
      &lt;索引要素リスト&gt;の先頭の列の値がNULLの場合、そのカラムは挿入されません。</li>
    <li>B+木索引は、ALL ROWSが指定されるとすべてのカラムが挿入されます。</li>
    <li>&lt;B+木索引定義&gt;の&lt;ヒント句&gt;にNORMALIZEDを指定すると、
      文字列型または国際文字列型のデータは正規化されて索引に挿入されます。</li>
    <li>B+木索引の正規化は、
      <a href="#sec30305">検索用パラメーター</a>のExecution_LikeNormalizedStringが指定する方法で
      実行されます。
    </li>
    <li>B+木索引の正規化方法は、索引定義時の設定が使われ続けます。
      正規化方法を変更したい場合は、索引を再作成する必要があります。</li>
    <li>B+木索引の正規化方法の詳細については、<a href="#sec30305">検索用パラメーター</a>を参照してください。</li>
    <li>B+木索引を定義すると、B+木ファイルが作成されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引要素リスト&gt;＊ ::=</dt>
    <dd>
      &lt;左括弧&gt; &lt;索引要素&gt; [ { &lt;カンマ&gt; &lt;索引要素&gt; } ... ] &lt;右括弧&gt;</dd>
  </dl>

  <ul>
    <li>どの&lt;索引要素&gt;に対しても、
      値が一意である指定(PRIMARY KEY 指定など)がされていない場合は、
      &lt;索引要素リスト&gt;に組込み列であるROWID列が追加されます。</li>
    <li>&lt;索引要素リスト&gt;の最大要素数は、7です。
      (上記の追加列がある場合は、それも要素数に含めます。)</li>
    <li>&lt;索引要素リスト&gt;の合計サイズには、制限があります。
      詳細については、<a href="#secapp">附録</a>の<a href="#secappg1">カラムサイズ</a>を参照してください。
      (上記の追加列がある場合は、それも合計サイズに含めます。)</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引要素&gt;＊ ::=</dt>
    <dd>&lt;列名&gt;</dd>
  </dl>

  <ul>
    <li>B+木索引は、以下のデータ型の列に定義できます。

      <ul>
        <li>CHAR</li>
        <li>NCHAR</li>
        <li>VARCHAR</li>
        <li>NVARCHAR</li>
        <li>UNIQUEIDENTIFIER</li>
        <li>INT</li>
        <li>BIGINT</li>
        <li>FLOAT</li>
        <li>DECIMAL</li>
        <li>DATETIME</li>
        <li>LANGUAGE</li>
      </ul>
    </li>
    <li>配列指定されている列への索引(配列索引)は定義できません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引エリア句&gt;＊ ::=</dt>
    <dd>AREA &lt;索引エリア指定&gt;</dd>

    <dt class="bold">&lt;索引エリア指定&gt;＊ ::=</dt>
    <dd>&lt;エリア名 |&nbsp;DEFAULT&gt; [ &lt;索引エリアヒント&gt; ]</dd>

    <dt class="bold">&lt;索引エリアヒント&gt;＊ ::=</dt>
    <dd>HINT AREA &lt;文字列定数&gt;</dd>
  </dl>

  <ul>
    <li>現在のバージョンでは、&lt;索引エリアヒント&gt;の指定は無視されます。</li>
  </ul>

  <h4><a id="sec60602">6.6.2 全文索引定義</a></h4>

  <p class="first">全文索引を定義します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;全文索引定義&gt;＊ ::=</dt>
    <dd>
      CREATE FULLTEXT INDEX &lt;索引名&gt; ON &lt;表名&gt; &lt;索引要素リスト&gt;
      [ &lt;言語列指定&gt; ] [ &lt;スコア調整列指定&gt; ] [ &lt;ヒント句&gt; ] [ &lt;索引エリア句&gt; ]</dd>
  </dl>

  <ul>
    <li>全文索引は、テキストデータを文字列で高速に検索するための索引です。</li>
    <li>全文索引は、以下のデータ型の列に定義できます。

      <ul>
        <li>CHAR</li>
        <li>NCHAR</li>
        <li>VARCHAR</li>
        <li>NVARCHAR</li>
        <li>NTEXT</li>
        <li>FULLTEXT</li>
        <li>UNIQUEIDENTIFIER</li>
      </ul>
    </li>
    <li>全文索引を定義すると、転置ファイルが作成されます。</li>
    <li>&lt;全文索引定義&gt;の例は<a href="#secapp">附録</a>の<a href="#secapph1">全文索引のスキーマ定義</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;言語列指定&gt;＊ ::=</dt>
    <dd>LANGUAGE COLUMN &lt;列名&gt;</dd>
  </dl>

  <ul>
    <li>&lt;言語列指定&gt;で指定する&lt;列名&gt;の列は、&lt;表名&gt;の表に属するもので、
      そのデータ型はLANGUAGE型でなければなりません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;スコア調整列指定&gt;＊ ::=</dt>
    <dd>SCORE COLUMN &lt;列名&gt;</dd>
  </dl>

  <ul>
    <li>&lt;スコア調整列指定&gt;で指定する&lt;列名&gt;の列は、&lt;表名&gt;の表に属するもので、
      そのデータ型はFLOAT型でなければなりません。</li>

    <li>使い方は<a href="#secapp">附録</a>の<a href="#secapph4">全文索引のランキング検索</a>を参照してください。</li>
  </ul>

  <h4><a id="sec60603">6.6.3 ビットマップ索引定義</a></h4>

  <p class="first">ビットマップ索引を定義します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;ビットマップ索引定義&gt;＊ ::=</dt>
    <dd>
      CREATE BITMAP INDEX &lt;索引名&gt; ON &lt;表名&gt; &lt;索引要素&gt;
      [ &lt;ヒント句&gt; ] [ &lt;索引エリア句&gt; ]</dd>
  </dl>

  <ul>
    <li>ビットマップ索引は、
      <a href="#secappj1">異なりデータ数</a>の少ない列に対する等式または不等式を条件とする検索を速くする、
      データベースシステムで一般的に使われている索引です。
    </li>
    <li>&lt;ビットマップ索引定義&gt;の&lt;<a href="#sec60505">ヒント句</a>&gt;にCOMPRESSEDを指定すると、
      データは圧縮されて索引に挿入されます。
      データの異なり数が多いとき(100以上)の処理が高速になります。</li>
  </ul>

  <ul>
    <li>ビットマップ索引を定義すると、ビットマップファイルが作成されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引要素&gt;＊ ::=</dt>
    <dd>&lt;列名&gt;</dd>
  </dl>

  <ul>
    <li>ビットマップ索引は、以下のデータ型の列に定義できます。

      <ul>
        <li>CHAR</li>
        <li>NCHAR</li>
        <li>VARCHAR</li>
        <li>NVARCHAR</li>
        <li>INT</li>
        <li>BIGINT</li>
        <li>FLOAT</li>
        <li>DATETIME</li>
        <li>LANGUAGE</li>
      </ul>
    </li>
    <li>配列指定されている列への索引(配列索引)も定義できます。
      ただし、配列任意要素指定の検索のみ利用できます。</li>
    <li>複合索引は定義できません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引エリア句&gt;＊ ::=</dt>
    <dd>AREA &lt;索引エリア指定&gt;</dd>

    <dt class="bold">&lt;索引エリア指定&gt;＊ ::=</dt>
    <dd>&lt;エリア名 |&nbsp;DEFAULT&gt; [ &lt;索引エリアヒント&gt; ]</dd>

    <dt class="bold">&lt;索引エリアヒント&gt;＊ ::=</dt>
    <dd>HINT AREA &lt;文字列定数&gt;</dd>
  </dl>

  <ul>
    <li>現在のバージョンでは、&lt;索引エリアヒント&gt;の指定は無視されます。</li>
  </ul>

  <h4><a id="sec60604">6.6.4 配列索引定義</a></h4>

  <p class="first">配列索引を定義します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;配列索引定義&gt;＊ ::=</dt>
    <dd>
      CREATE ARRAY INDEX &lt;索引名&gt; ON &lt;表名&gt; &lt;索引要素&gt; [ &lt;索引エリア句&gt; ]</dd>
  </dl>

  <ul>
    <li>配列索引は、
      異なり数の多い列に対する等式または不等式を条件とする検索を速くする、
      データベースシステムで一般的に使われている索引です。</li>
  </ul>

  <ul>
    <li>配列索引を定義すると、配列ファイルが作成されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引要素&gt;＊ ::=</dt>
    <dd>&lt;列名&gt;</dd>
  </dl>

  <ul>
    <li>配列索引は、以下のデータ型の列に定義できます。

      <ul>
        <li>CHAR</li>
        <li>NCHAR</li>
        <li>VARCHAR</li>
        <li>NVARCHAR</li>
        <li>INT</li>
        <li>BIGINT</li>
        <li>FLOAT</li>
        <li>DATETIME</li>
        <li>LANGUAGE</li>
      </ul>
    </li>
    <li>配列指定されている列への索引のみ定義できます。
      また、配列任意要素指定の検索のみ利用できます。</li>
    <li>複合索引は定義できません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引エリア句&gt;＊ ::=</dt>
    <dd>AREA &lt;索引エリア指定&gt;</dd>

    <dt class="bold">&lt;索引エリア指定&gt;＊ ::=</dt>
    <dd>&lt;エリア名 |&nbsp;DEFAULT&gt; [ &lt;索引エリアヒント&gt; ]</dd>

    <dt class="bold">&lt;索引エリアヒント&gt;＊ ::=</dt>
    <dd>HINT AREA &lt;文字列定数&gt;</dd>
  </dl>

  <ul>
    <li>現在のバージョンでは、&lt;索引エリアヒント&gt;の指定は無視されます。</li>
  </ul>

  <h4><a id="sec60605">6.6.5 索引定義変更</a></h4>

  <p class="first">索引定義を変更します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;索引定義変更&gt;＊ ::=</dt>
    <dd>ALTER INDEX &lt;索引名&gt; &lt;索引変更指定&gt;</dd>
  </dl>

  <ul>
    <li>&lt;索引名&gt;の詳細については、<a href="#sec606">索引定義</a>を参照してください。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;索引変更指定&gt;＊ ::=</dt>
    <dd>&lt;索引エリア設定&gt;</dd>
    <dd>|&nbsp;&lt;索引エリア削除&gt;</dd>

    <dt class="bold">&lt;索引エリア設定&gt;＊ ::=</dt>
    <dd>SET &lt;索引エリア句&gt;</dd>

    <dt class="bold">&lt;索引エリア削除&gt;＊ ::=</dt>
    <dd>DROP &lt;索引エリア句&gt;</dd>
  </dl>

  <h4><a id="sec60606">6.6.6 索引削除</a></h4>

  <p class="first">索引を削除します。これは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;索引削除&gt; ::=</dt>
    <dd>DROP INDEX &lt;索引名&gt;</dd>
  </dl>

  <h3><a id="sec607">6.7 権限管理</a></h3>

  <p class="first">ユーザーのロールを管理します。</p>

  <h4><a id="sec60701">6.7.1 GRANT文</a></h4>

  <p class="first">ユーザーにロールを追加します。</p>

  <dl>
    <dt class="bold">&lt;GRANT文&gt; ::=</dt>
    <dd>
      GRANT &lt;ロール名&gt; [ { &lt;カンマ&gt; &lt;ロール名&gt; } ... ] TO &lt;ユーザー名&gt;</dd>
  </dl>

  <ul>
    <li>&lt;ロール名&gt;はシステムに組み込まれたもののみ使用できます。</li>
    <li>制限等の詳細については、<a href="#sec30503">ユーザー権限管理</a>を参照してください。</li>
  </ul>

  <h4><a id="sec60702">6.7.2 REVOKE文</a></h4>

  <p class="first">ユーザーからロールを削除します。</p>

  <dl>
    <dt class="bold">&lt;REVOKE文&gt; ::=</dt>
    <dd>
      REVOKE &lt;ロール名&gt; [ { &lt;カンマ&gt; &lt;ロール名&gt; } ... ] FROM &lt;ユーザー名&gt;</dd>
  </dl>

  <ul>
    <li>&lt;ロール名&gt;はシステムに組み込まれたもののみ使用できます。</li>
    <li>制限等の詳細については、<a href="#sec30503">ユーザー権限管理</a>を参照してください。</li>
  </ul>

  <h3><a id="sec608">6.8 セッション管理</a></h3>

  <h4><a id="sec60801">6.8.1 DISCONNECT文</a></h4>

  <p class="first">有効なセッションを切断します。</p>

  <dl>
    <dt class="bold">&lt;DISCONNECT文&gt; ::=</dt>
    <dd>
      DISCONNECT [ SESSION &lt;SessionID&gt; OF ] CONNCECTION &lt;ClientID&gt;</dd>
  </dl>

  <ul>
    <li>&lt;SessionID&gt;、&lt;ClientID&gt;はSYSTEM_SESSION表で取得できる値のみ使用できます。</li>
    <li>&lt;SessionID&gt;を指定しない場合、ClientIDで指定したClientが持つすべてのセッションを切断します。</li>
    <li>制限等の詳細については、<a href="#sec30503">ユーザー権限管理</a>を参照してください。</li>
  </ul>

  <h4><a id="sec60802">6.8.2 シングルユーザーモード</a></h4>

  <p class="first">シングルユーザーモードはスーパーユーザーのみがトランザクションを実行可能なモードです。
    データベース属性を変更することで、シングルユーザーモードに移行します。
    シングルユーザーモードに移行した場合、該当するデータベースで実行中の他のすべてのトランザクション(スーパーユーザーが実行中のトランザクション)はキャンセルされ、例外(CanceledBySuperUser)が発生します。</p>

  <ul>
    <li>シングルユーザーモードに移行する</li>
  </ul>

  <pre class="example">
alter database &lt;データベース名&gt; user system
</pre>

  <ul>
    <li>シングルユーザモードを終了する</li>
  </ul>

  <pre class="example">
alter database &lt;データベース名&gt; user all
</pre>

  <h3><a id="sec609">6.9 トランザクション</a></h3>

  <p class="first">DoqueDBがサポートするSQLトランザクション管理について説明します。</p>

  <h4><a id="sec60901">6.9.1 SET TRANSACTION文</a></h4>

  <p class="first">SQLトランザクションの属性を設定します。
    DoqueDBで拡張された要素には、＊がついています。</p>

  <dl>
    <dt class="bold">&lt;SET TRANSACTION 文&gt; ::=</dt>
    <dd>
      SET TRANSACTION &lt;トランザクションモード&gt;
      [ { &lt;カンマ&gt; &lt;トランザクションモード&gt; } ... ]</dd>
  </dl>

  <ul>
    <li>&lt;SET TRANSACTION文&gt;は、指定された&lt;トランザクションモード&gt;を設定します。</li>
    <li>&lt;SET TRANSACTION文&gt;で指定されなかった&lt;トランザクションモード&gt;は、
      以前の設定がそのまま有効です。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;トランザクションモード&gt; ::=</dt>
    <dd>&lt;トランザクションアクセスモード&gt;</dd>
    <dd>|&nbsp;&lt;隔離性水準指定&gt;</dd>
    <dd>|&nbsp;&lt;スナップショット指定&gt;＊</dd>

    <dt class="bold">&lt;トランザクションアクセスモード&gt; ::=</dt>
    <dd>READ ONLY</dd>
    <dd>|&nbsp;READ WRITE</dd>

    <dt class="bold">&lt;隔離性水準指定&gt; ::=</dt>
    <dd>ISOLATION LEVEL &lt;隔離性水準&gt;</dd>

    <dt class="bold">&lt;隔離性水準&gt; ::=</dt>
    <dd>READ UNCOMMITTED</dd>
    <dd>|&nbsp;READ COMMITTED</dd>
    <dd>|&nbsp;REPEATABLE READ</dd>
    <dd>|&nbsp;SERIALIZABLE</dd>

    <dt class="bold">&lt;スナップショット指定&gt;＊ ::=</dt>
    <dd>USING SNAPSHOT</dd>
  </dl>

  <h4><a id="sec60902">6.9.2 START TRANSACTION文</a></h4>

  <p class="first">SQLトランザクションの開始を宣言します。</p>

  <dl>
    <dt class="bold">&lt;START TRANSACTION 文&gt; ::=</dt>
    <dd>START TRANSACTION &lt;トランザクションモード&gt; [ { &lt;カンマ&gt; &lt;トランザクションモード&gt; } ... ]</dd>
  </dl>

  <ul>
    <li>&lt;START TRANSACTION文&gt;は、
      指定された&lt;トランザクションモード&gt;でSQLトランザクションを開始します。</li>
    <li>&lt;START TRANSACTION文&gt;に指定されなかった&lt;トランザクションモード&gt;には、
      以前の&lt;SET TRANSACTION文&gt;で指定された&lt;トランザクションモード&gt;が採用されます。</li>
    <li>&lt;START TRANSACTION文&gt;に指定されなかった&lt;トランザクションモード&gt;で、
      以前の&lt;SET TRANSACTION文&gt;でも指定されていない&lt;トランザクションモード&gt;には、
      以下のデフォルト値が採用されます。

      <table>
        <thead>
          <tr>
            <th>トランザクションモード種別</th>
            <th>デフォルト値</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>&lt;トランザクションアクセスモード&gt;</td>
            <td>READ WRITE</td>
          </tr>
          <tr>
            <td>&lt;隔離性水準&gt;</td>
            <td>READ COMMITTED</td>
          </tr>
          <tr>
            <td>&lt;スナップショット指定&gt;</td>
            <td>指定なし
            </td>
          </tr>
        </tbody>
      </table>
    </li>

    <li>&lt;START TRANASCTION文&gt;によりトランザクションを開始せずに、
      問合せなどのデータ操作を行うSQL文を実行することもできます。
      その場合、以前、&lt;SET TRANSACTION文&gt;で指定された&lt;トランザクションモード&gt;が
      採用されます。
      以前、&lt;SET TRANSACTION文&gt;により指定されていない&lt;トランザクションモード&gt;は、
      実行するSQL文の種類により、以下のデフォルト値が採用されます。

      <table>
        <thead>
          <tr>
            <th rowspan=2>SQL文</th>
            <th colspan=3>トランザクションモード種別</th>
            <!-- <th></th> -->
            <!-- <th></th> -->
          </tr>
          <tr>
            <!-- <td></td> -->
            <td>&lt;トランザクションアクセスモード&gt;</td>
            <td>&lt;隔離性水準&gt;</td>
            <td>&lt;スナップショット指定&gt;</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>SELECT / START BACKUP / END BACKUP / VERIFY</td>
            <td>READ ONLY</td>
            <td>READ COMMITTED</td>
            <td>指定なし</td>
          </tr>
          <tr>
            <td>INSERT / UPDATE / DELETE</td>
            <td>READ WRITE</td>
            <td>READ COMMITTED</td>
            <td>指定なし</td>
          </tr>
          <tr>
            <td>スキーマ定義 / 操作</td>
            <td>READ WRITE</td>
            <td>SERIALIZABLE</td>
            <td>指定なし</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ul>

  <ul>
    <li>スキーマ定義/操作は、
      &lt;START TRANSACTION文&gt;により開始されたトランザクション中に実行できません。</li>

    <li>現状、READ UNCOMMITTEDのトランザクションは必ず、
      READ COMMITTEDのトランザクションとなります。</li>

    <li>USING SNAPSHOTかつREAD ONLYのトランザクションは、
      必ずSERIALIZABLEのトランザクションになります。
      このトランザクションは、
      その開始以前のある時点でのSERIALIZABLEな版を参照することになります。
      必ず、最新のものが参照できるわけではありませんが、
      他のトランザクションの影響をまったく受けずに自身を実行することができます。
      たとえば、READ WRITEトランザクションの実行が終了するまで、
      自身の実行が停止するというようなことはありません。
      運用中に整合性検査を行いたいときのような場合に用いるとよいでしょう。</li>

    <li>USING SNAPSHOTでないREAD ONLYトランザクションは、
      その開始時にREAD WRITEトランザクションが実行中でなければ、
      USING SNAPSHOTかつREAD ONLYのトランザクションと同様に動作します。</li>
  </ul>

  <h4><a id="sec60903">6.9.3 COMMIT文</a></h4>

  <p class="first">SQLトランザクションを確定します。</p>

  <dl>
    <dt class="bold">&lt;COMMIT 文&gt; ::=</dt>
    <dd>COMMIT [ WORK ]</dd>
  </dl>

  <h4><a id="sec60904">6.9.4 ROLLBACK文</a></h4>

  <p class="first">SQLトランザクションを破棄し、
    SQLトランザクションを開始する直前の状態にデータベースをロールバックします。</p>

  <dl>
    <dt class="bold">&lt;ROLLBACK 文&gt; ::=</dt>
    <dd>ROLLBACK [ WORK ]</dd>
  </dl>

  <h3><a id="sec610">6.10 データ操作</a></h3>

  <p class="first">DoqueDBがサポートするデータ操作について説明します。</p>

  <h4><a id="sec61001">6.10.1 バックアップ開始</a></h4>

  <p class="first">データベースをオンラインバックアップする場合、
    対象のデータベースに対してバックアップ開始を宣言します。
    データベースのバックアップはDoqueDBを介さず、サードパーティーのツール等で、
    データベースファイルが保存されているファイルを直接コピーして行います。
    バックアップが終了したら、&lt;<a href="#sec61002">バックアップ終了</a>&gt;を実行してください。
    これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;バックアップ開始&gt;＊ ::=</dt>
    <dd>START BACKUP [ &lt;バックアップ方式&gt; ] [ &lt;版指定&gt; ]</dd>
  </dl>

  <ul>
    <li>&lt;バックアップ開始&gt;は、バックアップするデータベースを構成する
      データベースファイルが保存されているファイルの在るディレクトリを求めます。
      具体的には、データベースの
      &lt;データ格納パス指定&gt;, &lt;論理ログ格納パス指定&gt;, &lt;システム表格納パス指定&gt;と
      使用しているエリアの&lt;エリアパス要素&gt;を集めて、
      重複するものを除いたものを求めます。
      求めたディレクトリは以下の仮想列を持つタプルの形式で返されます。

      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>型</th>
            <th>意味</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>(現在のバージョンでは列名は割り当てられていません)</td>
            <td>文字列</td>
            <td>データベースファイルが保存されているファイルの在るディレクトリ、またはそのファイルの在るディレクトリを下位のディレクトリとして有するディレクトリの絶対パス名。
            </td>
          </tr>
        </tbody>
      </table>
    </li>

    <li>&lt;バックアップ開始&gt;と&lt;バックアップ終了&gt;は、
      同じトランザクションで実行しなくてはなりません。</li>

    <li>&lt;バックアップ方式&gt;を省略した場合、&lt;バックアップ方式&gt;はFULLになります。</li>

    <li>&lt;版指定&gt;を指定しない&lt;バックアップ開始&gt;は、
      読み取り専用かつSERIALIZABLEなトランザクション中でしか実行できません。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;バックアップ方式&gt;＊ ::=</dt>
    <dd>FULL</dd>

    <dt class="bold">&lt;版指定&gt;＊ ::=</dt>
    <dd>DISCARD SNAPSHOT</dd>
  </dl>

  <ul>
    <li>&lt;版指定&gt;にDISCARD SNAPSHOTを指定してバックアップしたデータベースに対し、
      &lt;回復指定&gt;にUSING SNAPSHOTを指定した&lt;データベースマウント&gt;は実行できません。</li>
  </ul>

  <h4><a id="sec61002">6.10.2 バックアップ終了</a></h4>

  <p class="first">バックアップ終了を宣言します。これは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;バックアップ終了&gt;＊ ::=</dt>
    <dd>END BACKUP [ WITH DISCARD LOGICALLOG ]</dd>
  </dl>

  <ul>
    <li>&lt;バックアップ開始&gt;と&lt;バックアップ終了&gt;は、
      同じトランザクションで実行しなくてはなりません。</li>
  </ul>

  <h4><a id="sec61003">6.10.3 整合性検査</a></h4>

  <p class="first">データベースの整合性を検査します。これらは、DoqueDBで拡張された式です。</p>

  <dl>
    <dt class="bold">&lt;整合性検査&gt;＊ ::=</dt>
    <dd>VERIFY &lt;検査対象&gt; &lt;識別子&gt; [&lt;整合性検査方法&gt; ...]</dd>

    <dt class="bold">&lt;検査対象&gt;＊ ::=</dt>
    <dd>DATABASE</dd>
    <dd>|&nbsp;TABLE</dd>
    <dd>|&nbsp;INDEX</dd>
  </dl>

  <ul>
    <li>&lt;検査対象&gt;として、DATABASEを指定すると
      &lt;識別子&gt;の表すデータベースが有するすべての表と索引について、
      TABLEを指定すると&lt;識別子&gt;の表す表について、
      INDEXを指定すると&lt;識別子&gt;の表す索引について、
      それぞれ整合性を検査します。
      表や索引の整合性検査では、
      それぞれを構成するデータベースファイル間のデータの整合性を検査します。</li>

    <li>&lt;整合性検査&gt;は検査対象の矛盾を求めます。求めた矛盾は以下の仮想列を持つタプルの形式で返されます。

      <table>
        <thead>
          <tr>
            <th>列名</th>
            <th>型</th>
            <th>意味</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>module</td>
            <td>文字列</td>
            <td>矛盾を発見したコードが実装されたDoqueDBのモジュールの名前。ただし、statusが0のときはNULL。</td>
          </tr>
          <tr>
            <td>file</td>
            <td>文字列</td>
            <td>矛盾を発見したコードが実装されたDoqueDBのソースファイルの名前。ただし、statusが0のときはNULL。</td>
          </tr>
          <tr>
            <td>line</td>
            <td>符号無整数</td>
            <td>矛盾を発見したコードが実装されたDoqueDBのソースファイル上の行番号。ただし、statusが0のときはNULL。</td>
          </tr>
          <tr>
            <td>name</td>
            <td>文字列</td>
            <td>矛盾を発見した検査対象であるデータベース・表・索引のいずれかの名前。</td>
          </tr>
          <tr>
            <td>path</td>
            <td>文字列</td>
            <td>データベースファイルに矛盾が見つかった場合、そのデータベースファイルが保存されているファイルの在るディレクトリ、またはそのファイルのあるディレクトリを下位のディレクトリとして有するディレクトリの絶対パス名。
            </td>
          </tr>
          <tr>
            <td>status</td>
            <td>符号付整数</td>
            <td>このタプルが表す矛盾の種類を表す値で、次のいずれかです。<dl>
                <dt>0</dt>
                <dd>矛盾がなかった。</dd>
                <dt>1</dt>
                <dd>矛盾があったが、CORRECTの指定により訂正できた。</dd>
                <dt>2</dt>
                <dd>CORRECTを指定すれば訂正可能な矛盾である。</dd>
                <dt>3</dt>
                <dd>CORRECTを指定しても訂正不可能な矛盾である。</dd>
                <dt>4</dt>
                <dd>指示を受け、検査を中止した。</dd>
                <dt>5</dt>
                <dd>検査中にエラーが発生した。</dd>
              </dl>
            </td>
          </tr>
          <tr>
            <td>message</td>
            <td>文字列</td>
            <td>矛盾の内容を表すメッセージ。
            </td>
          </tr>
        </tbody>
      </table>
    </li>

  </ul>

  <dl>
    <dt class="bold">&lt;整合性検査方法&gt;＊ ::=</dt>
    <dd>CORRECT</dd>
    <dd>|&nbsp;CONTINUE</dd>
    <dd>|&nbsp;CASCADE</dd>
    <dd>|&nbsp;VALUE</dd>
    <dd>|&nbsp;VERBOSE</dd>
  </dl>

  <ul>
    <li>&lt;整合性検査方法&gt;にCORRECTを指定すると、
      可能であれば、発見した矛盾の訂正を試みます。
      CORRECTを指定しなかったときは、訂正を試みません。
      次の場合は、CORRECTを指定することはできません。

      <ul>
        <li>読み取り専用トランザクションで整合性検査を行った場合</li>
        <li>検査対象が 読み取り専用データベース中のものである場合</li>
      </ul>
    </li>

    <li>&lt;整合性検査方法&gt;にCONTINUEを指定すると、
      発見した矛盾を訂正しなかった、または訂正を試みたができなかった場合でも、
      可能であれば、検査を継続します。
      CONTINUEを指定しなかったときは、検査を終了します。</li>

    <li>&lt;整合性検査方法&gt;にCASCADEを指定すると、
      検査対象を構成するすべてのデータベースファイルも検査します。</li>

    <li>&lt;整合性検査方法&gt;にVALUEを指定すると、
      表を構成するレコードファイルと索引を構成する各ファイルのデータを突き合わせる検査も行います。</li>

    <li>&lt;整合性検査方法&gt;にVERBOSEを指定すると、
      データベース、表、索引のそれぞれを検査する直前と直後にメッセージを返します。
      VALUEをあわせて指定した場合、各ファイルについて10000件のデータの突き合わせが行われるごとにメッセージを返します。
      パラメーター Schema_VerifyLogStep により、10000というしきい値を変更することができます。</li>
  </ul>

  <h4><a id="sec61004">6.10.4 INSERT文</a></h4>

  <p class="first">表中に新しい行を作成します。</p>

  <dl>
    <dt class="bold">&lt;INSERT文&gt; ::=</dt>
    <dd>INSERT INTO &lt;表名&gt; &lt;挿入列および挿入元&gt;</dd>

    <dt class="bold">&lt;挿入列および挿入元&gt; ::=</dt>
    <dd>[ &lt;左括弧&gt; &lt;挿入列リスト&gt; &lt;右括弧&gt; ] &lt;問合せ式&gt;</dd>
    <dd>|&nbsp;[ &lt;左括弧&gt; &lt;挿入列リスト&gt; &lt;右括弧&gt; ] &lt;表値構成子&gt;</dd>
    <dd>|&nbsp;DEFAULT VALUES</dd>
    <dd>|&nbsp;[ &lt;左括弧&gt; &lt;挿入列リスト&gt; &lt;右括弧&gt; ] &lt;一括登録指定&gt;</dd>
  </dl>

  <ul>
    <li>&lt;一括登録指定&gt;を用いたINSERT文は <a href="#sec61007">一括登録</a> で説明します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;挿入列リスト&gt; ::=</dt>
    <dd>&lt;列名リスト&gt;</dd>
  </dl>

  <ul>
    <li>&lt;配列指定&gt;のある列にNULL以外の値を設定する場合は、
      &lt;配列値式&gt;を使用する必要があります。</li>
  </ul>

  <h4><a id="sec61005">6.10.5 UPDATE文</a></h4>

  <p class="first">表の複数の行を更新します。</p>

  <dl>
    <dt class="bold">&lt;UPDATE文&gt; ::=</dt>
    <dd>UPDATE &lt;表名&gt; SET &lt;設定句リスト&gt; [ WHERE &lt;探索条件&gt; ]</dd>

    <dt class="bold">&lt;設定句リスト&gt; ::=</dt>
    <dd>&lt;設定句&gt; [ { &lt;カンマ&gt; &lt;設定句&gt; } ... ]</dd>

    <dt class="bold">&lt;設定句&gt; ::=</dt>
    <dd>&lt;対象列&gt; &lt;等号演算子&gt; &lt;更新元&gt;</dd>

    <dt class="bold">&lt;更新元&gt; ::=</dt>
    <dd>&lt;値式&gt;</dd>
    <dd>|&nbsp;&lt;NULL指定&gt;</dd>

    <dt class="bold">&lt;対象列&gt; ::=</dt>
    <dd>&lt;列名&gt;</dd>
  </dl>

  <ul>
    <li>&lt;配列指定&gt;のある列にNULL以外の値を設定する場合は、
      &lt;配列値式&gt;を使用する必要があります。</li>
  </ul>

  <h4><a id="sec61006">6.10.6 DELETE文</a></h4>

  <p class="first">表から複数の行を削除します。</p>

  <dl>
    <dt class="bold">&lt;DELETE文&gt; ::=</dt>
    <dd>DELETE FROM &lt;表名&gt; [ WHERE &lt;探索条件&gt; ]</dd>
  </dl>

  <h4><a id="sec61007">6.10.7 一括登録</a></h4>

  <p class="first">表に一括してデータを登録します。
    INSERT文の挿入元に&lt;一括登録指定&gt;を用いると、特定のフォーマットで記述されたCSVファイルやテキストファイルを解析して一括登録を行います。</p>

  <dl>
    <dt class="bold">&lt;一括登録指定&gt; ::=</dt>
    <dd>INPUT FROM &lt;データファイルパス指定&gt;</dd>
    <dd>|&nbsp;[ &lt;スペックファイルパス指定&gt; ]</dd>
    <dd>|&nbsp;[ &lt;一括登録ヒント句&gt; ]</dd>

    <dt class="bold">&lt;データファイルパス指定&gt; ::=</dt>
    <dd>PATH &lt;文字列定数&gt;</dd>
  </dl>

  <ul>
    <li>&lt;データファイルパス指定&gt;には、
      入力データが格納されているファイルのパス名を指定します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;スペックファイルパス指定&gt; ::=</dt>
    <dd>WITH PATH &lt;文字列定数&gt;</dd>
  </dl>

  <ul>
    <li>&lt;スペックファイルパス指定&gt;には、
      下記の&lt;データ区切り文字列指定&gt;を改行で区切って記述したファイルのパス名を指定します。</li>
    <li>&lt;スペックファイルパス指定&gt;で指定されたファイルと&lt;一括登録ヒント句&gt;で同じ要素の指定があった場合、
      &lt;一括登録ヒント句&gt;の指定が優先します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;一括登録ヒント句&gt; ::=</dt>
    <dd>&lt;引用符&gt; { &lt;一括登録ヒント要素&gt; … } &lt;引用符&gt;</dd>
    <dt class="bold">&lt;一括登録ヒント要素&gt; ::=</dt>
    <dd>&lt;データ区切り文字列指定&gt;</dd>
    <dd>|&nbsp;&lt;日時型区切り文字指定&gt;</dd>
    <dd>|&nbsp;&lt;文字コード指定&gt;</dd>
    <dd>|&nbsp;&lt;範囲指定&gt;</dd>
    <dd>|&nbsp;&lt;エラーファイル指定&gt;</dd>
    <dd>|&nbsp;&lt;特殊文字無視指定&gt;</dd>
    <dt class="bold">&lt;データ区切り文字列指定&gt; ::=</dt>
    <dd>FieldSeparator &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
    <dd>|&nbsp;RecordSeparator &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
    <dd>|&nbsp;ElementSeparator &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
    <dt class="bold">&lt;一括登録ヒント内文字列&gt; ::=</dt>
    <dd>&lt;二重引用符&gt; [ &lt;非引用文字&gt; … ] &lt;二重引用符&gt;</dd>
  </dl>

  <ul>
    <li>FieldSeparatorには、1レコード中の列データを区切る文字列を指定します。
      指定がない場合は&quot;,&quot;が使用されます。</li>
    <li>RecordSeparatorには、レコードを区切る文字列を指定します。
      指定がない場合は&quot;\n&quot;が使用されます。</li>
    <li>ElementSeparatorには、配列型の列データで配列要素を区切る文字列を指定します。
      指定がない場合は&quot;;&quot;が使用されます。</li>
    <li>改行を区切り文字列に使用する場合は「\n」、
      タブを使用する場合は「\t」と記述します。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;日時型区切り文字指定&gt; ::=</dt>
    <dd>DateDelimiter &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
    <dd>|&nbsp;DateTrailer &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
    <dd>|&nbsp;TimeDelimiter &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
    <dd>|&nbsp;MsecDelimiter &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
  </dl>

  <ul>
    <li>日時型区切り文字指定は、データファイル中の日付、
      または日時を表す文字列に使用されている区切り文字を指定します。</li>
    <li>DateDelimiterには、年月日のそれぞれを区切る文字を指定します。
      指定がない場合は&quot;-&quot;が使用されます。</li>
    <li>DateTrailerには、年月日のパートと時分秒のパートを区切る文字を指定します。
      指定がない場合は&quot; &quot;が使用されます。</li>
    <li>TimeDelimiterには、時分秒のそれぞれを区切る文字を指定します。
      指定がない場合は&quot;:&quot;が使用されます。</li>
    <li>MsecDelimiterには、秒とミリ秒の間を区切る文字を指定します。
      指定がない場合は&quot;.&quot;が使用されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;文字コード指定&gt; ::=</dt>
    <dd>Code &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
  </dl>

  <ul>
    <li>文字コード指定は、データファイルおよびスペックファイルに用いられている文字コードを指定します。</li>
    <li>&quot;&quot;(空文字列)か&quot;utf-8&quot;のみ指定することができます。
      空文字列の場合はEUC、&quot;utf-8&quot;ではUTF-8が使用されます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;範囲指定&gt; ::=</dt>
    <dd>InputField &lt;等号演算子&gt; &lt;範囲指定数値列&gt;</dd>
    <dd>|&nbsp;InputRecord &lt;等号演算子&gt; &lt;範囲指定数値列&gt;</dd>
    <dt class="bold">&lt;範囲指定数値列&gt; ::=</dt>
    <dd>&lt;左括弧&gt; &lt;範囲要素&gt; [ { &lt;カンマ&gt; &lt;範囲要素&gt; } … ] &lt;右括弧&gt;</dd>
    <dt class="bold">&lt;範囲要素&gt; ::=</dt>
    <dd>&lt;符号なし整数&gt;</dd>
    <dd>|&nbsp;&lt;符号なし整数&gt; &lt;負符号&gt; [ &lt;符号なし整数&gt; ]</dd>
    <dd>|&nbsp;&lt;負符号&gt; &lt;符号なし整数&gt;</dd>
  </dl>

  <ul>
    <li>範囲指定は、データファイルの一部を使用する場合にその範囲を指定します。</li>
    <li>InputFieldは、FieldSeparatorで区切られる列データのうち
      入力として使用されるものの範囲を指定します。</li>
    <li>InputRecordは、RecordSeparatorで区切られるレコードデータのうち
      入力として使用されるものの範囲を指定します。</li>
  </ul>

  <pre class="example">
InputField=(1,3,5-11) ... 1番目、3番目、5番目から11番目の列データを使用します。
InputRecord=(-10)     ... 先頭の10個のレコードデータのみ使用します。
</pre>

  <dl>
    <dt class="bold">&lt;エラーファイル指定&gt; ::=</dt>
    <dd>ErrorData &lt;等号演算子&gt; &lt;一括登録ヒント内文字列&gt;</dd>
  </dl>

  <ul>
    <li>エラーファイル指定は、データファイルに不正なデータが含まれていた場合、
      その部分を出力するファイルを指定します。</li>
    <li>エラーファイル指定がないと、不正なデータが検出された時点でINSERT文はエラーとなりロールバックします。</li>
    <li>エラーファイル指定があると、不正なデータが検出されてもINSERT文の処理は停止せず最後まで実施されます。</li>
    <li>エラーファイル指定で指定したファイルに不正なデータを含む部分が出力されているので、
      そのファイルを訂正後一括登録に使用することで、効率的にデータ登録作業を行うことができます。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;特殊文字無視指定&gt; ::=</dt>
    <dd>NoExtern</dd>
    <dd>|&nbsp;NoElementNull</dd>
    <dd>|&nbsp;NoDoubleQuote</dd>
  </dl>

  <ul>
    <li>列データが「FILE &lt;文字列&gt;」という形式の文字列だった場合、その文字列自体ではなく、
      文字列が表すファイル(相対パスの場合はデータファイルのある場所からの相対パスと解釈されます)の内容が列データとして用いられます。
      NoExternをヒント句に指定すると、FILEをキーワードとして扱わず、「FILE &lt;文字列&gt;」という文字列は「FILE &lt;文字列&gt;」という列データを表すようになります。</li>
    <li>列データが「NULL」という文字列だった場合、NULL値を表します。
      配列型の列に相当する列データが「NULL」という文字列の場合、要素が1つでその要素がNULLであるという意味に解釈されます。
      NoElementNullをヒント句に指定すると、配列型の列に「NULL」が対応すると、列データ自体がNULL値であるという意味になります。</li>
    <li>列データが「&lt;二重引用符&gt;&lt;任意の文字列&gt;&lt;二重引用符&gt;」という形式の文字列だった場合、 「&lt;任意の文字列&gt;」の部分が列データとして解釈されます。
      &lt;二重引用符&gt;自体を列データに含めたい場合は、&lt;二重引用符&gt;で囲んだ上で、データ中で&lt;二重引用符&gt;を2つ並べる必要があります。
      NoDoubleQuoteを指定すると二重引用符は特別扱いされなくなり、常にデータの一部として解釈されます。</li>
  </ul>

  <h3><a id="sec611">6.11 問合せ</a></h3>

  <p class="first">DoqueDBがサポートする問合せを説明します。</p>

  <h4><a id="sec61101">6.11.1 問合せ指定</a></h4>

  <p>&lt;<a href="#sec60303">表式</a>&gt;の結果から導入される表を指定します。</p>

  <dl>
    <dt class="bold">&lt;問合せ指定&gt; ::=</dt>
    <dd>SELECT [ DISTINCT |&nbsp;ALL ] &lt;選択リスト&gt; &lt;表式&gt;</dd>

    <dt class="bold">&lt;選択リスト&gt; ::=</dt>
    <dd>&lt;アスタリスク&gt;</dd>
    <dd>|&nbsp;&lt;選択副リスト&gt; [ { &lt;カンマ&gt; &lt;選択副リスト&gt; } ... ]</dd>

    <dt class="bold">&lt;選択副リスト&gt; ::=</dt>
    <dd>&lt;導出列&gt;</dd>
    <dd>|&nbsp;&lt;表名&gt; &lt;ピリオド&gt; &lt;アスタリスク&gt;</dd>

    <dt class="bold">&lt;導出列&gt; ::=</dt>
    <dd>&lt;値式&gt; [ &lt;AS句&gt; ]</dd>

    <dt class="bold">&lt;AS句&gt; ::=</dt>
    <dd>[ AS ] &lt;列名&gt;</dd>
  </dl>

  <h3><a id="sec612">6.12 分散マネージャー</a></h3>

  <p class="first">分散マネージャーは、１つの表を複数のデータベースに水平分割して扱う機能です。
    分散マネージャーを使用することで、１つのDoqueDBでは扱うことができない大量のデータを高速に処理することができるようになります。
    分散マネージャーによる分散機能を利用する場合、２つ以上の子サーバーとそれをまとめる分散マネジャーの計３つ以上のDoqueDBが必要となります。</p>

  <p>分散マネージャーには以下の制約があります。</p>

  <ul>
    <li>表結合(JOIN)を行った場合、子サーバーをまたいでの結合はできません。(各子サーバー内での結合結果となります。)</li>
    <li>子サーバーとして使用するDoqueDBはユーザー管理ができません。</li>
    <li>ROWIDが一意のIDとなりません。</li>
  </ul>

  <p>また、複数のデータベースを同期更新するレプリケーション機能も提供します。</p>

  <h4><a id="sec61201">6.12.1 子サーバーの定義</a></h4>

  <p class="first">以下の構文で、分散マネージャーに子サーバーを定義(追加、変更、削除)します。
    子サーバーとして使用するDoqueDBはユーザー管理をしない設定で運用してください。</p>

  <dl>
    <dt class="bold">&lt;子サーバーの追加&gt; ::=</dt>
    <dd>
      CREATE CASCADE &lt;子サーバー名&gt; ON &lt;シングルクォート&gt;&lt;ホスト名&gt;&lt;シングルクォート&gt; &lt;ポート番号&gt; [&lt;データベース名&gt;]</dd>
  </dl>

  <ul>
    <li>&lt;子サーバー名&gt;には、定義済みの&lt;子サーバー名&gt;は使用できません。</li>
    <li>&lt;ホスト名&gt; &lt;ポート番号&gt;には子サーバーとして追加するDoqueDBが起動しているホスト名、ポート番号を指定してください。</li>
    <li>&lt;データベース名&gt;の詳細については、<a href="#sec60501">データベース定義</a>を参照してください。</li>
    <li>&lt;子サーバー名&gt;の詳細については、<a href="#sec605">スキーマ定義</a>を参照してください。</li>
    <li>&lt;データベース名&gt;を省略した場合、CREATE CASCADE文を発行するセッションに関連付けられたデータベースとなります。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;子サーバーの変更&gt; ::=</dt>
    <dd>
      ALTER CASCADE &lt;子サーバー名&gt; ON &lt;シングルクォート&gt;&lt;ホスト名&gt;&lt;シングルクォート&gt; &lt;ポート番号&gt; [&lt;データベース名&gt;]</dd>
  </dl>

  <dl>
    <dt class="bold">&lt;子サーバーの削除&gt; ::=</dt>
    <dd>
      DROP CASCADE &lt;子サーバー名&gt;</dd>
  </dl>

  <p>データベース名を省略した場合、SQL文を発行するセッションに関連付けられたデータベース名になります。
    また、データベースはあらかじめ分散マネージャーおよび、それぞれの子サーバーに作成しておく必要があります。
    子サーバーを定義後に分散マネージャーで作成した表は、子サーバーにも作成されます。</p>

  <h4><a id="sec61202">6.12.2 分散ルールの定義</a></h4>

  <p class="first">下の構文で定義した分散ルールに従って、子サーバーにデータが格納されます。
    子サーバーが定義されているデータベース内の表で、分散ルールが定義されていない表はすべての子サーバーに同じデータが格納されます(レプリケーション)。</p>

  <dl>
    <dt class="bold">&lt;ルールの定義&gt; ::=</dt>
    <dd>
      CREATE PARTITION ON &lt;表名&gt; BY &lt;関数名&gt; [&lt;列名リスト&gt;]</dd>
  </dl>

  <ul>
    <li>&lt;表名&gt;の詳細については、<a href="#sec60503">表定義</a>を参照してください。</li>
    <li>既にルールが定義されている表名は使用できません。</li>
    <li>&lt;関数名&gt;の詳細について関数の定義を参照してください。</li>
    <li>&lt;列名リスト&gt;は関数の引数として使用される列のリストになります。</li>
  </ul>

  <dl>
    <dt class="bold">&lt;列名リスト&gt; ::=</dt>
    <dd>&lt;列名&gt; [ { &lt;カンマ&gt; &lt;列名&gt; } ... ]</dd>

    <dt class="bold">&lt;ルールの変更&gt; ::=</dt>
    <dd>
      ALTER PARTITION ON &lt;表名&gt; BY &lt;関数名&gt; [&lt;列名リスト&gt;]</dd>
  </dl>

  <h4><a id="sec61203">6.12.3 関数の定義</a></h4>

  <dl>
    <dt class="bold">&lt;関数の定義&gt; ::=</dt>
    <dd>
      CREATE FUNCTION &lt;関数名&gt; &lt;左括弧&gt; [引数リスト] &lt;右括弧&gt; RETURNS &lt;戻り値型&gt; RETURN &lt;関数記述&gt;
      &lt;引数リスト&gt; ::= &lt;引数定義&gt; [ {&lt;カンマ&gt; &lt;引数定義&gt; } ... ]
      &lt;引数定義&gt; ::= &lt;引数名&gt; &lt;データ型&gt;</dd>
  </dl>

  <pre class="example">
create function function (x int)
    returns nvarchar(100)
    return
        case
        when mod(x,4) = 0 then 'child1'
        when mod(x,4) = 1 then 'child2'
        else 'child2'
        end;
</pre>

  <dl>
    <dt class="bold">&lt;関数の削除&gt; ::=</dt>
    <dd>
      DROP FUNCTION &lt;関数名&gt;</dd>
  </dl>

  <p>削除対象の関数が分散ルールとして使用されている場合は、例外が発生します。</p>

  <ul>
    <li>関数の変更は未サポートです。</li>
    <li>使用例<br>
      以下は子サーバーの追加から分散ルールの定義までの例です。
      <pre class="example">
create cascade child1 on 'hostName1' 54321;
create cascade child2 on 'hostName2' 54321;
create table t (d_id int);
create function rule (x int)
    returns nvarchar(100)
    return
        case
        when mod(x,4) = 0 then 'child1'
        when mod(x,4) = 1 then 'child2'
        else 'child2'
        end;
create partition on t by rule (d_id);
</pre>
    </li>
  </ul>

  <h3><a id="sec613">6.12 非同期レプリケーション</a></h3>

  <p class="first">
    非同期レプリケーションとは、データベースの更新内容を他のデータベースに複製する機能です。
  </p>
  <p>
    DoqueDBの非同期レプリケーションの単位はデータベースになります。
    レプリケーション方式はマスター・スレーブ方式で、
    マスターデータベースへの更新内容をスレーブデータベースに転送する、
    単方向のレプリケーションになります。
    スレーブを複数指定することも可能です。
    ただし、スレーブデータベースをマスターデータベースとしたスレーブデータベースは定義できません。
  </p>
  <p>
    レプリケーションされる操作は以下のものになります。
  </p>
  <ul>
    <li>データ操作 (INSERT文、DELETE文、UPDATE文)</li>
    <li>テーブル操作 (CREATE TABLE文、ALTER TBALE文など)</li>
    <li>索引操作 (CREATE INDEX文、DROP INDEX文など)</li>
    <li>特権操作 (GRANT文、REVOKE文)</li>
  </ul>
  <dl>
    <dt class="bold">マスターデータベース</dt>
    <dd>
      レプリケーション元のデータベースで、通常の手段で定義されたデータベースです。
      マスターデータベースに対しては、すべての操作が可能です。
    </dd>
    <dt class="bold">スレーブデータベース</dt>
    <dd>
      レプリケーション先のデータベースで、後述する手段で定義されたデータベースです。
      スレーブデータベースに対しては、以下の操作のみが可能です。
      更新トランザクションは実行できません。
      <ul>
        <li>SELECT文の実行</li>
        <li>一時表の操作</li>
        <li>整合性検査(ただし、更新は不可)</li>
        <li>レプリケーションの一時停止・再開</li>
        <li>スレーブデータベースからマスターデータベースへの昇格</li>
        <li>データベースのDROP</li>
      </ul>
    </dd>
  </dl>
  <p>
    非同期レプリケーションに関して、以下のパラメーターが追加されています。
  </p>
  <table>
    <thead>
      <tr>
        <th>パラメーター名</th>
        <th>型</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>LogicalLog_RotateThreshold</td>
        <td>数値</td>
        <td>マスターデータベースの論理ログを保持する最小サイズ<br>
          (デフォルト：100Mバイト)</td>
      </tr>
    </tbody>
  </table>

  <h4><a id="sec61301">6.13.1 スレーブデータベースの定義</a></h4>

  <p class="first">
    スレーブデータベースの定義は、以下の構文で行います。
  </p>
  <dl>
    <dt class="bold">&lt;スレーブデータベース定義&gt; ::=</dt>
    <dd>
      MOUNT &lt;データベース名&gt; &lt;パス指定&gt; AS SLAVE FROM MASTER &lt;引用符&gt;&lt;マスターURL&gt;&lt;引用符&gt;
    </dd>
    <dt class="bold">&lt;マスターURL&gt; ::=</dt>
    <dd>
      &lt;スキーム名&gt;://[ &lt;ユーザー名&gt;:&lt;パスワード&gt;@ ]&lt;ホスト名&gt;:&lt;ポート番号&gt;/&lt;データベース名&gt;
    </dd>
    <dt class="bold">&lt;スキーム名&gt; ::=</dt>
    <dd>
      doquedb
    </dd>
  </dl>
  <ul>
    <li>レプリケーション対象であるマスターデータベースのバックアップをマウントすることにより、
      レプリケーションを開始します。
      それ以外の方法では定義できません。</li>
    <li>バックアップはオンラインバックアップまたはアンマウントした状態からのバックアップのみで、
      オフライン状態のデータベースからのバックアップはサポートしていません。</li>
    <li>スレーブデータベースの定義時には、
      マスターデータベースにアクセスできる状態である必要があります。</li>
    <li>URLに指定されている認証情報は、最初の接続時のみに利用され、
      その後の通信に利用されることはありません。
      そのため、スレーブデータベース側に認証情報は保存されません。</li>
  </ul>

  <h4><a id="sec61302">6.13.2 一時停止と再開</a></h4>

  <p class="first">
    スレーブデータベースは、以下の構文で一時停止あるいは再開できます。
  </p>
  <dl>
    <dt class="bold">&lt;一時停止&gt; ::=</dt>
    <dd>
      ALTER DATABASE &lt;データベース名&gt; STOP SLAVE
    </dd>
    <dt class="bold">&lt;再開&gt; ::=</dt>
    <dd>
      ALTER DATABASE &lt;データベース名&gt; START SLAVE
    </dd>
  </dl>
  <ul>
    <li>スレーブデータベースの一時停止および再開は、
      レプリケーションを一時的に停止したい場合に利用します。</li>
    <li>レプリケーションは論理ログを転送することにより実現していますが、
      長期間停止していると、マスターデータベースの論理ログが削除されてしまい、
      レプリケーションを再開できない場合があります。
      そのような場合は、スレーブデータベースの定義をやり直してください。</li>
  </ul>

  <h4><a id="sec61303">6.13.3 マスターへの昇格</a></h4>

  <p class="first">
    スレーブデータベースをマスターに昇格させるには、以下の構文を使用します。
  </p>
  <dl>
    <dt class="bold">&lt;マスター昇格&gt; ::=</dt>
    <dd>
      ALTER DATABASE &lt;データベース名&gt; SET TO MASTER
    </dd>
  </dl>
  <ul>
    <li>スレーブデータベースをマスターデータベースと切り離して、通常のデータベースに変更します。<br>
      一度マスターに昇格され、マスターデータベースと切り離されたデータベースを、
      再びスレーブデータベースに戻すことはできません。</li>
  </ul>

  <h4><a id="sec61304">6.13.4 データベース構成</a></h4>

  <p class="first">
    データベース構成として、以下のような構成が考えられます。
  </p>
  <dl>
    <dt class="bold">バックアップ型</dt>
    <dd>
      スレーブデータベースをバックアップの代わりに利用することができます。
      マスターデータベースに障害が発生した場合、スレーブデータベースをマスターに昇格させます。
      これまでのバックアップよりダウンタイムを減少させることが可能となります。
      <p class="center"><img src="image/replication1.png" alt=""></p>
    </dd>
    <dt class="bold">検索負荷分散型</dt>
    <dd>
      更新頻度が比較的少なく検索負荷の高いアプリケーションは、
      スレーブデータベースを利用した検索負荷分散型の構成を利用することができます。
      ひとつのマスターデータベースに複数のスレーブデータベースを定義しておき、
      更新処理はマスターデータベースに対してのみ行い、
      検索は各スレーブデータベースに負荷分散します。
      <p class="center"><img src="image/replication2.png" alt=""></p>
    </dd>
    <dt class="bold">冗長型</dt>
    <dd>
      オンライントランザクション重視のアプリケーションは、
      分散マネージャーとスレーブデータベースを利用した冗長構成を利用することができます。
      <p class="center"><img src="image/replication3.png" alt=""></p>
      マスターAおよびBは、分散マネージャーを介して操作される、
      同期型のレプリケーションデータベースです。
      それぞれのマスターデータベースにスレーブデータベースを定義し、
      万一、マスターデータベースに障害が発生した場合でも、
      短期間で復旧することが可能となります。
      また、データの損失も発生しません。
      <p class="center"><img src="image/replication4.png" alt=""></p>
      マスターBに障害が発生した場合、分散マネージャーからマスターBを切り離します。
      スレーブAがマスターAと完全に同期されてから、スレーブAをマスターデータベースに昇格させ、
      スレーブAから昇格したマスターBを分散マネージャーの配下に組み込みます。
      その後、それぞれのマスターデータベースのスレーブを新しく定義します。
    </dd>
  </dl>

  <h4><a id="sec61305">6.13.5 制限事項</a></h4>

  <p class="first">
    非同期レプリケーションには以下の制限があります。
  </p>
  <dl>
    <dt class="bold">スレーブデータベース</dt>
    <dd>
      スレーブデータベースに対しては、以下の制限があります。
      <ul>
        <li>バックアップを実施することができません。</li>
        <li>データベースをアンマウントすることはできません。</li>
        <li>一度マスターデータベースに昇格したデータベースをスレーブに戻すことはできません。</li>
        <li>スレーブデータベースのレプリケーションを定義することはできません。</li>
        <li>対象のマスターデータベースを変更することはできません。</li>
      </ul>
    </dd>
    <dt class="bold">マスターデータベース</dt>
    <dd>
      マスターデータベースに対しては、以下の制限があります。
      <ul>
        <li>アンマウントしてから再度マウントすることはできません。<br>
          再度マウントすると別のデータベースとなるため、
          スレーブデータベースとの関係が切断されます。</li>
      </ul>
    </dd>
    <dt class="bold">レプリケーション再開の失敗</dt>
    <dd>
      レプリケーションは、マスターデータベースからスレーブデータベースに
      論理ログを転送することにより実現しています。
      しかし、マスターデータベースは、スレーブデータベースが
      論理ログをどこまでレプリケートしたのかは管理していません。
      そのため、マスターデータベースは、スレーブデータベースが必要としている
      論理ログを削除してしまう場合があります。
      このような場合、スレーブ側のレプリケートはエラーとなります。
      復旧する場合には、スレーブ側のデータベースを削除し、
      レプリケーション定義からやり直す必要があります。
    </dd>
    <dt class="bold">分散データベース</dt>
    <dd>
      分散マネージャーの分散データベースはレプリケートすることはできません。
    </dd>
    <dt class="bold">権限管理</dt>
    <dd>
      データベースに対する権限はレプリケートされますが、
      ユーザ情報自体はレプリケートされません。
      スレーブデータベースを保持するDoqueDBにも、
      利用者の責任で同じユーザを定義する必要があります。
    </dd>
  </dl>

  <h2><a id="secapp">附録</a></h2>

  <h3><a id="secappa">A. N-gram索引</a></h3>

  <p class="first">N-gram索引とは、全文データをN文字ごとに切り出したものを索引単位とする転置索引です。
    ただし、文字の切り出し方は常にN文字に固定されているとは限りません。文字種や文字種の切り替わりによって切り出し方法を変えることもあります。
    たとえば、文字列「OAのリコー」を 2-gram で切り出すと以下のようになります。</p>

  <pre class="example">
「OA」「A」「の」「リコ」「コー」「ー」
</pre>

  <p>日本語のようにスペースで単語区切りが明確になっていない文書の検索に利用すると、
    検索漏れを少なくすることができます。</p>

  <h3><a id="secappb">B. ヒント句の使い方</a></h3>

  <p class="first">DoqueDBの性能を引き出すためには、
    適切な&lt;<a href="#sec60505">ヒント句</a>&gt;を設定する必要があります。</p>

  <p>まず、DoqueDBのファイル構成を説明します。</p>

  <p>表を構成する列値は原則としてレコードファイルに格納されます。
    (BLOBとNCLOBは別のLobファイルに格納されます。)
    レコードファイルは固定長用のファイルと可変長用のファイルから構成されます。
    固定長のファイルには、固定長型(ROWID, int, bigint, float, datetime)の列値と
    可変長ファイルに格納される可変長オブジェクトへのポインターが格納されます。
    hint heapつきの列やLOBがあるときは、そのオブジェクトへのポインターも格納されます。
    また、hint 'fixed' が指定されている列も固定長のファイルに格納されます。
    可変長のファイルには、可変長型(char, varchar, nchar, nvarchar, binary)の列値を
    ひとまとまりにした可変長オブジェクトが格納されます。</p>

  <p>以下、具体例を示しながら&lt;ヒント句&gt;の使い方を説明します。</p>

  <pre class="example">
create table TBL (
 id int,
 title nvarchar(100),
 contents nvarchar(no limit)
);
</pre>

  <p>このとき、固定長ファイルには以下のデータが格納されます。</p>

  <pre class="example">
ROWID                (4byte)
id                   (4byte)
可変長へのポインター (6byte)
</pre>

  <p>また、可変長ファイルには以下のデータが格納されます。</p>

  <pre class="example">
title                (最大200byte)
contents             (無制限)
</pre>

  <p>ここで、簡単な検索アプリを考えてみます。
    idが指定した範囲にあるデータの一覧を得ることにします。
    一覧なのでidとtitleがあればいいでしょう。</p>

  <pre class="example">
select id, title from TBL where id between ? and ?;
</pre>

  <p>この処理をするためにはidとtitleの値があればいいのですが、
    可変長オブジェクトにtitleとcontentsがまとめられているため、
    不必要なcontentsのデータまで読み込むことになります。</p>

  <p>このような場合、contentsをヒープにします。</p>

  <pre class="example">
create table TBL (
 id int,
 title nvarchar(100),
 contents nvarchar(no limit) hint heap
);
</pre>

  <p>こうすると、固定長ファイルには以下のデータが格納されます。</p>

  <pre class="example">
ROWID                  (4byte)
id                     (4byte)
contentsへのポインター (6byte)
可変長へのポインター   (6byte)
</pre>

  <p>可変長ファイルには以下のデータが格納されます。</p>

  <pre class="example">
title                  (最大200byte)
</pre>

  <p>contentsの値は別のレコードファイルに格納されます。
    ここで先ほどのSQL文を考えてみます。</p>

  <pre class="example">
select id, title from TBL where id between ? and ?;
</pre>

  <p>今度は、titleだけが取得されるので無駄な読み込みがなくなり、速度が改善されます。
    なお、titleとcontentsを同時に取得することが多いような場合には逆効果になります。
    さらに、titleを固定長ファイルに格納してしまうこともできます。</p>

  <pre class="example">
create table TBL (
 id int,
 title nvarchar(100) hint 'fixed',
 contents nvarchar(no limit) hint heap
);
</pre>

  <p>hint 'fixed'のほうは引用符で囲まれていることに注意してください。
    こうすると、固定長ファイルには以下のデータが格納されます。</p>

  <pre class="example">
ROWID                  (4byte)
id                     (4byte)
title                  (200byte)
contentsへのポインター (6byte)
</pre>

  <p>可変長ファイルは作られません。
    titleに対応する部分は最大長の100文字分=200byteが領域として確保されます。
    今度は固定長ファイルしか読まれないのでその分処理としては減ります。
    ただし、固定長のデータサイズが著しく増加しています。(20⇒214)
    このことによりバッファリングの効果が薄れるので、
    一度に大量のレコードを読み込むことがあるような場合は
    逆効果になるおそれがあります。
    しかし、一般には固定長データと同時に取得されることが分かっている
    比較的短い可変長データはhint 'fixed'をつけたほうがいいと予想されます。</p>

  <h3><a id="secappc">C. LOB型の使い方</a></h3>

  <p class="first">LOB（ラージオブジェクト）型のうち、DoqueDBがサポートしているのは、
    BLOB型とNCLOB型です。
    BLOB、NCLOB型には、最大2GBまでのテキスト、静止画、動画などの
    大きなデータを格納できます。</p>

  <p>DoqueDBのLOB型には、次のような特徴があります。</p>

  <ul>
    <li>行の挿入、更新、削除において、他のデータ型と同様に扱えます。</li>
    <li>選択は、LOB値そのものを返します。
      他のDBMSにおけるLOBとは異なり、ロケーターは返しません。</li>
    <li>格納データの特定の部分へのアクセスや、更新ができます。</li>
    <li>索引は作成できません。</li>
  </ul>

  <p>特に、大きなデータの一部を取得、変更するような処理では、
    すべてのデータを読み込まずに必要な部分だけを読み込むLOB型は、
    NVARCHAR型等と比較して高速に処理できます。
    (NVARCHAR型等は、ファイルからいったんすべてのデータを読み込み、
    修正・変更したい部分をメモリー上で切り出して処理するので、時間がかかります。)</p>

  <p>LOB列に対する操作例をあげます。</p>

  <pre class="example">
SUBSTRING(lob_column FROM 1000 FOR 100)
</pre>

  <p>上記の例は、1000バイト目から100バイトだけ切り出して返すことができます。</p>

  <pre class="example">
update T set lob_column = lob_column || '追加' where ...
</pre>

  <p>上記の例は、既存のデータの後ろに新しいデータを追加する更新です。
    <a href="#sec30304">チューニング用パラメーター</a>のBuffer_NormalPoolSizeを超える巨大なデータも
    この「データを追加する更新」を利用することで格納できます。
  </p>

  <pre class="example">
update T set lob_column = OVERLAY(lob_column PLACING '置き換え' FROM 1000) where ...
</pre>

  <p>上記の例は、既存のデータの一部を新しいデータで置き換える更新です。</p>

  <p>LOB型の列には長大なデータが入ることがあるため、
    以下のSQL文でのLOB列の使用はおすすめしません。</p>

  <ul>
    <li>問合せ文のORDER BY 句</li>
    <li>問合せ文のGROUP BY 句</li>
    <li>SELECT ... DISTINCT文</li>
    <li>SELECT ... UNIQUE文</li>
    <li>結合</li>
  </ul>

  <h3><a id="secappd">D. IDENTITY列の使い方</a></h3>

  <p class="first">DoqueDBではSQL規格のIDENTITY列をサポートしています。
    int型の列定義に&lt;IDENTITY列指定&gt;を追加することでIDENTITY列を作成できます。
    この節では、IDENTITY列のIDENTITY列の使い方を説明します。
    構文と留意点については、<a href="#sec60504">列定義</a>を参照してください。</p>

  <p>以下ではIDENTITY列の使い方を説明します。</p>

  <pre class="example">
create table T (
 id int GENERATED BY DEFAULT AS IDENTITY,
 text nvarchar(1024)
);
insert T(text) values ('id is not specified');    -- idには0が入ります
insert T(id, text) values (30, 'id is 30');       -- idには30が入ります
insert T(text) values ('id is not specified');    -- idには1が入ります
insert T(id, text) values (10, 'id is 10');       -- idには10が入ります
insert T(text) values ('id is not specified');    -- idには2が入ります
</pre>

  <p>上記の例では、
    表TにINSERT文を実行するときに、idの値を指定すると指定した値になります。
    idの値を指定せずにINSERTを行うと、
    idには順に0、1、2 …のように1刻みの値が自動的に割り当てられます。</p>

  <pre class="example">
create table T (
 id int GENERATED BY DEFAULT AS IDENTITY (START WITH 0 INCREMENT BY 10),
 text nvarchar(1024)
);
</pre>

  <p>上記は、INCREMENT BY を使った例です。
    idの値を指定すると指定した値となるのは同様ですが、
    idの値を指定せずにINSERTを行うと、
    idには順に0、10、20…のように10刻みの値が自動的に割り当てられます。</p>

  <pre class="example">
create table T (
 id int GENERATED BY DEFAULT AS IDENTITY (GET MAX),
 text nvarchar(1024)
);
insert T(text) values ('id is not specified');    -- idには0が入ります
insert T(id, text) values (30, 'id is 30');       -- idには30が入ります
insert T(text) values ('id is not specified');    -- idには31が入ります
insert T(id, text) values (10, 'id is 10');       -- idには10が入ります
insert T(text) values ('id is not specified');    -- idには32が入ります
</pre>

  <p>上記は、GET MAX を使った例です。
    通常は、INSERT文やUPDATE文でIDENTITY列の値を指定しても、
    次に生成される値には影響しません。
    しかし、GET MAXが指定されたIDENTITY列に値を指定すると、
    次の生成される値に影響を与えるようになります。
    idの値を指定すると指定した値となるのは同様ですが、
    idの値を指定しないでINSERTを行うと、
    idにはその時点で最大のID+1が自動的に割り当てられます。</p>

  <pre class="example">
create table T (
 id int GENERATED ALWAYS AS IDENTITY (START WITH 0 INCREMENT BY 10),
 text nvarchar(1024)
);
</pre>

  <p>上記は、GENERATED ALWAYSを使った例です。
    idの値を指定したINSERT文を実行しようとするとエラーになります。</p>

  <h3><a id="normrsc"></a><a id="secappe">E. 異表記正規化辞書</a></h3>

  <p class="first">DoqueDBでは、異表記正規化を行うことができます。</p>

  <p>索引作成時には、&lt;<a href="#sec60505">ヒント句</a>&gt;の
    &lt;UNAリソース指定&gt;で指定された辞書を用いて文字列の正規化を行います。
    @UNARSCIDでは形態素解析に用いる辞書を指定し、
    @NORMRSCIDでは文字単位の正規化に用いる辞書を指定します。
    現在は、いずれもID:1の標準リソースのみ提供されています。</p>

  <p>検索時には、&lt;<a href="#sec60407">CONTAINS述語</a>&gt;の&lt;抽出指定&gt;で指定された
    辞書を用いて、文字列の正規化に加えて文字列の表記の展開も行います。
    @TERMRSCIDについては<a href="#secapp">附録</a> <a href="#secappf">F. 質問処理辞書</a>を参照してください。</p>

  <p>文字列の正規化について、正規化ルールの詳細を以下に示します。</p>

  <table>
    <thead>
      <tr>
        <th colspan=2>変換ルール</th>
        <!-- <td></td> -->
        <th>対象文字種</th>
        <th>説明</th>
        <th>例</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan=9>文字の同一視</td>
        <td rowspan=3>全角⇔半角</td>
        <td>英数字/記号</td>
        <td>全角の英数字/記号を半角に正規化する。英字については同時に小文字への正規化も行なうため、全角大文字は半角小文字に正規化される。</td>
        <td>
          「ａ」 → 「a」<br>
          「０」 → 「0」<br>
          「＄」 → 「$」
        </td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <!-- <td></td> -->
        <td>スペース</td>
        <td>全角スペースを半角スペース（0020：SPACE）に正規化する。</td>
        <td>3000（IDEOGRAPHIC SPACE） → 0020（SPACE）</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <!-- <td></td> -->
        <td>カタカナ</td>
        <td>半角カタカナ（半角句読点、かぎ括弧も含む）を全角カタカナに正規化する。</td>
        <td>
          「ｧ」 → 「ァ」<br>
          「｡」 → 「。」
        </td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <td>大文字⇔小文字</td>
        <td>Latin/Cyrillic/Greek</td>
        <td>ラテン文字/ギリシャ文字/キリル文字（ロシア語アルファベット）の大文字を小文字に正規化する。</td>
        <td>「A」 → 「a」 （ラテン文字）</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <td rowspan=2>旧字⇔新字</td>
        <td>カタカナ</td>
        <td rowspan=2>ひらがな/カタカナの旧字を新字に正規化する。</td>
        <td>「ヱ」 → 「エ」</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <!-- <td></td> -->
        <td>ひらがな</td>
        <!-- <td></td> -->
        <td>「ゐ」 → 「い」</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <td>音標付⇔音標無</td>
        <td>Latin/Cyrillic/Greek</td>
        <td>ラテン文字/ギリシャ文字/キリル文字（ロシア語アルファベット）の音標付を音標無に正規化する。</td>
        <td>「й」 → 「и」（キリル文字）</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <td>空白文字</td>
        <td>(\t は制御文字)</td>
        <td>スペース（00A0：NO-BREAK SPACE、2002：EN SPACEなど）をUnicode 0020に正規化する。</td>
        <td>00A0（NO-BREAK SPACE） → 0020（SPACE）</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <td>漢字異体字</td>
        <td>日</td>
        <td>漢字の異体字（旧字、略字など）を正規化する。</td>
        <td>
          「劍」 → 「剣」<br>
          「仂」 → 「働」
        </td>
      </tr>
      <tr>
        <td rowspan=3>文字の削除</td>
        <td>制御文字</td>
        <td>改行文字を含む</td>
        <td>タブ、改行などの制御文字を削除する。</td>
        <td>0001（&lt;control&gt;）を削除</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <td>空白文字 ※1</td>
        <td>(\t は制御文字)</td>
        <td>空白文字を削除する。</td>
        <td>0020（SPACE）を削除</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <td>結合文字</td>
        <td>合字できなかったもの</td>
        <td>仮名の合字や音標符号付き文字の正規化と整合をとるため、濁点/半濁点、音標符号を削除する。</td>
        <td>「^」(CIRCUMFLEX ACCENT)、「`」(GRAVE ACCENT) を削除</td>
      </tr>
      <tr>
        <td colspan=2 rowspan=2>合字</td>
        <!-- <td></td> -->
        <td>カタカナ</td>
        <td rowspan=2>ひらがな/カタカナの清音と濁点/半濁点の連続を、対応する濁音/半濁音に合成する。</td>
        <td>「ハ」 ＋ 「゜」 → 「パ」</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <!-- <td></td> -->
        <td>ひらがな</td>
        <!-- <td></td> -->
        <td>「か」 ＋ 「゛」 → 「が」</td>
      </tr>
      <tr>
        <td colspan=2>異表記正規化</td>
        <!-- <td></td> -->
        <td>カタカナ</td>
        <td>「大文字＋小文字」から大文字への変換、長音から大文字への変換などを行う。</td>
        <td>
          「ヴァ」 → 「バ」<br>
          「ベー」 → 「ベイ」
        </td>
      </tr>
      <tr>
        <td colspan=2 rowspan=2>メタ処理</td>
        <!-- <td></td> -->
        <td>ハイフン</td>
        <td>長音「ー」がカタカナに後続しない場合、ハイフン「-」に変換する。</td>
        <td>「ＣＤーＲＯＭ」 → 「cd-rom」（全角英字は半角に、大文字は小文字に正規化される）</td>
      </tr>
      <tr>
        <!-- <td></td> -->
        <!-- <td></td> -->
        <td>長音</td>
        <td>長音と紛らわしい文字「―」「－」「‐」「-」がカタカナに後続する場合、長音「ー」に変換する。</td>
        <td>「チュ－イングガム」 → 「チューイングガム」</td>
      </tr>
      <tr>
        <td colspan=2>ステミング ※2</td>
        <!-- <td></td> -->
        <td>英</td>
        <td>リコー製ステマーによる。屈折形（統語的機能を表す語形変化）を対象に単語語尾を正規化する。</td>
        <td>
          「polymers」 → 「polymer」<br>
          「waked, woke」 → 「wake」<br>
          「angrier」 → 「angry」
        </td>
      </tr>
    </tbody>
  </table>

  <p>
    <span class="bold">※1</span> &lt;<a href="#sec60505">ヒント句</a>&gt;の&lt;スペース削除指定&gt;で
    「削除しない」から「削除する」への制御が可能です。<br>
    <span class="bold">※2</span> &lt;<a href="#sec60505">ヒント句</a>&gt;の&lt;ステミング指定&gt;で
    ステミングの制御が可能です。
  </p>

  <h3><a id="termrsc"></a><a id="secappf">F. 質問処理辞書</a></h3>

  <p class="first">質問処理辞書は、質問文から名詞句を検索語として抽出するために使われます。
    DoqueDBには以下の質問処理辞書があります。</p>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>リソース名</th>
        <th>説明</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>0</td>
        <td>term</td>
        <td>日本語用辞書 (正規表現を使用した一般的なもの)</td>
      </tr>
      <tr>
        <td>1</td>
        <td>termrsc7</td>
        <td>日本語特許用辞書 (termより3割程度高速)</td>
      </tr>
    </tbody>
  </table>

  <p><a href="#sec60407">CONTAINS述語</a>の&lt;抽出指定&gt;では、
    この処理に用いる辞書リソースのIDを@TERMRSCIDに指定します。

  <h3><a id="secappg">G. B+木索引の使い方</a></h3>

  <p class="first">B+木索引は、列に対する等式または不等式を条件とする検索を速くする、
    データベースシステムで一般的に使われている索引です。</p>

  <h4><a id="secappg1">G.1 カラムサイズ</a></h4>

  <p class="first">B+木索引の&lt;索引要素リスト&gt;で指定された各列の合計サイズには上限があります。
    索引のキーとなる各列のサイズと索引が内部的に保持するバリューのサイズ
    (4バイト)との合計は、1000バイトを超えてはいけません。</p>

  <p>各データ型のデータの長さは、次の計算式で計算されます。
    ただし、割り算の余りは常に切り捨てます。</p>

  <table>
    <thead>
      <tr>
        <th>データ型</th>
        <th>計算式</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>CHAR(n)、VARCHAR(n)</td>
        <td>((n+1)/4+1)*4</td>
      </tr>
      <tr>
        <td>NCHAR(n)、NVARCHAR(n)</td>
        <td>(n/2+1)*4</td>
      </tr>
      <tr>
        <td>UNIQUEIDENTIFIER</td>
        <td>36</td>
      </tr>
      <tr>
        <td>INT</td>
        <td>4</td>
      </tr>
      <tr>
        <td>BIGINT</td>
        <td>8</td>
      </tr>
      <tr>
        <td>DECIMAL</td>
        <td>下記参照</td>
      </tr>
      <tr>
        <td>FLOAT</td>
        <td>8</td>
      </tr>
      <tr>
        <td>DATETIME</td>
        <td>8</td>
      </tr>
      <tr>
        <td>LANGUAGE</td>
        <td>16</td>
      </tr>
    </tbody>
  </table>

  <p>DECIMALのサイズは、列定義時の&lt;精度&gt;と&lt;位取り&gt;によって決まります。
    以下にサイズを求める式を示します。ただし、割り算の余りは常に切り捨てます。</p>

  <ul>
    <li>P = &lt;精度&gt;</li>
    <li>S = &lt;位取り&gt;</li>
    <li>f(x) = (x + 1)/2 (0 &lt;= x &lt;= 8), f(9)= 4</li>
    <li>X = (P-S)/9</li>
    <li>Y = S/9</li>
    <li>Z = X*4 + f(P-S-(X*9)) + Y*4 + f(S-(Y*9))</li>
    <li>サイズ = ((Z+3)/4 + 1) * 4</li>
  </ul>

  <h3><a id="secapph">H. 全文索引の使い方</a></h3>

  <p class="first">全文索引は、テキストデータを文字列で高速に検索するための索引です。
    この節では、<a href="#sec1">1章 全文索引チュートリアル</a>より詳しく使い方を説明します。</p>

  <h4><a id="secapph1">H.1 全文索引のスキーマ定義</a></h4>

  <p class="first">全文索引の性能を引き出すためには、
    &lt;<a href="#sec60505">ヒント句</a>&gt;等のスキーマを適切に設定する必要があります。</p>

  <p>以下では、全文索引のスキーマ定義の例を示します。</p>

  <pre class="example">
create table T (data nvarchar(no limit), l language);
create fulltext index F on T(data) language column l
 hint 'delayed, inverted=(
  normalized=(stemming=true, deletespace=false),
  indexing=dual,
  tokenizer=DUAL:JAP:ALL:2 ALP:3 ASC:3 KAT:3 KAN:HIR @NORMRSCID:1 @UNARSCID:1)';
</pre>

  <p>上記の例では、列dataに対して、言語型列「l」を使用し、dual索引を定義しています。
    列「l」には、索引作成対象のデータの言語が格納されます。
    また、&lt;ヒント句&gt;にdelayedを指定し、遅延更新を採用しています。</p>

  <pre class="example">
create table T (data nvarchar(no limit));
create fulltext index F on T(data)
 hint 'delayed, inverted=(
  normalized=(stemming=true, deletespace=false),
  indexing=dual, language=ja,
  tokenizer=DUAL:JAP:ALL:2 ALP:3 ASC:3 KAT:3 KAN:HIR @NORMRSCID:1 @UNARSCID:1)';
</pre>

  <p>上記の例では、&lt;言語列指定&gt;が省略されています。
    この場合、データの言語は、
    ヒント句の&lt;言語指定&gt;(この例では日本語)で指定された言語だとみなします。
    言語指定も省略された場合は、日本語＋英語とみなします。
    言語対応の詳細については、<a href="#sec306">多言語対応</a>を参照してください。</p>

  <p>以下では&lt;トークナイズパラメーター&gt;の例をあげます。</p>

  <pre class="example">
DUAL:JAP:ALL:2 ALP:3 ASC:3 KAT:3 KAN:HIR @NORMRSCID:1 @UNARSCID:1
</pre>

  <p>上記の例は、索引タイプがNGRAMもしくはDUALで、日本語データを対象とし、
    テキスト量が比較的多い(1GB以上)場合の例です。</p>

  <pre class="example">
DUAL:JAP:ALL:1 @NORMRSCID:1 @UNARSCID:1
</pre>

  <p>上記の例は、索引タイプがNGRAMもしくはDUALで、日本語データを対象とし、
    テキスト量が比較的少ない(1GB以下)場合の例です。</p>

  <pre class="example">
DUAL:JAP @NORMRSCID:1 @UNARSCID:1
</pre>

  <p>上記の例は、索引タイプがWORDで日本語のデータを対象とした場合の例です。</p>

  <h4><a id="secapph2">H.2 全文索引の挿入</a></h4>

  <p class="first">全文索引が付いた列やその言語型列に対する挿入も、通常の列への挿入と同様です。</p>

  <pre class="example">
create table T(data nvarchar(no limit), l language);
create fulltext index F on T(data) language column l;
insert into T values ('あいうえお', 'ja');
</pre>

  <p>また、大量データの全文索引を一括で作成したいときは、
    バッチインサートを利用することをおすすめします。
    DoqueDBでは、データ挿入後に索引を定義することで、
    バッチインサートを行えるようにしています。</p>

  <pre class="example">
create table T(data nvarchar(no limit), l language);
insert into T values ('あいうえお', 'ja');
insert into T values ('かきくけこ', 'ja');
...                                        -- 大量データの挿入
create fulltext index F on T(data) language column l;
</pre>

  <p>バッチインサートを高速に行うためには、
    一時的に使用するメモリーを大きくすると効果的です。
    詳細については、<a href="#sec30304">チューニング用パラメーター</a>を参照してください。</p>

  <h4><a id="secapph3">H.3 全文索引の問合せ</a></h4>

  <p class="first">全文索引への問合せについて説明します。
    単語単位や文字列単位のパターンに対して、
    さまざまな演算をサポートしています。</p>

  <p>論理演算の例を以下に示します。</p>

  <pre class="example">
select data from T where data contains 'データベース' &amp; 'システム'
</pre>

  <p>複数のパターンすべてを含むことを指定するには、
    AND演算子（&amp;）を使って連結します。</p>

  <pre class="example">
select data from T where data contains 'データベース' | 'システム'
</pre>

  <p>複数のパターンのどれかを含むことを指定するには、
    OR演算子（|）使って連結します。</p>

  <pre class="example">
select data from T where data contains 'データベース' - 'システム'
</pre>

  <p>2つのパターンのうち、前のパターンを含み、
    後ろのパターンを含まないことを指定するには、
    ANDNOT演算子（-）を使って連結します。</p>

  <p>近接演算の例を以下に示します。</p>

  <pre class="example">
select data from T where data contains within ('データベース' '検索' 'システム' upper 10);
</pre>

  <p>近接検索のためのパターンを生成するには contains述語に within を指定します。
    上記の例は、「データベース」「検索」「システム」の順番で現れ、
    かつ「データベース」と「システム」が距離10以内のデータを検索します。</p>

  <pre class="example">
select data from T where data contains
 within ('データベース' '検索' 'システム' asymmetric lower 5 upper 10);
</pre>

  <p>上記の例は、「データベース」「検索」「システム」が現れ、
    かつ一番最初に現れたパターンと一番最後に現れたパターンが
    距離5以上10以下のデータを検索します。</p>

  <p>文字列単位検索の例を以下に示します。</p>

  <pre class="example">
select data from T where data contains data contains head('リレーショナル') &amp; tail('システム')
</pre>

  <p>上記の例は、先頭が文字列「リレーショナル」で、
    末尾が文字列「システム」のデータを検索します。</p>

  <p>単語単位検索の例を以下に示します。</p>

  <pre class="example">
select data from T where data contains exactword('データベース') &amp; simpleword('システム')
</pre>

  <p>上記の例は、単語「データベース」と単語「システム」を含むデータを検索します。</p>

  <p>各演算の仕様の詳細については、<a href="#sec60408">CONTAINSオペランド</a>を参照してください。</p>

  <p>また、全文索引が付いた列に対して、以下の関数は高速に処理できます。</p>

  <pre class="example">
select count(data) from T where data contains 'データベース';
</pre>

  <p>上記の例は、文字列「データベース」を含む文書数を取得します。</p>

  <pre class="example">
select avg(char_length(data)) from T;
</pre>

  <p>上記の例は、data列のデータの平均文書長を取得します。</p>

  <pre class="bad-example">
select avg(char_length(data)) from T where data contains 'データベース';
(不正なSQLの例)
</pre>

  <p>ただし、上記の例のように条件が付き、
    data列の一部のデータの平均文書長を取得する場合には、
    高速に平均文書長を取得できません。</p>

  <p>これら以外の、全文索引付き列だけで使え、かつ高速に処理できる関数があります。
    詳細については、<a href="#sec60208">数値関数</a>を参照してください。</p>

  <h4><a id="secapph4">H.4 全文索引のランキング検索</a></h4>

  <p class="first">DoqueDBは、<a href="#sec1">1章 全文検索チュートリアル</a>の<a href="#sec104">ランキング検索</a>で説明したように、
    検索条件との適合度であるスコアを計算することができます。
    ここではスコアの計算方法の指定方法を説明します。</p>

  <p>スコア計算器の指定方法の例を以下に示します。</p>

  <pre class="example">
select data from T where data contains 'システム' calculator 'TfIdf' order by score(data) desc
</pre>

  <p>上記の例は、calculatorを使用して、スコア計算器を指定しています。</p>

  <p>スコア合成器の指定方法の例を以下に示します。</p>

  <pre class="example">
select data from T where data contains ('リコー' &amp; 'ソフトウエア' combiner 'Prod')
 order by score(data) desc
</pre>

  <p>上記の例は、combinerをパターンの中で使用して、
    個々のパターンのスコアから、パターン全体のスコアを合成する方法を指定しています。</p>

  <p>スコア調整器の指定方法の例を以下に示します。</p>

  <pre class="example">
create fulltext index I on T(f) score column d;
select score(f) from T where f contains 'リコー' score function 'Sum';
</pre>

  <p>上記の例は、転置索引で得られた個々のスコアを、
    &lt;スコア調整列指定&gt;で指定された列から得られる個々の値と&lt;スコア調整器&gt;を使って、
    調整します。
    たとえば、転置索引から得られたあるタプルのスコアが0.5で、
    スコア調整列から得られたそのタプルのスコア調整値が2.0で、
    スコア調整器が「Sum」の場合、スコアは2.5に調整されます。
    同様にスコア調整器が「Multiply」の場合、スコアは1.0に調整されます。</p>

  <p>個々のパターンの重みの付け方の例を以下に示します。</p>

  <pre class="example">
select data from T where data contains 'システム' &amp; weight('databse' scale 2.0)
 order by score(data) desc;
</pre>

  <p>上記の例は、weightを使用して、個々のパターンの重要性を調整しています。</p>

  <p>仕様の詳細については、<a href="#sec60602">全文索引定義</a>と<a href="#sec60407">CONTAINS述語</a>と<a
      href="#sec60408">CONTAINSオペランド</a>を参照してください。
  </p>

  <h4><a id="secapph5">H.5 全文索引の自然文検索</a></h4>

  <p class="first">DoqueDBは、<a href="#sec1">1章 全文検索チュートリアル</a>の<a href="#sec105">自然文検索</a>で説明したように、
    検索条件に自然文を利用することができます。</p>

  <pre class="example">
select rowid, score(data) from T where data contains freetext('リコーの環境保護への取り組み')
 extractor 'EstimateDF @TERMRSCID:1' order by score(data) desc;
</pre>

  <p>上記の例は、extractorをcontains述語で使用して、
    検索語抽出に使用するリソース（異表記正規化辞書や質問処理辞書）等を
    明示的に指定しています。</p>

  <pre class="example">
create table T (data nvarchar(no limit), l language);
create fulltext index F on T(data) language column l
 hint 'delayed, inverted=(
  normalized=(stemming=true, deletespace=false),
  indexing=dual,
  tokenizer=DUAL:JAP:ALL:2 ALP:3 ASC:3 KAT:3 KAN:HIR @NORMRSCID:1 @UNARSCID:1,
  extractor=EstimateDF @TERMRSCID:0)';

select rowid, score(data) from T where data contains freetext('リコーの環境保護への取り組み')
 order by score(data) desc;
</pre>

  <p>上記の例は、索引作成時にextractorを設定しています。
    検索のたびに指定する必要がなくなります。</p>

  <p>また、自然文検索で使用した検索語に関する情報を取得できます。</p>

  <pre class="example">
select word(data) from T where data contains freetext('リコーの環境保護への取り組み')
 order by word(data).scale desc limit 3;
</pre>

  <p>上記の例は、自然文から検索において
    重要度の高い検索語の上位3件を取得する例です。</p>

  <p>検索語には、重要度の他には文書頻度を取得することができます。
    詳細については、<a href="#sec60206">全文検索結果参照</a>を参照してください。</p>

  <pre class="example">
select word(data) from T where data contains wordlist('リコー', '環境', '保護', '取り組み')
 order by word(data).scale desc limit 3;
</pre>

  <p>上記の例は、自然文の代わりに単語リストを使っています。
    検索語に関する情報は、単語リストを使っても取得できます。</p>

  <pre class="bad-example">
select word(data),score(data) from T where data contains freetext('リコーの環境保護への取り組み')
 order by word(data).scale desc limit 3;
(不正なSQLの例)
</pre>

  <p>上記の例はエラーになります。
    検索語の取得と検索結果を返すものとは同時に使用できません。</p>

  <h4><a id="secapph6">H.6 全文索引の拡張検索</a></h4>

  <p class="first">拡張検索とは、検索要求に関連する語を自動的に補い、検索する機能です。
    拡張検索を行うには、contains述語に expand を指定します。</p>

  <pre class="example">
select rowid, score(data) from T where data contains freetext('リコーの環境保護への取り組み')
 expand (from (select data from T where data contains freetext('リコーの環境保護への取り組み')
  order by word(data).scale desc limit 5)
 order by score(data) desc limit 10);
</pre>

  <p>上記の例は、文字列「リコーの環境保護への取り組み」を
    自然文検索して得られた文字列集合を使って、関連語を自動的に補います。
    関連語には重要度が付いているので、重要度が高い順に5個の単語が追加されます。
    つまり、expand内の一度目の自然文検索で関連語を取得し、
    問合せ式本体の2回目の自然文検索で関連語を補って検索結果を取得する仕組みです。</p>

  <pre class="example">
select rowid, score(data) from T where data contains freetext('リコーの環境保護への取り組み')
 expand (from (values
  '環境NPOや地元住民とのパートナーシップのもとに、「森林生態系保全プロジェクト」を展開しています。',
  '環境保全活動を推進すると同時に、実際の活動事例を積極的に社内外に情報発信しています。')
  order by word(data).scale desc limit 5)
 order by score(data) desc limit 10);
</pre>

  <p>上記の例は、列挙した文字列から関連語を補う例です。
    これは、あくまでも例なので、短い文字列を2つ列挙しただけですが、
    実際は、もっと長い文字列をより多く列挙した方が、
    適切な関連語を取得できる可能性が高くなります。</p>

  <h4><a id="secapph7">H.7 全文索引のストップワード</a></h4>

  <p class="first">DoqueDBは、自然文から検索語を切り出すときにストップワードを無視しています。
    ただし、索引作成時にはすべての単語を切り出して索引づけしています。</p>

  <h3><a id="secappi">I. 全文索引の遅延更新</a></h3>

  <p class="first">全文索引の更新は、データ量に応じて遅くなっていきます。
    これは全文索引で使用している、転置ファイルの構造上の問題です。
    しかし、小さな転置ファイルの更新は十分高速なので、
    常に小さい転置ファイルに対して更新処理を行うようにすれば、
    更新処理を高速なままに維持できます。</p>

  <p>遅延更新は、以下のような仕組みになっています。</p>

  <p class="center"><img src="image/inverted.gif" alt=""></p>

  <ol>
    <li>全文索引を定義すると、大小2種類の転置ファイルが作成されます。</li>
    <li>ユーザーからの更新要求は、すべて小転置に対して行います。</li>
    <li>小転置がある程度の大きさになったら、索引単位ごとに大転置にマージします。
      これをマージ処理といいます。</li>
    <li>マージ処理が終了したら、小転置を空にします。</li>
  </ol>

  <p>全文索引では、マージ処理のときに
    未使用領域の解放も同時に実行されますので、大転置のサイズの肥大化を抑制できます。
    なお、マージ処理中も検索や更新は可能です。</p>

  <h3><a id="secappj">J. ビットマップ索引の使い方</a></h3>

  <p class="first">ビットマップ索引は、列に対する等式または不等式を条件とする検索を速くする、
    データベースシステムで一般的に使われている索引です。
    B+木索引と比較して、特に異なりデータ数が少ないデータに対して有効です。</p>

  <h4><a id="secappj1">J.1 異なりデータ数</a></h4>

  <p class="first">ビットマップ索引は、
    その列に挿入されるデータの異なりデータ数が少ないデータ、
    たとえば性別や都道府県名など、に対して有効です。</p>

  <p>異なりデータ数が多くてもビットマップ索引は使えますが、
    <a href="#sec30304">チューニング用パラメーター</a>のBuffer_NormalPoolSizeに依存する制限があります。
  </p>

  <pre class="bad-example">
create table T(int C array[no limit]);
create bitmap index I on T(C);
insert T values (array[0,1,2, ... ,3000]);
(不正なSQLの例)
</pre>

  <p>たとえば、デフォルト値の20Mだった場合、
    上記のような約2500以上の異なりデータを要素に持つ配列の挿入は、
    メモリの確保に失敗してしまいます。</p>

  <pre class="example">
create table T(int C array[no limit]);
create bitmap index I on T(C) hint 'compressed';
insert T values (array[0,1,2, ... ,3000]);
</pre>

  <p>このように異なりデータ数が多い(100以上)ときは、
    上記のように<a href="#sec60505">ヒント句</a>にCOMPRESSEDを指定して索引再作成することをおすすめします。</p>

  <p>(配列型でなければ、COMPRESSED指定をしなくてもメモリの確保には失敗しませんが、
    配列型かどうかにかかわらず、異なりデータ数が多いときはCOMPRESSED指定することを
    おすすめします。)</p>

  <p>スキーマを変更できない場合は、
    Buffer_NormalPoolSizeを異なりデータ数に応じて増やしてください。</p>

  <h3><a id="secappk">K. 複数インストール</a></h3>

  <p class="first">1つのマシンにDoqueDBを複数導入することは可能です。
    ただし、1つのDoqueDBに複数のデータベースを作成して運用するのと比較して、
    メモリ効率は低下します。</p>

  <p>基本的なインストール手順は<a href="#sec2">2章 インストール</a>の手順と同様です。
    以下の点に注意してください。</p>

  <ul>
    <li>conf.shの変更。

      <p>以下の値を既存のDoqueDBと重ならない値に変更してください。</p>

      <ul>
        <li>installpath</li>
        <li>databasepath</li>
        <li>portnumber</li>
      </ul>
    </li>
  </ul>

  <blockquote>
    <p class="quoted">install.sh、setup.shは、以下の例のようにして
      conf.shの代わりに読み込むファイル名を指定できます。
      conf.shをコピーして修正したものを用意すると、複数インストールが効率的にできます。</p>
  </blockquote>
  <blockquote>
    <p class="quoted"></p>
  </blockquote>

  <pre class="example">
  install.sh conf2.sh
  setup.sh conf2.sh
</pre>

  <h3><a id="secappl">L. 用語定義</a></h3>

  <p class="first">以下に用語定義を示します。</p>

  <dl>
    <dt class="bold">データベースが壊れる</dt>
    <dd>データベースを構成するファイルの内容に異常があり、
      バックアップから戻す以外に回復する手段がないことです。
      自動復旧で回復できる場合は、ここでは壊れているとは呼びません。</dd>

    <dt class="bold">正常終了</dt>
    <dd>プロセスが、
      正常に動作している状態から必要な終了処理を実行した終了です。</dd>

    <dt class="bold">異常終了</dt>
    <dd>正常終了以外のプロセスの終了です。</dd>

    <dt class="bold">例外</dt>
    <dd>プロセスが、実行中に何らかの異常を検知したときになる状態です。
      以下に異常の例を示します。

      <ul>
        <li>実行環境の異常

          <ul>
            <li>メモリの確保の失敗</li>
            <li>ディスク容量の不足</li>
          </ul>
        </li>
        <li>プログラムの異常

          <ul>
            <li>不正なアドレスの参照</li>
          </ul>
        </li>
      </ul>
    </dd>

    <dt class="bold">予期せぬ例外</dt>
    <dd>プログラムの中で発生を想定していない箇所で発生する例外です。
      上記、例外の例の中では「不正なアドレス参照」が相当します。</dd>

    <dt class="bold">チェックポイント</dt>
    <dd>定期的に動作するデーモンスレッドにより、バッファ上のデータの一部が
      データベースを構成するファイルにフラッシュされる処理です。</dd>

    <dt class="bold">版</dt>
    <dd>DoqueDBはOracleやSQL Serverのようなページ単位のロックではなく、
      MVCC(Multi Version Concurrency Control)とタプル単位のロックにより、
      トランザクションごとに指定されるアイソレーションレベルを実現しています。
      版とは、MVCCにより作られる、
      ある時点におけるデータベースの仮想的なコピーのことです。
      版はVERSIOM.SYDというファイルに格納され、
      VERSIOM.SYDはデータベースを構成するファイルのそれぞれに対応して作成されます。</dd>

    <dt class="bold">論理ログ</dt>
    <dd>データベースに対する操作の内容を
      SQL文単位あるいは処理対象レコード単位に記録するファイルです。
      OracleのREDOログファイル、
      SQL Serverのトランザクションログと似たようなものです。</dd>

    <dt class="bold">物理ログ</dt>
    <dd>ある時点のデータベースイメージです。
      版のうち特定の条件を満たすものを物理ログとして用います。</dd>
  </dl>

  <h3><a id="secappm">M. 参考文献</a></h3>

  <ol>
    <li>小川泰嗣，山本研策，真野博子，伊東秀夫,
      「全文検索システムのための複数転置ファイルを用いた登録高速化とランキング検索」,
      第13回データ工学ワークショップ(DEWS2002)，2002<br>
      <a
        href="http://www.ieice.org/iss/de/DEWS/proc/2002/papers/B2-1.pdf">http://www.ieice.org/iss/de/DEWS/proc/2002/papers/B2-1.pdf</a>
    </li>
    <li>「文書検索におけるランキング検索技術」
      RICOH TECHNICAL REPORT No.29, 2003<br>
      <a
        href="https://jp.ricoh.com/-/Media/Ricoh/Sites/jp_ricoh/technology/techreport/29/pdf/A2902.pdf">https://jp.ricoh.com/-/Media/Ricoh/Sites/jp_ricoh/technology/techreport/29/pdf/A2902.pdf</a>
    </li>
    <li>「高速で高機能な全文検索が可能なデータベースカーネル」
      RICOH TECHNICAL REPORT No.30, 2004<br>
      <a
        href="https://jp.ricoh.com/-/Media/Ricoh/Sites/jp_ricoh/technology/techreport/30/pdf/A3011.pdf">https://jp.ricoh.com/-/Media/Ricoh/Sites/jp_ricoh/technology/techreport/30/pdf/A3011.pdf</a>
    </li>
    <li>Tetsuya Ikeda, Hiroko Mano, Hideo Itoh, Hiroshi Takegawa, Takuya Hiraoka,
      Shiroh Horibe, Yasushi Ogawa, &quot;TRMeister: A DBMS with High-Performance
      Full-Text Search Functions,&quot; icde, pp. 958-967, 21st International Conference
      on Data Engineering (ICDE'05), 2005<br>
      <a href="https://ieeexplore.ieee.org/document/1410207">https://ieeexplore.ieee.org/document/1410207</a>
    </li>
    <li>Standards for: Data Management and Interchange, ISO/IEC JTC1 SC32,<br>
      <a href="http://www.jtc1sc32.org/">http://www.jtc1sc32.org/</a>
    </li>
  </ol>

  <hr>
  <p class="center">Copyright (c) 2023, 2024 Ricoh Company, Ltd. All rights reserved.</p>

</body>

</html>
